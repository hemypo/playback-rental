const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CKzDOQbx.js","assets/index-l-waj2qo.css"])))=>i.map(i=>d[i]);
var es=e=>{throw TypeError(e)};var jr=(e,r,n)=>r.has(e)||es("Cannot "+n);var H=(e,r,n)=>(jr(e,r,"read from private field"),n?n.call(e):r.get(e)),nt=(e,r,n)=>r.has(e)?es("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,n),st=(e,r,n,s)=>(jr(e,r,"write to private field"),s?s.call(e,n):r.set(e,n),n),at=(e,r,n)=>(jr(e,r,"access private method"),n);import{Q as q,ad as ai,ae as oi,af as ts,ag as ii,ah as _s,a4 as Pe,r as d,ai as li,aj as ci,ak as Z,al as Ce,am as z,an as lr,ao as Dt,ap as Gt,aq as di,ar as Ps,as as ks,at as rs,au as zt,av as me,aw as V,ax as _t,ay as Wr,az as Zt,j as t,a as se,T as ue,U as ve,W as ae,c as O,y as ui,V as Ne,ab as pe,ac as Mt,F as oe,aA as Ie,aB as fi,aC as mi,aD as te,aE as hi,O as xt,aF as zr,aG as gi,aH as vi,h as Rt,i as xe,P as he,q as ne,s as Ke,aI as pi,S as xi,aJ as Ms,aK as yi,aL as bi,D as ji,aM as wi,l as an,o as wr,aN as Ni,X as on,n as Rs,aO as $s,a2 as ie,I as R,aP as Y,_ as Be,a0 as Jt,aQ as Ct,a1 as Ve,a9 as Is,aR as As,k as Ci,p as Xe,t as Si,aS as Ei,d as ln,aT as Di,aU as cn,aV as _i,aW as er,a3 as Os,aX as Ts,aY as tr,aZ as Br,a_ as Vr,a$ as Hr,b0 as Kr,b1 as lt,b2 as Pi,b3 as Fs,$ as ki,b4 as Mi,b5 as Ri,b6 as $i,b7 as ct,b8 as Ii,b9 as Ai,ba as Oi,bb as Ti,bc as Fi,bd as Li,be as Ls,bf as Us,bg as qs,x as Ui,C as dn,bh as qi,bi as Wi,e as Ws,bj as zi,bk as Bi,bl as zs,bm as re,bn as $e,bo as rr,bp as Bs,bq as Yr,br as Vi,bs as un,bt as Hi,bu as Ki,bv as Vs,bw as Hs,bx as Yi,by as Qi,bz as Xi,bA as Gi,bB as Zi,bC as ns,bD as Ji,bE as el,a6 as Nr,bF as tl,bG as rl,bH as nl,bI as sl,bJ as al,bK as Ks,f as ol,aa as il,bL as ll,bM as cl,A as dl,bN as ul,bO as fl,bP as ss}from"./index-CKzDOQbx.js";import{d as ml,g as hl,P as gl,a as $t,b as It,c as ee,T as G}from"./tabs-Cps5xYGZ.js";import{F as ze,a as St,b as Et,c as mt,d as nr,z as be,u as fn,t as mn,e as Ys,L as ft,f as Cr}from"./index-DSv7xXBc.js";import{T as Qs}from"./textarea-plCJo5Qh.js";import{P as cr,Q as vl}from"./QuantitySelector-_QMh9DO_.js";import{T as pl}from"./trash-TJGOcr98.js";import{c as xl}from"./serverApi-CMjEJksR.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yl=q("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=q("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jl=q("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=q("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nl=q("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=q("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=q("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=q("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=q("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=q("FileArchive",[["path",{d:"M10 12v-1",key:"v7bkov"}],["path",{d:"M10 18v-2",key:"1cjy8d"}],["path",{d:"M10 7V6",key:"dljcrl"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 .274 1.01",key:"gkbcor"}],["circle",{cx:"10",cy:"20",r:"2",key:"1xzdoj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cl=q("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=q("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const El=q("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dl=q("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=q("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=q("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pl=q("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kl=q("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ml=q("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rl=q("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $l=q("ReceiptRussianRuble",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M8 15h5",key:"vxg57a"}],["path",{d:"M8 11h5a2 2 0 1 0 0-4h-3v10",key:"1usi5u"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=q("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Il=q("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Al=q("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=q("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=q("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=q("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ol=q("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var qe,We,de,Re,Ae,Yt,Qr,Ds,Tl=(Ds=class extends ai{constructor(n,s){super();nt(this,Ae);nt(this,qe);nt(this,We);nt(this,de);nt(this,Re);st(this,qe,n),this.setOptions(s),this.bindMethods(),at(this,Ae,Yt).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var a;const s=this.options;this.options=H(this,qe).defaultMutationOptions(n),oi(this.options,s)||H(this,qe).getMutationCache().notify({type:"observerOptionsUpdated",mutation:H(this,de),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&ts(s.mutationKey)!==ts(this.options.mutationKey)?this.reset():((a=H(this,de))==null?void 0:a.state.status)==="pending"&&H(this,de).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=H(this,de))==null||n.removeObserver(this)}onMutationUpdate(n){at(this,Ae,Yt).call(this),at(this,Ae,Qr).call(this,n)}getCurrentResult(){return H(this,We)}reset(){var n;(n=H(this,de))==null||n.removeObserver(this),st(this,de,void 0),at(this,Ae,Yt).call(this),at(this,Ae,Qr).call(this)}mutate(n,s){var a;return st(this,Re,s),(a=H(this,de))==null||a.removeObserver(this),st(this,de,H(this,qe).getMutationCache().build(H(this,qe),this.options)),H(this,de).addObserver(this),H(this,de).execute(n)}},qe=new WeakMap,We=new WeakMap,de=new WeakMap,Re=new WeakMap,Ae=new WeakSet,Yt=function(){var s;const n=((s=H(this,de))==null?void 0:s.state)??ii();st(this,We,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},Qr=function(n){_s.batch(()=>{var s,a,o,i,l,c,u,f;if(H(this,Re)&&this.hasListeners()){const m=H(this,We).variables,g=H(this,We).context;(n==null?void 0:n.type)==="success"?((a=(s=H(this,Re)).onSuccess)==null||a.call(s,n.data,m,g),(i=(o=H(this,Re)).onSettled)==null||i.call(o,n.data,null,m,g)):(n==null?void 0:n.type)==="error"&&((c=(l=H(this,Re)).onError)==null||c.call(l,n.error,m,g),(f=(u=H(this,Re)).onSettled)==null||f.call(u,void 0,n.error,m,g))}this.listeners.forEach(m=>{m(H(this,We))})})},Ds);function fe(e,r){const n=Pe(),[s]=d.useState(()=>new Tl(n,e));d.useEffect(()=>{s.setOptions(e)},[s,e]);const a=d.useSyncExternalStore(d.useCallback(i=>s.subscribe(_s.batchCalls(i)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),o=d.useCallback((i,l)=>{s.mutate(i,l).catch(li)},[s]);if(a.error&&ci(s.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}function Xr(e,r){const n=r*7;return Z(e,n)}function Fl(e,r){return Ce(e,r*12)}function Ll(e){let r;return e.forEach(function(n){const s=z(n);(r===void 0||r<s||isNaN(Number(s)))&&(r=s)}),r||new Date(NaN)}function Ul(e){let r;return e.forEach(n=>{const s=z(n);(!r||r>s||isNaN(+s))&&(r=s)}),r||new Date(NaN)}function Qt(e,r){const n=z(e),s=z(r),a=n.getTime()-s.getTime();return a<0?-1:a>0?1:a}function ql(e){return lr(e,Date.now())}function vt(e,r){const n=z(e),s=z(r),a=n.getFullYear()-s.getFullYear(),o=n.getMonth()-s.getMonth();return a*12+o}function Wl(e,r,n){const s=Dt(e,n),a=Dt(r,n),o=+s-Gt(s),i=+a-Gt(a);return Math.round((o-i)/di)}function Gr(e){const r=z(e);return r.setHours(23,59,59,999),r}function dr(e){const r=z(e),n=r.getMonth();return r.setFullYear(r.getFullYear(),n+1,0),r.setHours(23,59,59,999),r}function zl(e){const r=z(e);return+Gr(r)==+dr(r)}function Bl(e,r){const n=z(e),s=z(r),a=Qt(n,s),o=Math.abs(vt(n,s));let i;if(o<1)i=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-a*o);let l=Qt(n,s)===-a;zl(z(e))&&o===1&&Qt(e,s)===1&&(l=!1),i=a*(o-Number(l))}return i===0?0:i}function Vl(e,r,n){const s=ml(e,r)/1e3;return hl(n==null?void 0:n.roundingMethod)(s)}function vn(e,r){var l,c,u,f;const n=Ps(),s=(r==null?void 0:r.weekStartsOn)??((c=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??n.weekStartsOn??((f=(u=n.locale)==null?void 0:u.options)==null?void 0:f.weekStartsOn)??0,a=z(e),o=a.getDay(),i=(o<s?-7:0)+6-(o-s);return a.setDate(a.getDate()+i),a.setHours(23,59,59,999),a}function ea(e){return vn(e,{weekStartsOn:1})}function Hl(e,r,n){const s=Ps(),a=(n==null?void 0:n.locale)??s.locale??ks,o=2520,i=Qt(e,r);if(isNaN(i))throw new RangeError("Invalid time value");const l=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:i});let c,u;i>0?(c=z(r),u=z(e)):(c=z(e),u=z(r));const f=Vl(u,c),m=(Gt(u)-Gt(c))/1e3,g=Math.round((f-m)/60);let h;if(g<2)return n!=null&&n.includeSeconds?f<5?a.formatDistance("lessThanXSeconds",5,l):f<10?a.formatDistance("lessThanXSeconds",10,l):f<20?a.formatDistance("lessThanXSeconds",20,l):f<40?a.formatDistance("halfAMinute",0,l):f<60?a.formatDistance("lessThanXMinutes",1,l):a.formatDistance("xMinutes",1,l):g===0?a.formatDistance("lessThanXMinutes",1,l):a.formatDistance("xMinutes",g,l);if(g<45)return a.formatDistance("xMinutes",g,l);if(g<90)return a.formatDistance("aboutXHours",1,l);if(g<rs){const v=Math.round(g/60);return a.formatDistance("aboutXHours",v,l)}else{if(g<o)return a.formatDistance("xDays",1,l);if(g<zt){const v=Math.round(g/rs);return a.formatDistance("xDays",v,l)}else if(g<zt*2)return h=Math.round(g/zt),a.formatDistance("aboutXMonths",h,l)}if(h=Bl(u,c),h<12){const v=Math.round(g/zt);return a.formatDistance("xMonths",v,l)}else{const v=h%12,p=Math.trunc(h/12);return v<3?a.formatDistance("aboutXYears",p,l):v<9?a.formatDistance("overXYears",p,l):a.formatDistance("almostXYears",p+1,l)}}function Kl(e,r){return Hl(e,ql(e),r)}function Yl(e){const r=z(e),n=r.getFullYear(),s=r.getMonth(),a=lr(e,0);return a.setFullYear(n,s+1,0),a.setHours(0,0,0,0),a.getDate()}function Ql(e){return Math.trunc(+z(e)/1e3)}function Xl(e){const r=z(e),n=r.getMonth();return r.setFullYear(r.getFullYear(),n+1,0),r.setHours(0,0,0,0),r}function Gl(e,r){return Wl(Xl(e),me(e),r)+1}function pn(e,r){const n=z(e),s=z(r);return n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()}function Zl(e,r){const n=z(e),s=z(r);return n.getFullYear()===s.getFullYear()}function Dr(e,r){return Z(e,-r)}function _r(e,r){const n=z(e),s=n.getFullYear(),a=n.getDate(),o=lr(e,0);o.setFullYear(s,r,15),o.setHours(0,0,0,0);const i=Yl(o);return n.setMonth(r,Math.min(a,i)),n}function as(e,r){const n=z(e);return isNaN(+n)?lr(e,NaN):(n.setFullYear(r),n)}const xn=async()=>{try{const{data:e,error:r}=await V.from("products").select("*");if(r)throw r;return(e==null?void 0:e.map(n=>({...n,imageUrl:n.imageurl,category_id:n.category_id||parseInt(n.category)||1})))||[]}catch(e){return console.error("Error getting products:",e),[]}},Jl=async e=>{try{const{data:r,error:n}=await V.from("products").select("*").eq("id",e).single();if(n)throw n;return r?{...r,imageUrl:r.imageurl,category_id:r.category_id||parseInt(r.category)||1}:null}catch(r){return console.error("Error getting product by ID:",r),null}},os=async(e,r)=>{try{console.log("Creating product with data:",e),console.log("Image file:",r);let n="";if(r)try{n=await _t(r),console.log("Image uploaded successfully:",n)}catch(i){console.error("Failed to upload image:",i),n=""}const s={title:e.title,description:e.description||"",price:e.price,category:e.category_id.toString(),category_id:e.category_id,imageurl:n,quantity:e.quantity||1,available:e.available??!0};console.log("Inserting product into database:",s);const{data:a,error:o}=await V.from("products").insert([s]).select().single();if(o)throw console.error("Database error creating product:",o),o;return console.log("Product created successfully:",a),{...a,imageUrl:a.imageurl,category_id:a.category_id}}catch(n){throw console.error("Error creating product:",n),n}},ec=async(e,r,n)=>{try{console.log("Updating product with ID:",e),console.log("Update data:",r),console.log("New image file:",n);let s=r.imageUrl||"";n&&n instanceof File;const a={title:r.title,description:r.description||"",price:r.price,category:r.category_id.toString(),category_id:r.category_id,imageurl:s,quantity:r.quantity||1,available:r.available??!0};console.log("Updating product in database:",a);const{data:o,error:i}=await V.from("products").update(a).eq("id",e).select().single();if(i)throw console.error("Database error updating product:",i),i;return console.log("Product updated successfully:",o),{...o,imageUrl:o.imageurl,category_id:o.category_id}}catch(s){throw console.error("Error updating product:",s),s}},tc=async()=>{try{const e=await xn(),r=["id","title","description","price","category","imageurl","quantity","available"];return[r.join(";"),...e.map(s=>r.map(a=>{const o=s[a];let i=String(o);return typeof o=="string"&&(o.includes(";")||o.includes('"')||o.includes("\r")||o.includes(`
`))&&(i='"'+i.replace(/"/g,'""')+'"'),i}).join(";"))].join(`\r
`)}catch(e){return console.error("Error exporting products to CSV:",e),""}},rc=async e=>{try{e.charCodeAt(0)===65279&&(e=e.slice(1));const r=e.split(/\r\n|\r|\n/).filter(x=>x.trim());if(r.length===0)throw new Error("CSV file is empty or invalid");const n=[";",",","	"];let s=";";const a=r[0],i=n.map(x=>({delimiter:x,count:(a.match(new RegExp(x,"g"))||[]).length})).sort((x,b)=>b.count-x.count)[0];i&&i.count>0&&(s=i.delimiter),console.log(`CSV Import: Detected delimiter "${s}"`);const l=is(r[0],s),c=new Map;l.forEach((x,b)=>{const y=x.toLowerCase().trim();c.set(y,b)}),console.log("CSV Import: Detected columns:",Object.fromEntries(c));const f=["title","category"].filter(x=>!Array.from(c.keys()).some(b=>b.includes(x)));if(f.length>0)throw new Error(`CSV is missing required columns: ${f.join(", ")}`);const m=[],{getCategories:g}=await Wr(async()=>{const{getCategories:x}=await import("./index-CKzDOQbx.js").then(b=>b.bX);return{getCategories:x}},__vite__mapDeps([0,1])),h=await g(),v=new Map(h.map(x=>[x.category_id,x])),p=new Map(h.map(x=>[x.name.toLowerCase(),x]));console.log("Available categories by ID:",Object.fromEntries(v)),console.log("Available categories by name:",Array.from(p.keys()));for(let x=1;x<r.length;x++){if(!r[x].trim())continue;const b=is(r[x],s),y={},j=(E,T=null)=>{let L=c.get(E.toLowerCase());if(L===void 0){const Q=Array.from(c.keys()).find(ce=>ce.includes(E.toLowerCase())||E.toLowerCase().includes(ce));Q&&(L=c.get(Q))}return L!==void 0&&L<b.length&&b[L].trim()!==""?b[L].trim():T};y.id=j("id"),y.title=j("title",""),y.description=j("description","");const w=j("category",""),C=j("price","0");y.price=parseFloat(C.replace(/[^\d.,]/g,"").replace(",","."))||0;const S=j("quantity","1");y.quantity=parseInt(S,10)||1;const P=j("available","true");y.available=P.toLowerCase()==="true"||P==="1"||P.toLowerCase()==="да";const _=j("imageurl","");if(y.imageurl=_,console.log(`Row ${x}: Extracted image URL: "${_}"`),!y.title||!w){console.warn(`Skipping row ${x+1}: Missing required fields`);continue}let D=null;const F=parseInt(w,10);if(!isNaN(F)&&v.has(F))D=v.get(F),y.category_id=F,console.log(`Row ${x}: Using existing category ID ${F}: ${D==null?void 0:D.name}`);else if(p.has(w.toLowerCase()))D=p.get(w.toLowerCase()),y.category_id=D==null?void 0:D.category_id,console.log(`Row ${x}: Using existing category by name "${w}": ID ${D==null?void 0:D.category_id}`);else{console.log(`Row ${x}: Creating new category: ${w}`);const T=await Zt({name:w,slug:w.toLowerCase().replace(/\s+/g,"-")});if(T)v.set(T.category_id,T),p.set(T.name.toLowerCase(),T),D=T,y.category_id=T.category_id,console.log(`Row ${x}: Created new category "${w}" with ID ${T.category_id}`);else{console.error(`Row ${x}: Failed to create category ${w}`);continue}}if(!D){console.error(`Row ${x}: No valid category found for "${w}"`);continue}m.push(y)}console.log(`Processed ${m.length} products from CSV`);for(const x of m)try{const{id:b,...y}=x;console.log(`Processing product "${y.title}" with category_id: ${y.category_id}, image URL: "${y.imageurl}"`),b?await Jl(b)?await ec(b,y):await os(y,y.imageurl):await os(y,y.imageurl)}catch(b){console.error(`Error processing product: ${x.title}`,b)}return m}catch(r){throw console.error("Error importing products from CSV:",r),r}};function is(e,r){const n=[];let s=!1,a="";for(let o=0;o<e.length;o++){const i=e[o],l=o+1<e.length?e[o+1]:"";i==='"'?s&&l==='"'?(a+='"',o++):s=!s:i===r&&!s?(n.push(a),a=""):a+=i}return n.push(a),n}const Bt=({title:e,value:r,icon:n,trend:s})=>{const a=s!=null&&s.isPositive?bl:yl;return t.jsxs(se,{children:[t.jsxs(ue,{className:"flex flex-row items-center justify-between pb-2",children:[t.jsx(ve,{className:"text-sm font-medium",children:e}),t.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),t.jsxs(ae,{children:[t.jsx("div",{className:"text-2xl font-bold",children:r}),s&&t.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.jsxs("span",{className:`flex items-center gap-1 ${s.isPositive?"text-green-500":"text-red-500"}`,children:[t.jsx(a,{className:"h-3 w-3"}),s.value]})," ",s.text]})]})]})},nc=ui("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function De({className:e,variant:r,...n}){return t.jsx("div",{className:O(nc({variant:r}),e),...n})}const sc=({bookings:e,groupedBookings:r,isLoading:n})=>{console.log("RecentBookings render:",{bookingsCount:(e==null?void 0:e.length)||0,groupedBookingsCount:(r==null?void 0:r.length)||0,hasBookings:!!e,hasGroupedBookings:!!r});const s=c=>{switch(c){case"confirmed":return"bg-green-500 text-white";case"pending":return"bg-yellow-400 text-black";case"cancelled":return"bg-red-500 text-white";case"completed":return"bg-blue-500 text-white";default:return"bg-gray-400 text-black"}},a=c=>{switch(c){case"confirmed":return"Подтверждено";case"pending":return"В ожидании";case"cancelled":return"Отменено";case"completed":return"Завершено";default:return c}},o=c=>{const u=c instanceof Date?c:new Date(c);return pe(u,"dd MMM yyyy",{locale:Mt})},i=r&&r.length>0,l=i?r.slice(0,5):(e==null?void 0:e.slice(0,5))||[];return console.log("RecentBookings display decision:",{showGroupedView:i,displayBookingsCount:l.length,displayBookingStatuses:l.map(c=>({id:c.id,status:c.status,order_id:"order_id"in c?c.order_id:"N/A"}))}),t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsx(ve,{children:"Последние заявки"}),t.jsx(Ne,{children:i?"Последние 5 заказов (сгруппированные)":"Последние 5 индивидуальных заявок"})]}),t.jsx(ae,{children:n?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx("div",{className:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"})}):l.length>0?t.jsx("div",{className:"space-y-3",children:l.map(c=>{var h,v;const u="items"in c,f=u?c.items.reduce((p,x)=>p+x.quantity,0):c.quantity||1,m=u?c.items.length:1,g=c.order_id;return console.log("Rendering booking:",{id:c.id,order_id:g,status:c.status,isGrouped:u,totalPrice:c.totalPrice}),t.jsxs("div",{className:"flex items-center justify-between border-b pb-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:c.customerName}),t.jsxs("div",{className:"text-sm text-muted-foreground flex flex-col",children:[t.jsx("span",{children:c.customerPhone}),t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.jsx("span",{children:o(c.startDate)}),g&&t.jsxs(De,{variant:"outline",className:"text-xs px-1 py-0",children:["ID: ",g.slice(0,8)]}),u&&t.jsxs(De,{variant:"outline",className:"text-xs px-1 py-0",children:[m," товар",m===1?"":m<5?"а":"ов",", ",f," шт."]}),!u&&c.product&&t.jsx(De,{variant:"outline",className:"text-xs px-1 py-0",children:(h=c.product)==null?void 0:h.title})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-medium",children:[((v=c.totalPrice)==null?void 0:v.toLocaleString())||"0"," ₽"]}),t.jsx(De,{className:s(c.status),children:a(c.status)})]})]},c.id)})}):t.jsx("p",{className:"text-muted-foreground py-8 text-center",children:"Нет заявок на бронирование"})})]})},ac=({bookings:e,totalBookings:r})=>{const n={confirmed:"Подтверждено",pending:"В ожидании",cancelled:"Отменено",completed:"Завершено"},s={confirmed:"bg-green-500",pending:"bg-yellow-400",cancelled:"bg-red-500",completed:"bg-blue-500"};return t.jsx("div",{className:"w-full h-40 flex items-end justify-around",children:["confirmed","pending","cancelled","completed"].map(a=>{const o=e.filter(l=>l.status===a).length,i=r>0?o/r*100:0;return t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:`w-12 mb-2 ${s[a]}`,style:{height:`${Math.max(i,5)}%`}}),t.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:n[a]}),t.jsx("div",{className:"text-sm font-medium",children:o})]},a)})})},oc=({bookings:e,totalBookings:r})=>t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsx(ve,{children:"Статистика бронирований"}),t.jsx(Ne,{children:"Распределение бронирований по статусам"})]}),t.jsx(ae,{className:"flex items-center justify-center",children:e?t.jsx(ac,{bookings:e,totalBookings:r}):t.jsx("div",{className:"flex items-center justify-center h-40",children:t.jsx("div",{className:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"})})})]}),ta=e=>{console.log("Starting grouping process with bookings:",e.length);const r=new Map;e.forEach(s=>{const a=s.order_id||s.id;if(console.log("Processing booking:",{id:s.id,order_id:s.order_id,customer:s.customerEmail,groupKey:a,startDate:s.startDate,endDate:s.endDate,createdAt:s.createdAt,quantity:s.quantity||1,status:s.status,totalPrice:s.totalPrice}),r.has(a)){const o=r.get(a),i=o.items.findIndex(g=>g.productId===s.productId);i>=0?(o.items[i].quantity+=s.quantity||1,console.log(`Merged duplicate product ${s.productId} - new quantity: ${o.items[i].quantity}`)):(o.items.push({product:s.product,quantity:s.quantity||1,productId:s.productId}),console.log(`Added new product ${s.productId} to existing group`)),o.totalPrice+=s.totalPrice||0;const l=o.status,c=s.status,u={completed:4,confirmed:3,pending:2,cancelled:1},f=u[l]||0;(u[c]||0)>f&&(o.status=c,console.log(`Updated group status from ${l} to ${c} for better priority`)),s.createdAt&&new Date(s.createdAt)<new Date(o.createdAt)&&(o.createdAt=s.createdAt,console.log(`Updated group creation date to earlier time: ${s.createdAt}`)),console.log("Updated existing group:",{id:o.id,order_id:a,status:o.status,totalItems:o.items.length,totalQuantity:o.items.reduce((g,h)=>g+h.quantity,0),totalPrice:o.totalPrice})}else{const o={id:s.id,order_id:a,customerName:s.customerName,customerEmail:s.customerEmail,customerPhone:s.customerPhone,startDate:s.startDate,endDate:s.endDate,status:s.status,totalPrice:s.totalPrice||0,notes:s.notes,createdAt:s.createdAt||new Date,items:[{product:s.product,quantity:s.quantity||1,productId:s.productId}]};r.set(a,o),console.log("Created new group:",{id:o.id,order_id:a,customer:o.customerEmail,productId:s.productId,quantity:s.quantity||1,status:o.status,totalPrice:o.totalPrice})}});const n=Array.from(r.values()).sort((s,a)=>new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime());return console.log("Grouping completed:",{originalBookings:e.length,groupedBookings:n.length,groups:n.map(s=>({id:s.id,order_id:s.order_id,customer:s.customerEmail,status:s.status,itemCount:s.items.length,totalPrice:s.totalPrice,totalQuantity:s.items.reduce((a,o)=>a+o.quantity,0),items:s.items.map(a=>{var o;return{productId:a.productId,title:(o=a.product)==null?void 0:o.title,quantity:a.quantity}})}))}),n},ic=()=>{const{data:e}=oe({queryKey:["admin-products"],queryFn:()=>fi()}),{data:r}=oe({queryKey:["bookings"],queryFn:()=>mi()});console.log("AdminDashboard - Raw bookings data:",(r==null?void 0:r.length)||0),console.log("AdminDashboard - Sample booking statuses:",r==null?void 0:r.slice(0,3).map(u=>({id:u.id,status:u.status,price:u.totalPrice,order_id:u.order_id})));const n=(e==null?void 0:e.length)||0,s=(r==null?void 0:r.length)||0,a=(r==null?void 0:r.filter(u=>u.status==="confirmed"&&new Date(u.endDate)>=new Date).length)||0,o=Ie.useMemo(()=>!r||!e?[]:r.map(u=>{const f=e.find(m=>m.id===u.productId);return{...u,product:f}}),[r,e]),i=o?ta(o):[],l=i.filter(u=>u.status==="completed");console.log("AdminDashboard - Completed orders:",l.length),console.log("AdminDashboard - Completed order details:",l.map(u=>({id:u.id,order_id:u.order_id,status:u.status,totalPrice:u.totalPrice,customer:u.customerName,itemCount:u.items.length})));const c=l.reduce((u,f)=>u+(f.totalPrice||0),0);return console.log("AdminDashboard - Order-based revenue calculation:",{completedOrdersCount:l.length,totalRevenue:c,groupedOrdersCount:i.length}),t.jsxs("div",{children:[t.jsx("div",{className:"flex items-center justify-between mb-6",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Дашборд"}),t.jsx("p",{className:"text-muted-foreground",children:"Обзор статистики проката и последних заявок"})]})}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[t.jsx(Bt,{title:"Выручка",value:`${c.toLocaleString()} ₽`,icon:$l,trend:{value:"+12.5%",isPositive:!0,text:"с прошлого месяца"}}),t.jsx(Bt,{title:"Единиц техники",value:n,icon:gl,trend:{value:"+3",isPositive:!0,text:"новых единиц"}}),t.jsx(Bt,{title:"Всего заявок",value:s,icon:Ol,trend:{value:"-2%",isPositive:!1,text:"с прошлой недели"}}),t.jsx(Bt,{title:"Активные брони",value:a,icon:jl,trend:{value:"+2",isPositive:!0,text:"текущие аренды"}})]}),t.jsxs("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2 mt-6",children:[t.jsx(sc,{bookings:o,groupedBookings:i,isLoading:!r}),t.jsx(oc,{bookings:r,totalBookings:s})]})]})},lc=async(e,r)=>{try{console.log("Creating product with data:",e),console.log("Image file:",r);let n="";if(r)try{n=await _t(r),console.log("Image uploaded successfully:",n)}catch(i){console.error("Failed to upload image:",i),n=""}const s={title:e.title,description:e.description||"",price:e.price,category:e.category_id.toString(),category_id:e.category_id,imageurl:n,quantity:e.quantity||1,available:e.available??!0};console.log("Inserting product into database:",s);const{data:a,error:o}=await V.from("products").insert([s]).select().single();if(o)throw console.error("Database error creating product:",o),o;return console.log("Product created successfully:",a),{...a,imageUrl:a.imageurl,category_id:a.category_id}}catch(n){throw console.error("Error creating product:",n),n}},cc=async(e,r,n)=>{try{console.log("Updating product with ID:",e),console.log("Update data:",r),console.log("New image file:",n);let s=r.imageUrl||"";if(n&&n instanceof File)try{s=await _t(n,e),console.log("New image uploaded successfully:",s)}catch(l){console.error("Failed to upload new image:",l),s=r.imageUrl||""}else typeof n=="string"&&(s=n);const a={title:r.title,description:r.description||"",price:r.price,category:r.category_id.toString(),category_id:r.category_id,imageurl:s,quantity:r.quantity||1,available:r.available??!0};console.log("Updating product in database:",a);const{data:o,error:i}=await V.from("products").update(a).eq("id",e).select().single();if(i)throw console.error("Database error updating product:",i),i;return console.log("Product updated successfully:",o),{...o,imageUrl:o.imageurl,category_id:o.category_id}}catch(s){throw console.error("Error updating product:",s),s}},dc=async e=>{try{const{error:r}=await V.from("products").delete().eq("id",e);if(r)throw r;return!0}catch(r){return console.error("Error deleting product:",r),!1}},uc=()=>{const{toast:e}=te(),r=Pe(),[n,s]=d.useState(!1),a=fe({mutationFn:async c=>{var u;s(!0);try{let f=c.imageUrl;return c.imageFile&&c.imageFile instanceof File?f=await _t(c.imageFile):(u=c.imageUrl)!=null&&u.startsWith("http")&&(f=c.imageUrl,console.log("Using external image URL directly:",f)),await lc({...c,imageUrl:f||""},c.imageFile)}finally{s(!1)}},onSuccess:()=>{r.invalidateQueries({queryKey:["products"]}),e({title:"Продукт добавлен",description:"Новый продукт успешно добавлен"})},onError:c=>{e({title:"Ошибка",description:`Не удалось добавить продукт: ${c.message}`,variant:"destructive"})}}),o=fe({mutationFn:async({id:c,data:u})=>{var f;s(!0);try{let m=u.imageUrl,g=u.imageFile;return u.imageFile&&u.imageFile instanceof File?m=await _t(u.imageFile,c):(f=u.imageUrl)!=null&&f.startsWith("http")&&(m=u.imageUrl,console.log("Using external image URL directly:",m)),await cc(c,{...u,imageUrl:m||""},g)}finally{s(!1)}},onSuccess:()=>{r.invalidateQueries({queryKey:["products"]}),e({title:"Продукт обновлен",description:"Продукт успешно обновлен"})},onError:c=>{e({title:"Ошибка",description:`Не удалось обновить продукт: ${c.message}`,variant:"destructive"})}}),i=fe({mutationFn:async c=>{s(!0);try{const u=await dc(c);if(!u)throw new Error(`Failed to delete product with ID ${c}`);return u}finally{s(!1)}},onSuccess:()=>{r.invalidateQueries({queryKey:["products"]}),e({title:"Продукт удален",description:"Продукт успешно удален"})},onError:c=>{e({title:"Ошибка",description:`Не удалось удалить продукт: ${c.message}`,variant:"destructive"})}}),l=async c=>{try{return await i.mutateAsync(c),!0}catch(u){return console.error("Error deleting product:",u),!1}};return{isLoading:n,createProductMutation:a,updateProductMutation:o,deleteProductMutation:i,addProduct:a.mutate,updateProduct:o.mutate,deleteProduct:l}},fc=()=>{const e=oe({queryKey:["products"],queryFn:hi}),r=oe({queryKey:["categories"],queryFn:xt});return{products:e.data||[],categories:r.data||[],isLoadingProducts:e.isLoading}},ra=()=>{const{toast:e}=te(),r=Pe(),[n,s]=d.useState(!1);return{isLoading:n,handleExport:async()=>{try{s(!0);const i=await tc(),l=new Blob([new Uint8Array([239,187,191]),i],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(l),u=document.createElement("a");u.setAttribute("href",c),u.setAttribute("download",`products_export_${new Date().toISOString().split("T")[0]}.csv`),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u),e({title:"Экспорт завершен",description:"Продукты успешно экспортированы в CSV"})}catch(i){e({title:"Ошибка экспорта",description:i instanceof Error?i.message:"Неизвестная ошибка",variant:"destructive"})}finally{s(!1)}},handleImport:async i=>{try{s(!0),console.log(`Starting CSV import for file: ${i.name} (${i.size} bytes)`);const l=await new Promise((u,f)=>{const m=new FileReader;m.onload=g=>{var v;const h=(v=g.target)==null?void 0:v.result;u(h)},m.onerror=g=>{console.error("Error reading CSV file:",g),f(new Error("Failed to read the CSV file"))},m.readAsText(i)});console.log(`File read successfully, size: ${l.length} bytes`),console.log(`First 100 characters: ${l.substring(0,100)}`);const c=await rc(l);console.log(`Import completed successfully. Imported ${c.length} products`),c.length>0&&(console.log("Sample imported product:",c[0]),console.log("Image URL in sample:",c[0].imageurl||"No image URL")),r.invalidateQueries({queryKey:["products"]}),r.invalidateQueries({queryKey:["categories"]}),e({title:"Импорт завершен",description:`Успешно импортировано ${c.length} товаров`})}catch(l){console.error("Error in handleImport:",l),e({title:"Ошибка импорта",description:l instanceof Error?l.message:"Неизвестная ошибка",variant:"destructive"})}finally{s(!1)}}}},mc=()=>{const[e,r]=d.useState(!1),[n,s]=d.useState(null),[a,o]=d.useState(null),{products:i,categories:l,isLoadingProducts:c}=fc(),{isLoading:u,createProductMutation:f,updateProductMutation:m,deleteProductMutation:g}=uc(),{isLoading:h,handleExport:v,handleImport:p}=ra();return{products:i,categories:l,isLoadingProducts:c,isLoading:u||h,openDialog:e,setOpenDialog:r,editProduct:n,setEditProduct:s,imageForProduct:a,setImageForProduct:o,createProductMutation:f,updateProductMutation:m,deleteProductMutation:g,handleEditProduct:w=>{console.log("Setting product for editing:",w),s(w),r(!0)},handleDeleteProduct:w=>{g.mutate(w)},addProduct:async(w,C)=>{console.log("Adding new product:",w);try{const S={...w,imageFile:C instanceof File?C:null,imageUrl:typeof C=="string"?C:w.imageUrl};await f.mutateAsync(S),console.log("Product created successfully")}catch(S){throw console.error("Failed to create product:",S),S}},updateProduct:m.mutate,deleteProduct:g.mutate,handleExport:v,handleImport:p}},na=()=>{const{toast:e}=te(),r=Pe(),[n,s]=d.useState(!1),[a,o]=d.useState(""),[i,l]=d.useState(null),c=fe({mutationFn:async g=>{let h=g.imageUrl;if(i instanceof File)try{h=await zr(i),g.imageUrl=h}catch(v){console.error("Error uploading category image:",v)}return Zt(g)},onSuccess:()=>{r.invalidateQueries({queryKey:["categories"]})}}),u=fe({mutationFn:g=>gi(g),onSuccess:()=>{r.invalidateQueries({queryKey:["categories"]}),e({title:"Порядок категорий обновлен",description:"Порядок категорий успешно сохранен"})},onError:g=>{e({title:"Ошибка",description:`Не удалось обновить порядок категорий: ${g}`,variant:"destructive"})}});return{showCategoryInput:n,setShowCategoryInput:s,newCategoryName:a,setNewCategoryName:o,fileForCategory:i,setFileForCategory:l,addCategoryMutation:c,updateCategoryOrderMutation:u,handleAddCategory:async g=>{try{let h=g.imageUrl;if(i instanceof File)try{h=await zr(i)}catch(b){console.error("Error uploading category image:",b)}const p=(await xt()).reduce((b,y)=>Math.max(b,y.order||0),-1),x=await Zt({name:g.name,slug:g.slug,imageUrl:h||"",order:p+1});if(x)return r.invalidateQueries({queryKey:["categories"]}),s(!1),o(""),l(null),e({title:"Категория добавлена",description:"Новая категория успешно добавлена"}),x}catch(h){e({title:"Ошибка",description:`Не удалось добавить категорию: ${h}`,variant:"destructive"})}return null},handleUpdateCategoriesOrder:g=>{const h=g.map((v,p)=>({id:v.id,order:p}));u.mutate(h)}}},sa=()=>{const[e,r]=d.useState(!1),[n,s]=d.useState(null),[a,o]=d.useState(!0),i=async()=>{try{o(!0),s(null),console.log("Checking storage connection...");const c=await vi();c.products&&c.categories?(console.log("Storage buckets are ready"),r(!0),s(null)):(console.log("Storage buckets not ready:",c.message),r(!1),s(c.message||"Storage buckets not accessible"))}catch(c){console.error("Error checking storage connection:",c),r(!1),s((c==null?void 0:c.message)||"Failed to check storage connection")}finally{o(!1)}},l=c=>{r(c),s(c?null:"Storage initialization failed")};return d.useEffect(()=>{i()},[]),{storageInitialized:e,storageError:n,isCheckingStorage:a,checkStorageConnection:i,handleStorageInitialized:l}};var yn="Dialog",[aa,oa]=Rt(yn),[hc,Ee]=aa(yn),ia=e=>{const{__scopeDialog:r,children:n,open:s,defaultOpen:a,onOpenChange:o,modal:i=!0}=e,l=d.useRef(null),c=d.useRef(null),[u=!1,f]=an({prop:s,defaultProp:a,onChange:o});return t.jsx(hc,{scope:r,triggerRef:l,contentRef:c,contentId:wr(),titleId:wr(),descriptionId:wr(),open:u,onOpenChange:f,onOpenToggle:d.useCallback(()=>f(m=>!m),[f]),modal:i,children:n})};ia.displayName=yn;var la="DialogTrigger",ca=d.forwardRef((e,r)=>{const{__scopeDialog:n,...s}=e,a=Ee(la,n),o=xe(r,a.triggerRef);return t.jsx(he.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":wn(a.open),...s,ref:o,onClick:ne(e.onClick,a.onOpenToggle)})});ca.displayName=la;var bn="DialogPortal",[gc,da]=aa(bn,{forceMount:void 0}),ua=e=>{const{__scopeDialog:r,forceMount:n,children:s,container:a}=e,o=Ee(bn,r);return t.jsx(gc,{scope:r,forceMount:n,children:d.Children.map(s,i=>t.jsx(Ke,{present:n||o.open,children:t.jsx(Ni,{asChild:!0,container:a,children:i})}))})};ua.displayName=bn;var sr="DialogOverlay",fa=d.forwardRef((e,r)=>{const n=da(sr,e.__scopeDialog),{forceMount:s=n.forceMount,...a}=e,o=Ee(sr,e.__scopeDialog);return o.modal?t.jsx(Ke,{present:s||o.open,children:t.jsx(vc,{...a,ref:r})}):null});fa.displayName=sr;var vc=d.forwardRef((e,r)=>{const{__scopeDialog:n,...s}=e,a=Ee(sr,n);return t.jsx(pi,{as:xi,allowPinchZoom:!0,shards:[a.contentRef],children:t.jsx(he.div,{"data-state":wn(a.open),...s,ref:r,style:{pointerEvents:"auto",...s.style}})})}),Ze="DialogContent",ma=d.forwardRef((e,r)=>{const n=da(Ze,e.__scopeDialog),{forceMount:s=n.forceMount,...a}=e,o=Ee(Ze,e.__scopeDialog);return t.jsx(Ke,{present:s||o.open,children:o.modal?t.jsx(pc,{...a,ref:r}):t.jsx(xc,{...a,ref:r})})});ma.displayName=Ze;var pc=d.forwardRef((e,r)=>{const n=Ee(Ze,e.__scopeDialog),s=d.useRef(null),a=xe(r,n.contentRef,s);return d.useEffect(()=>{const o=s.current;if(o)return Ms(o)},[]),t.jsx(ha,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ne(e.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=n.triggerRef.current)==null||i.focus()}),onPointerDownOutside:ne(e.onPointerDownOutside,o=>{const i=o.detail.originalEvent,l=i.button===0&&i.ctrlKey===!0;(i.button===2||l)&&o.preventDefault()}),onFocusOutside:ne(e.onFocusOutside,o=>o.preventDefault())})}),xc=d.forwardRef((e,r)=>{const n=Ee(Ze,e.__scopeDialog),s=d.useRef(!1),a=d.useRef(!1);return t.jsx(ha,{...e,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,l;(i=e.onCloseAutoFocus)==null||i.call(e,o),o.defaultPrevented||(s.current||(l=n.triggerRef.current)==null||l.focus(),o.preventDefault()),s.current=!1,a.current=!1},onInteractOutside:o=>{var c,u;(c=e.onInteractOutside)==null||c.call(e,o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=o.target;((u=n.triggerRef.current)==null?void 0:u.contains(i))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),ha=d.forwardRef((e,r)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:a,onCloseAutoFocus:o,...i}=e,l=Ee(Ze,n),c=d.useRef(null),u=xe(r,c);return yi(),t.jsxs(t.Fragment,{children:[t.jsx(bi,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:a,onUnmountAutoFocus:o,children:t.jsx(ji,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":wn(l.open),...i,ref:u,onDismiss:()=>l.onOpenChange(!1)})}),t.jsxs(t.Fragment,{children:[t.jsx(bc,{titleId:l.titleId}),t.jsx(wc,{contentRef:c,descriptionId:l.descriptionId})]})]})}),jn="DialogTitle",ga=d.forwardRef((e,r)=>{const{__scopeDialog:n,...s}=e,a=Ee(jn,n);return t.jsx(he.h2,{id:a.titleId,...s,ref:r})});ga.displayName=jn;var va="DialogDescription",pa=d.forwardRef((e,r)=>{const{__scopeDialog:n,...s}=e,a=Ee(va,n);return t.jsx(he.p,{id:a.descriptionId,...s,ref:r})});pa.displayName=va;var xa="DialogClose",ya=d.forwardRef((e,r)=>{const{__scopeDialog:n,...s}=e,a=Ee(xa,n);return t.jsx(he.button,{type:"button",...s,ref:r,onClick:ne(e.onClick,()=>a.onOpenChange(!1))})});ya.displayName=xa;function wn(e){return e?"open":"closed"}var ba="DialogTitleWarning",[yc,ja]=wi(ba,{contentName:Ze,titleName:jn,docsSlug:"dialog"}),bc=({titleId:e})=>{const r=ja(ba),n=`\`${r.contentName}\` requires a \`${r.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${r.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${r.docsSlug}`;return d.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},jc="DialogDescriptionWarning",wc=({contentRef:e,descriptionId:r})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ja(jc).contentName}}.`;return d.useEffect(()=>{var o;const a=(o=e.current)==null?void 0:o.getAttribute("aria-describedby");r&&a&&(document.getElementById(r)||console.warn(s))},[s,e,r]),null},wa=ia,Nc=ca,Na=ua,Nn=fa,Cn=ma,Sn=ga,En=pa,Dn=ya;const Ot=wa,Cc=Na,Ca=d.forwardRef(({className:e,...r},n)=>t.jsx(Nn,{ref:n,className:O("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r}));Ca.displayName=Nn.displayName;const yt=d.forwardRef(({className:e,children:r,...n},s)=>t.jsxs(Cc,{children:[t.jsx(Ca,{}),t.jsxs(Cn,{ref:s,className:O("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...n,children:[r,t.jsxs(Dn,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[t.jsx(on,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));yt.displayName=Cn.displayName;const bt=({className:e,...r})=>t.jsx("div",{className:O("flex flex-col space-y-1.5 text-center sm:text-left",e),...r});bt.displayName="DialogHeader";const Sa=({className:e,...r})=>t.jsx("div",{className:O("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...r});Sa.displayName="DialogFooter";const jt=d.forwardRef(({className:e,...r},n)=>t.jsx(Sn,{ref:n,className:O("text-lg font-semibold leading-none tracking-tight",e),...r}));jt.displayName=Sn.displayName;const Sc=d.forwardRef(({className:e,...r},n)=>t.jsx(En,{ref:n,className:O("text-sm text-muted-foreground",e),...r}));Sc.displayName=En.displayName;var _n="Switch",[Ec,kh]=Rt(_n),[Dc,_c]=Ec(_n),Ea=d.forwardRef((e,r)=>{const{__scopeSwitch:n,name:s,checked:a,defaultChecked:o,required:i,disabled:l,value:c="on",onCheckedChange:u,form:f,...m}=e,[g,h]=d.useState(null),v=xe(r,j=>h(j)),p=d.useRef(!1),x=g?f||!!g.closest("form"):!0,[b=!1,y]=an({prop:a,defaultProp:o,onChange:u});return t.jsxs(Dc,{scope:n,checked:b,disabled:l,children:[t.jsx(he.button,{type:"button",role:"switch","aria-checked":b,"aria-required":i,"data-state":Pa(b),"data-disabled":l?"":void 0,disabled:l,value:c,...m,ref:v,onClick:ne(e.onClick,j=>{y(w=>!w),x&&(p.current=j.isPropagationStopped(),p.current||j.stopPropagation())})}),x&&t.jsx(Pc,{control:g,bubbles:!p.current,name:s,value:c,checked:b,required:i,disabled:l,form:f,style:{transform:"translateX(-100%)"}})]})});Ea.displayName=_n;var Da="SwitchThumb",_a=d.forwardRef((e,r)=>{const{__scopeSwitch:n,...s}=e,a=_c(Da,n);return t.jsx(he.span,{"data-state":Pa(a.checked),"data-disabled":a.disabled?"":void 0,...s,ref:r})});_a.displayName=Da;var Pc=e=>{const{control:r,checked:n,bubbles:s=!0,...a}=e,o=d.useRef(null),i=Rs(n),l=$s(r);return d.useEffect(()=>{const c=o.current,u=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(u,"checked").set;if(i!==n&&m){const g=new Event("click",{bubbles:s});m.call(c,n),c.dispatchEvent(g)}},[i,n,s]),t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:o,style:{...e.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Pa(e){return e?"checked":"unchecked"}var ka=Ea,kc=_a;const Pn=d.forwardRef(({className:e,...r},n)=>t.jsx(ka,{className:O("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...r,ref:n,children:t.jsx(kc,{className:O("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Pn.displayName=ka.displayName;function Mc({form:e,categories:r,showCategoryInput:n,setShowCategoryInput:s,newCategoryName:a,setNewCategoryName:o,handleNewCategory:i,isAddingCategory:l}){return n?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ze,{children:"Новая категория"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ie,{value:a,onChange:c=>o(c.target.value),placeholder:"Название категории"}),t.jsx(R,{type:"button",onClick:i,disabled:l||!a.trim(),children:l?t.jsx(Y,{className:"h-4 w-4 animate-spin"}):"Добавить"}),t.jsx(R,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Отмена"})]})]}):t.jsx(St,{control:e.control,name:"category_id",render:({field:c})=>t.jsxs(Et,{children:[t.jsx(ze,{children:"Категория"}),t.jsxs("div",{className:"flex gap-2 items-end",children:[t.jsx(mt,{className:"flex-1",children:t.jsxs("select",{...c,value:c.value||"",onChange:u=>c.onChange(u.target.value?parseInt(u.target.value):null),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",children:[t.jsx("option",{value:"",children:"Выберите категорию"}),r.map(u=>t.jsx("option",{value:u.category_id,children:u.name},u.id))]})}),t.jsx(R,{type:"button",variant:"outline",onClick:()=>s(!0),children:"Новая"})]}),t.jsx(nr,{})]})})}function Rc({isSubmitting:e,onCancel:r}){return t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(R,{type:"button",variant:"outline",onClick:r,children:"Отмена"}),t.jsx(R,{type:"submit",disabled:e,children:e?t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранение..."]}):"Сохранить"})]})}function $c({error:e,isCheckingStorage:r,onCheckStorage:n}){return t.jsxs(Be,{variant:"destructive",className:"mb-4",children:[t.jsx(Jt,{className:"h-4 w-4"}),t.jsx(Ct,{children:"Проблема с хранилищем изображений"}),t.jsxs(Ve,{children:[e||"Возникли проблемы с хранилищем изображений. Загрузка новых изображений может быть недоступна.",t.jsx("div",{className:"mt-2",children:t.jsx(R,{type:"button",size:"sm",onClick:n,disabled:r,children:r?t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"})," Проверка..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Jt,{className:"mr-2 h-4 w-4"})," Проверить соединение"]})})})]})]})}function dt({form:e,name:r,label:n,children:s,description:a}){return t.jsx(St,{control:e.control,name:r,render:({field:o})=>t.jsx(Et,{className:r==="available"?"flex flex-row items-center justify-between rounded-lg border p-4":"",children:r==="available"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsx(ze,{className:"text-base",children:n}),a&&t.jsx("div",{className:"text-sm text-muted-foreground",children:a})]}),t.jsx(mt,{children:Ie.cloneElement(s,{checked:o.value,onCheckedChange:i=>{console.log("Switch toggled:",i),o.onChange(i)}})})]}):t.jsxs(t.Fragment,{children:[t.jsx(ze,{children:n}),t.jsx(mt,{children:Ie.cloneElement(s,{...o})}),a&&t.jsx("div",{className:"text-sm text-muted-foreground",children:a}),t.jsx(nr,{})]})})})}function Ic({previewUrl:e,imageError:r,handleImageError:n,className:s=""}){return t.jsx(t.Fragment,{children:e&&!r?t.jsx("div",{className:`w-14 h-14 rounded bg-gray-200 bg-cover bg-center border flex items-center justify-center overflow-hidden ${s}`,children:t.jsx("img",{src:e,alt:"Preview",className:"w-full h-full object-cover",onError:n})}):t.jsx("div",{className:`w-14 h-14 flex items-center justify-center rounded border border-dashed bg-muted ${s}`,children:r?t.jsx(Is,{className:"h-6 w-6 text-destructive"}):t.jsx(As,{className:"h-6 w-6 opacity-60"})})})}function Ac({previewUrl:e,onChange:r,disabled:n=!1,onError:s}){const a=d.useRef(null),[o,i]=d.useState(!1),[l,c]=d.useState(!1),u=()=>{console.error(`Failed to load image from URL: ${e}`),c(!0),s&&s(new Error(`Failed to load image from URL: ${e}`))},f=async m=>{var g;if((g=m.target.files)!=null&&g[0]){const h=m.target.files[0];i(!0);try{if(!["image/jpeg","image/png","image/gif","image/webp"].includes(h.type))throw new Error("Unsupported file type. Please use JPEG, PNG, GIF or WEBP.");if(h.size>5*1024*1024)throw new Error("File size too large. Maximum size is 5MB.");r(h),c(!1)}catch(v){console.error("Error processing image file:",v),s&&v instanceof Error&&s(v),c(!0)}finally{i(!1),m.target.value=""}}};return t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ic,{previewUrl:e,imageError:l,handleImageError:u}),t.jsx("input",{ref:a,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",className:"hidden",onChange:f,disabled:n||o}),t.jsx(R,{type:"button",size:"sm",className:"flex items-center gap-1",onClick:()=>{var m;return(m=a.current)==null?void 0:m.click()},disabled:n||o,children:o?t.jsxs("span",{className:"flex items-center",children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Загрузка..."]}):t.jsxs(t.Fragment,{children:[t.jsx(gn,{className:"h-4 w-4"}),e?"Изменить":"Загрузить"]})})]})}function Oc({onChange:e,disabled:r=!1,onError:n}){const[s,a]=d.useState(""),[o,i]=d.useState(!1),[l,c]=d.useState(!1),[u,f]=d.useState(null),m=()=>{c(!0),n&&n(new Error(`Failed to load image from URL: ${s}`))},g=()=>{if(s){i(!0);try{if(!/^(https?:\/\/)/i.test(s))throw new Error("Please enter a valid URL starting with http:// or https://");const v=new window.Image;v.onload=()=>{e(s),f(s),c(!1),i(!1)},v.onerror=()=>{n&&n(new Error("Invalid image URL or image could not be loaded")),c(!0),i(!1)},v.src=s}catch(h){console.error("Error processing image URL:",h),n&&h instanceof Error&&n(h),c(!0),i(!1)}}};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ie,{placeholder:"https://example.com/image.jpg",value:s,onChange:h=>a(h.target.value),disabled:r||o}),t.jsx(R,{type:"button",size:"sm",onClick:g,disabled:r||o||!s,children:o?t.jsxs("span",{className:"flex items-center",children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Загрузка..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Pl,{className:"h-4 w-4 mr-2"}),"Применить"]})})]}),s&&u&&!o&&t.jsx("div",{className:"mt-2 w-full h-20 rounded border overflow-hidden",children:t.jsx("img",{src:s,alt:"Preview",className:"w-full h-full object-contain",onError:m})}),l&&t.jsx("p",{className:"text-sm text-destructive mt-1",children:"Не удалось загрузить изображение. Пожалуйста, проверьте URL-адрес."})]})}function ur({label:e,onChange:r,previewUrl:n,disabled:s,className:a,onError:o}){const[i,l]=d.useState(!1),[c,u]=d.useState("file");d.useEffect(()=>{n&&l(!1)},[n]);const f=h=>{r(h)},m=h=>{r(h)},g=h=>{l(!0),o&&o(h)};return t.jsxs("div",{className:`space-y-2 ${a||""}`,children:[e&&t.jsx("span",{className:"block text-sm",children:e}),t.jsxs($t,{defaultValue:"file",onValueChange:h=>u(h),children:[t.jsxs(It,{className:"grid w-full grid-cols-2",children:[t.jsx(ee,{value:"file",children:"Файл"}),t.jsx(ee,{value:"link",children:"Ссылка"})]}),t.jsx(G,{value:"file",className:"space-y-4 pt-4",children:t.jsx(Ac,{previewUrl:n,onChange:f,disabled:s,onError:g})}),t.jsx(G,{value:"link",className:"space-y-4 pt-4",children:t.jsx(Oc,{onChange:m,disabled:s,onError:g})})]}),i&&t.jsx("p",{className:"text-sm text-destructive mt-1",children:"Не удалось загрузить изображение. Пожалуйста, попробуйте другой файл или ссылку."})]})}function Tc({form:e,imageForProduct:r,setImageForProduct:n,isCheckingStorage:s,isSubmitting:a}){const[o,i]=d.useState(null);d.useEffect(()=>(typeof r=="string"?i(r):r instanceof File?i(URL.createObjectURL(r)):i(e.getValues("imageUrl")||null),()=>{r instanceof File&&o&&URL.revokeObjectURL(o)}),[r,e]);const l=c=>{console.log("New image selected:",typeof c=="string"?"URL: "+c:"File: "+c.name),n(c)};return t.jsx(dt,{form:e,name:"imageUrl",label:"Изображение",children:t.jsxs("div",{children:[t.jsx(ur,{onChange:l,previewUrl:o,disabled:a||s}),t.jsx("input",{type:"hidden",...e.register("imageUrl")})]})})}const Ma=be.object({title:be.string().min(2,{message:"Название должно содержать минимум 2 символа"}),description:be.string().optional(),price:be.coerce.number().min(1,{message:"Цена должна быть больше 0"}),category_id:be.coerce.number().min(1,{message:"Выберите категорию"}),imageUrl:be.string().optional(),quantity:be.coerce.number().min(1,{message:"Количество должно быть больше 0"}),available:be.boolean().default(!0)}),Fc=(e,r,n)=>{const{toast:s}=te(),[a,o]=d.useState(!1),[i,l]=d.useState(""),[c,u]=d.useState(!1),f=fn({resolver:mn(Ma),defaultValues:{title:"",description:"",price:0,category_id:0,imageUrl:"",quantity:1,available:!0}});return d.useEffect(()=>{e?(console.log("Setting form values for edit product:",e),console.log("Edit product available status:",e.available),f.reset({title:e.title||"",description:e.description||"",price:e.price||0,category_id:e.category_id||0,imageUrl:e.imageUrl||"",quantity:e.quantity||1,available:e.available??!0})):(console.log("Resetting form for new product"),f.reset({title:"",description:"",price:0,category_id:0,imageUrl:"",quantity:1,available:!0}))},[e,f]),{form:f,showCategoryInput:a,setShowCategoryInput:o,newCategoryName:i,setNewCategoryName:l,isAddingCategory:c,handleNewCategory:async()=>{u(!0);try{if(!i.trim()){s({title:"Ошибка",description:"Введите название категории",variant:"destructive"});return}const h=i.toLowerCase().replace(/\s+/g,"-");s({title:"Функция в разработке",description:"Создание новых категорий будет добавлено позже",variant:"destructive"}),o(!1),l("")}catch(h){s({title:"Ошибка",description:`Не удалось добавить категорию: ${h}`,variant:"destructive"})}finally{u(!1)}},handleFormSubmit:h=>{console.log("Form submitted with values:",h),console.log("Available status being submitted:",h.available),r(h)}}};function Lc({editProduct:e,categories:r,isSubmitting:n,onSubmit:s,onCancel:a}){const{toast:o}=te(),[i,l]=d.useState(null),{storageInitialized:c,storageError:u,isCheckingStorage:f,checkStorageConnection:m}=sa(),g=C=>{console.log("Form submitted with values:",C),console.log("Available field value:",C.available),console.log("Image for product:",i),i&&i instanceof File&&!c&&o({title:"Предупреждение",description:"Хранилище для изображений не готово. Изображение может не быть загружено.",variant:"warning"}),s(C,i)},{form:h,showCategoryInput:v,setShowCategoryInput:p,newCategoryName:x,setNewCategoryName:b,isAddingCategory:y,handleNewCategory:j,handleFormSubmit:w}=Fc(e,g);return d.useEffect(()=>{e&&(console.log("ProductForm received editProduct:",e),console.log("editProduct.available:",e.available))},[e]),d.useEffect(()=>{const C=h.watch((S,{name:P})=>{P==="available"&&console.log("Available field changed to:",S.available)});return()=>C.unsubscribe()},[h]),t.jsx(Ys,{...h,children:t.jsxs("form",{onSubmit:h.handleSubmit(w),className:"space-y-4",children:[u&&!(i!=null&&i.toString().startsWith("http"))&&t.jsx($c,{error:u,isCheckingStorage:f,onCheckStorage:m}),t.jsx(dt,{form:h,name:"title",label:"Название",children:t.jsx(ie,{})}),t.jsx(dt,{form:h,name:"description",label:"Описание",children:t.jsx(Qs,{})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(dt,{form:h,name:"price",label:"Цена (₽)",children:t.jsx(ie,{type:"number"})}),t.jsx(dt,{form:h,name:"quantity",label:"Количество",children:t.jsx(ie,{type:"number"})})]}),t.jsx(Mc,{form:h,categories:r,showCategoryInput:v,setShowCategoryInput:p,newCategoryName:x,setNewCategoryName:b,handleNewCategory:j,isAddingCategory:y}),t.jsx(Tc,{form:h,imageForProduct:i,setImageForProduct:l,isCheckingStorage:f,isSubmitting:n}),t.jsx(dt,{form:h,name:"available",label:"Доступность",description:"Товар доступен для бронирования",children:t.jsx(Pn,{})}),t.jsx(Rc,{isSubmitting:n,onCancel:a})]})})}function Uc(e,r){return d.useReducer((n,s)=>r[n][s]??n,e)}var kn="ScrollArea",[Ra,Mh]=Rt(kn),[qc,je]=Ra(kn),$a=d.forwardRef((e,r)=>{const{__scopeScrollArea:n,type:s="hover",dir:a,scrollHideDelay:o=600,...i}=e,[l,c]=d.useState(null),[u,f]=d.useState(null),[m,g]=d.useState(null),[h,v]=d.useState(null),[p,x]=d.useState(null),[b,y]=d.useState(0),[j,w]=d.useState(0),[C,S]=d.useState(!1),[P,_]=d.useState(!1),D=xe(r,E=>c(E)),F=Ci(a);return t.jsx(qc,{scope:n,type:s,dir:F,scrollHideDelay:o,scrollArea:l,viewport:u,onViewportChange:f,content:m,onContentChange:g,scrollbarX:h,onScrollbarXChange:v,scrollbarXEnabled:C,onScrollbarXEnabledChange:S,scrollbarY:p,onScrollbarYChange:x,scrollbarYEnabled:P,onScrollbarYEnabledChange:_,onCornerWidthChange:y,onCornerHeightChange:w,children:t.jsx(he.div,{dir:F,...i,ref:D,style:{position:"relative","--radix-scroll-area-corner-width":b+"px","--radix-scroll-area-corner-height":j+"px",...e.style}})})});$a.displayName=kn;var Ia="ScrollAreaViewport",Aa=d.forwardRef((e,r)=>{const{__scopeScrollArea:n,children:s,asChild:a,nonce:o,...i}=e,l=je(Ia,n),c=d.useRef(null),u=xe(r,c,l.onViewportChange);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:o}),t.jsx(he.div,{"data-radix-scroll-area-viewport":"",...i,asChild:a,ref:u,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...e.style},children:Gc({asChild:a,children:s},f=>t.jsx("div",{"data-radix-scroll-area-content":"",ref:l.onContentChange,style:{minWidth:l.scrollbarXEnabled?"fit-content":void 0},children:f}))})]})});Aa.displayName=Ia;var ke="ScrollAreaScrollbar",Mn=d.forwardRef((e,r)=>{const{forceMount:n,...s}=e,a=je(ke,e.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:i}=a,l=e.orientation==="horizontal";return d.useEffect(()=>(l?o(!0):i(!0),()=>{l?o(!1):i(!1)}),[l,o,i]),a.type==="hover"?t.jsx(Wc,{...s,ref:r,forceMount:n}):a.type==="scroll"?t.jsx(zc,{...s,ref:r,forceMount:n}):a.type==="auto"?t.jsx(Oa,{...s,ref:r,forceMount:n}):a.type==="always"?t.jsx(Rn,{...s,ref:r}):null});Mn.displayName=ke;var Wc=d.forwardRef((e,r)=>{const{forceMount:n,...s}=e,a=je(ke,e.__scopeScrollArea),[o,i]=d.useState(!1);return d.useEffect(()=>{const l=a.scrollArea;let c=0;if(l){const u=()=>{window.clearTimeout(c),i(!0)},f=()=>{c=window.setTimeout(()=>i(!1),a.scrollHideDelay)};return l.addEventListener("pointerenter",u),l.addEventListener("pointerleave",f),()=>{window.clearTimeout(c),l.removeEventListener("pointerenter",u),l.removeEventListener("pointerleave",f)}}},[a.scrollArea,a.scrollHideDelay]),t.jsx(Ke,{present:n||o,children:t.jsx(Oa,{"data-state":o?"visible":"hidden",...s,ref:r})})}),zc=d.forwardRef((e,r)=>{const{forceMount:n,...s}=e,a=je(ke,e.__scopeScrollArea),o=e.orientation==="horizontal",i=mr(()=>c("SCROLL_END"),100),[l,c]=Uc("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return d.useEffect(()=>{if(l==="idle"){const u=window.setTimeout(()=>c("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(u)}},[l,a.scrollHideDelay,c]),d.useEffect(()=>{const u=a.viewport,f=o?"scrollLeft":"scrollTop";if(u){let m=u[f];const g=()=>{const h=u[f];m!==h&&(c("SCROLL"),i()),m=h};return u.addEventListener("scroll",g),()=>u.removeEventListener("scroll",g)}},[a.viewport,o,c,i]),t.jsx(Ke,{present:n||l!=="hidden",children:t.jsx(Rn,{"data-state":l==="hidden"?"hidden":"visible",...s,ref:r,onPointerEnter:ne(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:ne(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Oa=d.forwardRef((e,r)=>{const n=je(ke,e.__scopeScrollArea),{forceMount:s,...a}=e,[o,i]=d.useState(!1),l=e.orientation==="horizontal",c=mr(()=>{if(n.viewport){const u=n.viewport.offsetWidth<n.viewport.scrollWidth,f=n.viewport.offsetHeight<n.viewport.scrollHeight;i(l?u:f)}},10);return pt(n.viewport,c),pt(n.content,c),t.jsx(Ke,{present:s||o,children:t.jsx(Rn,{"data-state":o?"visible":"hidden",...a,ref:r})})}),Rn=d.forwardRef((e,r)=>{const{orientation:n="vertical",...s}=e,a=je(ke,e.__scopeScrollArea),o=d.useRef(null),i=d.useRef(0),[l,c]=d.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=qa(l.viewport,l.content),f={...s,sizes:l,onSizesChange:c,hasThumb:u>0&&u<1,onThumbChange:g=>o.current=g,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:g=>i.current=g};function m(g,h){return Qc(g,i.current,l,h)}return n==="horizontal"?t.jsx(Bc,{...f,ref:r,onThumbPositionChange:()=>{if(a.viewport&&o.current){const g=a.viewport.scrollLeft,h=ls(g,l,a.dir);o.current.style.transform=`translate3d(${h}px, 0, 0)`}},onWheelScroll:g=>{a.viewport&&(a.viewport.scrollLeft=g)},onDragScroll:g=>{a.viewport&&(a.viewport.scrollLeft=m(g,a.dir))}}):n==="vertical"?t.jsx(Vc,{...f,ref:r,onThumbPositionChange:()=>{if(a.viewport&&o.current){const g=a.viewport.scrollTop,h=ls(g,l);o.current.style.transform=`translate3d(0, ${h}px, 0)`}},onWheelScroll:g=>{a.viewport&&(a.viewport.scrollTop=g)},onDragScroll:g=>{a.viewport&&(a.viewport.scrollTop=m(g))}}):null}),Bc=d.forwardRef((e,r)=>{const{sizes:n,onSizesChange:s,...a}=e,o=je(ke,e.__scopeScrollArea),[i,l]=d.useState(),c=d.useRef(null),u=xe(r,c,o.onScrollbarXChange);return d.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),t.jsx(Fa,{"data-orientation":"horizontal",...a,ref:u,sizes:n,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":fr(n)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.x),onDragScroll:f=>e.onDragScroll(f.x),onWheelScroll:(f,m)=>{if(o.viewport){const g=o.viewport.scrollLeft+f.deltaX;e.onWheelScroll(g),za(g,m)&&f.preventDefault()}},onResize:()=>{c.current&&o.viewport&&i&&s({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:or(i.paddingLeft),paddingEnd:or(i.paddingRight)}})}})}),Vc=d.forwardRef((e,r)=>{const{sizes:n,onSizesChange:s,...a}=e,o=je(ke,e.__scopeScrollArea),[i,l]=d.useState(),c=d.useRef(null),u=xe(r,c,o.onScrollbarYChange);return d.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),t.jsx(Fa,{"data-orientation":"vertical",...a,ref:u,sizes:n,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":fr(n)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.y),onDragScroll:f=>e.onDragScroll(f.y),onWheelScroll:(f,m)=>{if(o.viewport){const g=o.viewport.scrollTop+f.deltaY;e.onWheelScroll(g),za(g,m)&&f.preventDefault()}},onResize:()=>{c.current&&o.viewport&&i&&s({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:or(i.paddingTop),paddingEnd:or(i.paddingBottom)}})}})}),[Hc,Ta]=Ra(ke),Fa=d.forwardRef((e,r)=>{const{__scopeScrollArea:n,sizes:s,hasThumb:a,onThumbChange:o,onThumbPointerUp:i,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:u,onWheelScroll:f,onResize:m,...g}=e,h=je(ke,n),[v,p]=d.useState(null),x=xe(r,D=>p(D)),b=d.useRef(null),y=d.useRef(""),j=h.viewport,w=s.content-s.viewport,C=Xe(f),S=Xe(c),P=mr(m,10);function _(D){if(b.current){const F=D.clientX-b.current.left,E=D.clientY-b.current.top;u({x:F,y:E})}}return d.useEffect(()=>{const D=F=>{const E=F.target;(v==null?void 0:v.contains(E))&&C(F,w)};return document.addEventListener("wheel",D,{passive:!1}),()=>document.removeEventListener("wheel",D,{passive:!1})},[j,v,w,C]),d.useEffect(S,[s,S]),pt(v,P),pt(h.content,P),t.jsx(Hc,{scope:n,scrollbar:v,hasThumb:a,onThumbChange:Xe(o),onThumbPointerUp:Xe(i),onThumbPositionChange:S,onThumbPointerDown:Xe(l),children:t.jsx(he.div,{...g,ref:x,style:{position:"absolute",...g.style},onPointerDown:ne(e.onPointerDown,D=>{D.button===0&&(D.target.setPointerCapture(D.pointerId),b.current=v.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),_(D))}),onPointerMove:ne(e.onPointerMove,_),onPointerUp:ne(e.onPointerUp,D=>{const F=D.target;F.hasPointerCapture(D.pointerId)&&F.releasePointerCapture(D.pointerId),document.body.style.webkitUserSelect=y.current,h.viewport&&(h.viewport.style.scrollBehavior=""),b.current=null})})})}),ar="ScrollAreaThumb",La=d.forwardRef((e,r)=>{const{forceMount:n,...s}=e,a=Ta(ar,e.__scopeScrollArea);return t.jsx(Ke,{present:n||a.hasThumb,children:t.jsx(Kc,{ref:r,...s})})}),Kc=d.forwardRef((e,r)=>{const{__scopeScrollArea:n,style:s,...a}=e,o=je(ar,n),i=Ta(ar,n),{onThumbPositionChange:l}=i,c=xe(r,m=>i.onThumbChange(m)),u=d.useRef(),f=mr(()=>{u.current&&(u.current(),u.current=void 0)},100);return d.useEffect(()=>{const m=o.viewport;if(m){const g=()=>{if(f(),!u.current){const h=Xc(m,l);u.current=h,l()}};return l(),m.addEventListener("scroll",g),()=>m.removeEventListener("scroll",g)}},[o.viewport,f,l]),t.jsx(he.div,{"data-state":i.hasThumb?"visible":"hidden",...a,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:ne(e.onPointerDownCapture,m=>{const h=m.target.getBoundingClientRect(),v=m.clientX-h.left,p=m.clientY-h.top;i.onThumbPointerDown({x:v,y:p})}),onPointerUp:ne(e.onPointerUp,i.onThumbPointerUp)})});La.displayName=ar;var $n="ScrollAreaCorner",Ua=d.forwardRef((e,r)=>{const n=je($n,e.__scopeScrollArea),s=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&s?t.jsx(Yc,{...e,ref:r}):null});Ua.displayName=$n;var Yc=d.forwardRef((e,r)=>{const{__scopeScrollArea:n,...s}=e,a=je($n,n),[o,i]=d.useState(0),[l,c]=d.useState(0),u=!!(o&&l);return pt(a.scrollbarX,()=>{var m;const f=((m=a.scrollbarX)==null?void 0:m.offsetHeight)||0;a.onCornerHeightChange(f),c(f)}),pt(a.scrollbarY,()=>{var m;const f=((m=a.scrollbarY)==null?void 0:m.offsetWidth)||0;a.onCornerWidthChange(f),i(f)}),u?t.jsx(he.div,{...s,ref:r,style:{width:o,height:l,position:"absolute",right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function or(e){return e?parseInt(e,10):0}function qa(e,r){const n=e/r;return isNaN(n)?0:n}function fr(e){const r=qa(e.viewport,e.content),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=(e.scrollbar.size-n)*r;return Math.max(s,18)}function Qc(e,r,n,s="ltr"){const a=fr(n),o=a/2,i=r||o,l=a-i,c=n.scrollbar.paddingStart+i,u=n.scrollbar.size-n.scrollbar.paddingEnd-l,f=n.content-n.viewport,m=s==="ltr"?[0,f]:[f*-1,0];return Wa([c,u],m)(e)}function ls(e,r,n="ltr"){const s=fr(r),a=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,o=r.scrollbar.size-a,i=r.content-r.viewport,l=o-s,c=n==="ltr"?[0,i]:[i*-1,0],u=Ei(e,c);return Wa([0,i],[0,l])(u)}function Wa(e,r){return n=>{if(e[0]===e[1]||r[0]===r[1])return r[0];const s=(r[1]-r[0])/(e[1]-e[0]);return r[0]+s*(n-e[0])}}function za(e,r){return e>0&&e<r}var Xc=(e,r=()=>{})=>{let n={left:e.scrollLeft,top:e.scrollTop},s=0;return function a(){const o={left:e.scrollLeft,top:e.scrollTop},i=n.left!==o.left,l=n.top!==o.top;(i||l)&&r(),n=o,s=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(s)};function mr(e,r){const n=Xe(e),s=d.useRef(0);return d.useEffect(()=>()=>window.clearTimeout(s.current),[]),d.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(n,r)},[n,r])}function pt(e,r){const n=Xe(r);Si(()=>{let s=0;if(e){const a=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(n)});return a.observe(e),()=>{window.cancelAnimationFrame(s),a.unobserve(e)}}},[e,n])}function Gc(e,r){const{asChild:n,children:s}=e;if(!n)return typeof r=="function"?r(s):r;const a=d.Children.only(s);return d.cloneElement(a,{children:typeof r=="function"?r(a.props.children):r})}var Ba=$a,Zc=Aa,Jc=Ua;const In=d.forwardRef(({className:e,children:r,...n},s)=>t.jsxs(Ba,{ref:s,className:O("relative overflow-hidden",e),...n,children:[t.jsx(Zc,{className:"h-full w-full rounded-[inherit]",children:r}),t.jsx(Va,{}),t.jsx(Jc,{})]}));In.displayName=Ba.displayName;const Va=d.forwardRef(({className:e,orientation:r="vertical",...n},s)=>t.jsx(Mn,{ref:s,orientation:r,className:O("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...n,children:t.jsx(La,{className:"relative flex-1 rounded-full bg-border"})}));Va.displayName=Mn.displayName;function ed({open:e,setOpen:r,editProduct:n,categories:s,fileForProduct:a,setFileForProduct:o,createPending:i,updatePending:l,onSubmit:c}){const u=i||l,f=()=>{r(!1),o(null)},m=h=>{console.log("Dialog submitting form:",h),c(h,a)},g=()=>{console.log("Opening product dialog for:",n?"edit":"create"),r(!0)};return t.jsxs("div",{children:[t.jsxs(R,{onClick:g,children:[t.jsx(cr,{className:"mr-2 h-4 w-4"})," Добавить товар"]}),t.jsx(Ot,{open:e,onOpenChange:r,children:t.jsxs(yt,{className:"sm:max-w-[550px] max-h-[90vh]",children:[t.jsx(bt,{children:t.jsx(jt,{children:n?"Редактировать товар":"Добавить товар"})}),e&&t.jsx(In,{className:"max-h-[70vh]",children:t.jsx("div",{className:"pr-4",children:t.jsx(Lc,{editProduct:n,categories:s||[],isSubmitting:u,onSubmit:m,onCancel:f})})})]})})]})}function td({openDialog:e,setOpenDialog:r,editProduct:n,categories:s,showCategoryInput:a,setShowCategoryInput:o,newCategoryName:i,setNewCategoryName:l,fileForProduct:c,setFileForProduct:u,fileForCategory:f,setFileForCategory:m,addCategoryMutation:g,onSubmit:h,handleAddCategory:v,createPending:p,updatePending:x}){const b=fn({resolver:mn(Ma),defaultValues:{title:"",description:"",price:0,category_id:0,imageUrl:"",quantity:1,available:!0}});return t.jsx(ed,{open:e,setOpen:r,editProduct:n,form:b,categories:s||[],showCategoryInput:a,setShowCategoryInput:o,newCategoryName:i,setNewCategoryName:l,fileForProduct:c,setFileForProduct:u,fileForCategory:f,setFileForCategory:m,addCategoryMutation:g,onSubmit:h,handleAddCategory:v,createPending:p,updatePending:x})}const hr=d.forwardRef(({className:e,...r},n)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:n,className:O("w-full caption-bottom text-sm",e),...r})}));hr.displayName="Table";const gr=d.forwardRef(({className:e,...r},n)=>t.jsx("thead",{ref:n,className:O("[&_tr]:border-b",e),...r}));gr.displayName="TableHeader";const vr=d.forwardRef(({className:e,...r},n)=>t.jsx("tbody",{ref:n,className:O("[&_tr:last-child]:border-0",e),...r}));vr.displayName="TableBody";const rd=d.forwardRef(({className:e,...r},n)=>t.jsx("tfoot",{ref:n,className:O("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r}));rd.displayName="TableFooter";const _e=d.forwardRef(({className:e,...r},n)=>t.jsx("tr",{ref:n,className:O("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));_e.displayName="TableRow";const J=d.forwardRef(({className:e,...r},n)=>t.jsx("th",{ref:n,className:O("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...r}));J.displayName="TableHead";const K=d.forwardRef(({className:e,...r},n)=>t.jsx("td",{ref:n,className:O("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...r}));K.displayName="TableCell";const nd=d.forwardRef(({className:e,...r},n)=>t.jsx("caption",{ref:n,className:O("mt-4 text-sm text-muted-foreground",e),...r}));nd.displayName="TableCaption";var An="Checkbox",[sd,Rh]=Rt(An),[ad,od]=sd(An),Ha=d.forwardRef((e,r)=>{const{__scopeCheckbox:n,name:s,checked:a,defaultChecked:o,required:i,disabled:l,value:c="on",onCheckedChange:u,form:f,...m}=e,[g,h]=d.useState(null),v=xe(r,w=>h(w)),p=d.useRef(!1),x=g?f||!!g.closest("form"):!0,[b=!1,y]=an({prop:a,defaultProp:o,onChange:u}),j=d.useRef(b);return d.useEffect(()=>{const w=g==null?void 0:g.form;if(w){const C=()=>y(j.current);return w.addEventListener("reset",C),()=>w.removeEventListener("reset",C)}},[g,y]),t.jsxs(ad,{scope:n,state:b,disabled:l,children:[t.jsx(he.button,{type:"button",role:"checkbox","aria-checked":He(b)?"mixed":b,"aria-required":i,"data-state":Qa(b),"data-disabled":l?"":void 0,disabled:l,value:c,...m,ref:v,onKeyDown:ne(e.onKeyDown,w=>{w.key==="Enter"&&w.preventDefault()}),onClick:ne(e.onClick,w=>{y(C=>He(C)?!0:!C),x&&(p.current=w.isPropagationStopped(),p.current||w.stopPropagation())})}),x&&t.jsx(id,{control:g,bubbles:!p.current,name:s,value:c,checked:b,required:i,disabled:l,form:f,style:{transform:"translateX(-100%)"},defaultChecked:He(o)?!1:o})]})});Ha.displayName=An;var Ka="CheckboxIndicator",Ya=d.forwardRef((e,r)=>{const{__scopeCheckbox:n,forceMount:s,...a}=e,o=od(Ka,n);return t.jsx(Ke,{present:s||He(o.state)||o.state===!0,children:t.jsx(he.span,{"data-state":Qa(o.state),"data-disabled":o.disabled?"":void 0,...a,ref:r,style:{pointerEvents:"none",...e.style}})})});Ya.displayName=Ka;var id=e=>{const{control:r,checked:n,bubbles:s=!0,defaultChecked:a,...o}=e,i=d.useRef(null),l=Rs(n),c=$s(r);d.useEffect(()=>{const f=i.current,m=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(m,"checked").set;if(l!==n&&h){const v=new Event("click",{bubbles:s});f.indeterminate=He(n),h.call(f,He(n)?!1:n),f.dispatchEvent(v)}},[l,n,s]);const u=d.useRef(He(n)?!1:n);return t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a??u.current,...o,tabIndex:-1,ref:i,style:{...e.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function He(e){return e==="indeterminate"}function Qa(e){return He(e)?"indeterminate":e?"checked":"unchecked"}var Xa=Ha,ld=Ya;const On=d.forwardRef(({className:e,...r},n)=>t.jsx(Xa,{ref:n,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...r,children:t.jsx(ld,{className:O("flex items-center justify-center text-current"),children:t.jsx(ln,{className:"h-4 w-4"})})}));On.displayName=Xa.displayName;function cd({value:e,onChange:r,options:n,disabled:s}){const[a,o]=d.useState(!1),i=n.find(l=>l.value===e);return t.jsxs("div",{className:"relative",children:[t.jsx(R,{variant:"ghost",size:"sm",className:"px-2",onClick:()=>o(l=>!l),disabled:s,children:(i==null?void 0:i.label)||e}),a&&t.jsx("div",{className:"absolute z-10 min-w-[120px] mt-2 bg-white border rounded shadow",children:n.map(l=>t.jsx("button",{className:`block w-full text-left px-3 py-1 hover:bg-gray-100 ${l.value===e?"font-semibold":""}`,onClick:()=>{o(!1),r(l.value)},disabled:s,children:l.label},l.value))})]})}function dd({product:e,onEdit:r,onDelete:n,updateMutation:s,statusOptions:a,isSelected:o=!1,onSelectChange:i=()=>{}}){var h;const l=e.imageUrl?Di(e.imageUrl):null,{data:c}=oe({queryKey:["categories"],queryFn:xt}),u=((h=c==null?void 0:c.find(v=>v.category_id===e.category_id))==null?void 0:h.name)||"Без категории",f=e.available?"confirmed":"cancelled",m=v=>{const p=v==="confirmed";console.log("Status changed from",e.available,"to",p),s.mutate({id:e.id,data:{available:p}})},g=()=>{console.log("Editing product:",e),console.log("Product availability:",e.available),r(e)};return t.jsxs(_e,{children:[t.jsx(K,{children:t.jsx(On,{checked:o,onCheckedChange:i,"aria-label":`Select ${e.title}`})}),t.jsx(K,{children:l?t.jsx("div",{className:"w-10 h-10 rounded bg-center bg-cover",style:{backgroundImage:`url(${l})`}}):t.jsx("div",{className:"w-10 h-10 rounded bg-muted flex items-center justify-center",children:t.jsx(As,{className:"h-5 w-5 opacity-70"})})}),t.jsxs(K,{className:"font-mono text-sm",children:[e.id.substring(0,8),"..."]}),t.jsx(K,{className:"font-medium",children:t.jsxs("div",{className:"flex justify-between items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[e.title,e.available?t.jsx(Gs,{className:"h-4 w-4 text-green-600"}):t.jsx(Xs,{className:"h-4 w-4 text-red-600"})]}),t.jsxs("span",{children:[t.jsx("button",{className:"text-xs text-blue-600 hover:underline mr-2",onClick:g,type:"button",children:"Редактировать"}),t.jsx("button",{className:"text-xs text-red-600 hover:underline",onClick:()=>n(e.id),type:"button",children:"Удалить"})]})]})}),t.jsx(K,{children:t.jsx(De,{variant:"outline",children:u})}),t.jsxs(K,{className:"text-right",children:[e.price.toLocaleString()," ₽"]}),t.jsx(K,{children:e.quantity}),t.jsx(K,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(cd,{value:f,onChange:m,options:a,disabled:s.isPending}),!e.available&&t.jsx(De,{variant:"secondary",className:"text-xs",children:"Скрыт"})]})})]},e.id)}function ud({value:e,onChange:r,placeholder:n="Поиск товаров..."}){return t.jsxs("div",{className:"relative",children:[t.jsx(cn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),t.jsx(ie,{type:"text",placeholder:n,value:e,onChange:s=>r(s.target.value),className:"pl-10 max-w-sm"})]})}var Ga="AlertDialog",[fd,$h]=Rt(Ga,[oa]),Oe=oa(),Za=e=>{const{__scopeAlertDialog:r,...n}=e,s=Oe(r);return t.jsx(wa,{...s,...n,modal:!0})};Za.displayName=Ga;var md="AlertDialogTrigger",hd=d.forwardRef((e,r)=>{const{__scopeAlertDialog:n,...s}=e,a=Oe(n);return t.jsx(Nc,{...a,...s,ref:r})});hd.displayName=md;var gd="AlertDialogPortal",Ja=e=>{const{__scopeAlertDialog:r,...n}=e,s=Oe(r);return t.jsx(Na,{...s,...n})};Ja.displayName=gd;var vd="AlertDialogOverlay",eo=d.forwardRef((e,r)=>{const{__scopeAlertDialog:n,...s}=e,a=Oe(n);return t.jsx(Nn,{...a,...s,ref:r})});eo.displayName=vd;var ht="AlertDialogContent",[pd,xd]=fd(ht),to=d.forwardRef((e,r)=>{const{__scopeAlertDialog:n,children:s,...a}=e,o=Oe(n),i=d.useRef(null),l=xe(r,i),c=d.useRef(null);return t.jsx(yc,{contentName:ht,titleName:ro,docsSlug:"alert-dialog",children:t.jsx(pd,{scope:n,cancelRef:c,children:t.jsxs(Cn,{role:"alertdialog",...o,...a,ref:l,onOpenAutoFocus:ne(a.onOpenAutoFocus,u=>{var f;u.preventDefault(),(f=c.current)==null||f.focus({preventScroll:!0})}),onPointerDownOutside:u=>u.preventDefault(),onInteractOutside:u=>u.preventDefault(),children:[t.jsx(_i,{children:s}),t.jsx(bd,{contentRef:i})]})})})});to.displayName=ht;var ro="AlertDialogTitle",no=d.forwardRef((e,r)=>{const{__scopeAlertDialog:n,...s}=e,a=Oe(n);return t.jsx(Sn,{...a,...s,ref:r})});no.displayName=ro;var so="AlertDialogDescription",ao=d.forwardRef((e,r)=>{const{__scopeAlertDialog:n,...s}=e,a=Oe(n);return t.jsx(En,{...a,...s,ref:r})});ao.displayName=so;var yd="AlertDialogAction",oo=d.forwardRef((e,r)=>{const{__scopeAlertDialog:n,...s}=e,a=Oe(n);return t.jsx(Dn,{...a,...s,ref:r})});oo.displayName=yd;var io="AlertDialogCancel",lo=d.forwardRef((e,r)=>{const{__scopeAlertDialog:n,...s}=e,{cancelRef:a}=xd(io,n),o=Oe(n),i=xe(r,a);return t.jsx(Dn,{...o,...s,ref:i})});lo.displayName=io;var bd=({contentRef:e})=>{const r=`\`${ht}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${ht}\` by passing a \`${so}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${ht}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return d.useEffect(()=>{var s;document.getElementById((s=e.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(r)},[r,e]),null},jd=Za,wd=Ja,co=eo,uo=to,fo=oo,mo=lo,ho=no,go=ao;const vo=jd,Nd=wd,po=d.forwardRef(({className:e,...r},n)=>t.jsx(co,{className:O("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r,ref:n}));po.displayName=co.displayName;const Tn=d.forwardRef(({className:e,...r},n)=>t.jsxs(Nd,{children:[t.jsx(po,{}),t.jsx(uo,{ref:n,className:O("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r})]}));Tn.displayName=uo.displayName;const Fn=({className:e,...r})=>t.jsx("div",{className:O("flex flex-col space-y-2 text-center sm:text-left",e),...r});Fn.displayName="AlertDialogHeader";const Ln=({className:e,...r})=>t.jsx("div",{className:O("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...r});Ln.displayName="AlertDialogFooter";const Un=d.forwardRef(({className:e,...r},n)=>t.jsx(ho,{ref:n,className:O("text-lg font-semibold",e),...r}));Un.displayName=ho.displayName;const qn=d.forwardRef(({className:e,...r},n)=>t.jsx(go,{ref:n,className:O("text-sm text-muted-foreground",e),...r}));qn.displayName=go.displayName;const Wn=d.forwardRef(({className:e,...r},n)=>t.jsx(fo,{ref:n,className:O(er(),e),...r}));Wn.displayName=fo.displayName;const zn=d.forwardRef(({className:e,...r},n)=>t.jsx(mo,{ref:n,className:O(er({variant:"outline"}),"mt-2 sm:mt-0",e),...r}));zn.displayName=mo.displayName;const Cd=[{value:"confirmed",label:"Доступен"},{value:"cancelled",label:"Недоступен"}];function Sd({products:e,isLoading:r,onEditProduct:n,onDeleteProduct:s,updateMutation:a}){const[o,i]=d.useState([]),[l,c]=d.useState(!1),[u,f]=d.useState(""),{toast:m}=te(),g=Pe(),h=d.useMemo(()=>{if(!e||!u.trim())return e||[];const y=u.toLowerCase().trim();return e.filter(j=>j.title.toLowerCase().includes(y)||j.id.toLowerCase().includes(y)||j.category_id.toString().includes(y))},[e,u]),v=y=>{i(j=>j.includes(y)?j.filter(w=>w!==y):[...j,y])},p=()=>{h&&h.length>0&&(o.length===h.length?i([]):i(h.map(y=>y.id)))},x=()=>{c(!0)},b=()=>{o.length!==0&&Promise.all(o.map(y=>s(y))).then(()=>{m({title:"Успешно удалено",description:`${o.length} товаров было удалено`}),i([]),g.invalidateQueries({queryKey:["products"]})}).catch(y=>{m({title:"Ошибка при удалении",description:"Не удалось удалить некоторые товары",variant:"destructive"})}).finally(()=>{c(!1)})};return t.jsxs(se,{children:[t.jsx(ue,{children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsx(ve,{children:"Список товаров"}),t.jsx(Ne,{children:"Управляйте товарами в вашем каталоге. Вы можете добавлять, редактировать и удалять товары."})]}),t.jsx(ud,{value:u,onChange:f,placeholder:"Поиск по названию, ID или категории..."})]})}),t.jsx(ae,{children:r?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(Y,{className:"h-8 w-8 animate-spin text-primary"})}):t.jsx("div",{className:"rounded-md border",children:t.jsxs(hr,{children:[t.jsx(gr,{children:t.jsxs(_e,{children:[t.jsx(J,{className:"w-12",children:t.jsx(On,{checked:h!=null&&h.length?o.length===h.length:!1,onCheckedChange:p,"aria-label":"Select all products",disabled:!(h!=null&&h.length)})}),t.jsx(J,{style:{width:50},children:"Фото"}),t.jsx(J,{style:{width:100},children:"ID"}),t.jsx(J,{children:"Название"}),t.jsx(J,{children:"Категория"}),t.jsx(J,{className:"text-right",children:"Цена"}),t.jsx(J,{children:"Кол-во"}),t.jsx(J,{children:"Статус"})]})}),t.jsx(vr,{children:!h||h.length===0?t.jsx(_e,{children:t.jsx(K,{colSpan:8,className:"h-24 text-center",children:u?"Товары не найдены по запросу":"Нет товаров"})}):h.map(y=>t.jsx(dd,{product:y,onEdit:n,onDelete:s,updateMutation:a,statusOptions:Cd,isSelected:o.includes(y.id),onSelectChange:()=>v(y.id)},y.id))})]})})}),t.jsxs(Os,{className:"flex justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[o.length>0&&t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Выбрано товаров: ",o.length]}),u&&h&&t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Найдено: ",h.length," из ",(e==null?void 0:e.length)||0]})]}),t.jsxs(R,{variant:"destructive",onClick:x,disabled:o.length===0,children:[t.jsx(pl,{className:"h-4 w-4 mr-2"}),"Удалить выбранное"]})]}),t.jsx(vo,{open:l,onOpenChange:c,children:t.jsxs(Tn,{children:[t.jsxs(Fn,{children:[t.jsx(Un,{children:"Подтверждение удаления"}),t.jsxs(qn,{children:["Вы уверены, что хотите удалить ",o.length," товаров? Это действие нельзя отменить."]})]}),t.jsxs(Ln,{children:[t.jsx(zn,{children:"Отмена"}),t.jsx(Wn,{onClick:b,children:"Удалить"})]})]})})]})}function Ed(){const{isLoading:e,handleExport:r,handleImport:n}=ra(),[s,a]=d.useState(null),[o,i]=d.useState(null),l=u=>{var m;i(null);const f=(m=u.target.files)==null?void 0:m[0];if(f){if(f.type!=="text/csv"&&!f.name.endsWith(".csv")&&f.type!=="text/plain"&&f.type!=="application/vnd.ms-excel"){i("Пожалуйста, выберите файл CSV");return}console.log(`Selected CSV file: ${f.name} (${f.size} bytes, type: ${f.type})`),a(f)}},c=async()=>{if(!s){i("Выберите файл CSV для импорта");return}try{console.log(`Importing CSV file: ${s.name}`),await n(s),console.log("CSV import completed successfully"),a(null);const u=document.querySelector('input[type="file"]');u&&(u.value="")}catch(u){console.error("Error during import:",u)}};return t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsx(ve,{children:"Экспорт товаров"}),t.jsx(Ne,{children:"Экспортируйте все товары в формате CSV для резервного копирования или редактирования."})]}),t.jsx(ae,{children:t.jsx(R,{onClick:r,disabled:e,className:"w-full",children:e?t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Экспорт..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"mr-2 h-4 w-4"}),"Экспортировать в CSV"]})})})]}),t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsx(ve,{children:"Импорт товаров"}),t.jsx(Ne,{children:"Импортируйте товары из CSV файла. Формат должен соответствовать экспорту: столбцы разделены точкой с запятой (;). Новые категории будут созданы автоматически. Ссылки на изображения сохраняются как есть."})]}),t.jsxs(ae,{className:"space-y-4",children:[o&&t.jsxs(Be,{variant:"destructive",children:[t.jsx(Is,{className:"h-4 w-4"}),t.jsx(Ve,{children:o})]}),t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"border border-dashed border-gray-300 rounded-md p-4 text-center",children:[t.jsx(ie,{type:"file",accept:".csv,.txt",id:"csv-upload",onChange:l,disabled:e,className:"hidden"}),t.jsxs("label",{htmlFor:"csv-upload",className:"flex flex-col items-center justify-center cursor-pointer py-2",children:[t.jsx(Sl,{className:"h-6 w-6 mb-2 text-gray-500"}),t.jsx("span",{className:"text-sm font-medium",children:s?s.name:"Выберите CSV файл"}),t.jsx("span",{className:"text-xs text-gray-500 mt-1",children:s?`${(s.size/1024).toFixed(2)} кБ`:'CSV файл с разделителем ";"'})]})]}),t.jsx(R,{onClick:c,disabled:!s||e,className:"w-full",children:e?t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Импорт..."]}):t.jsxs(t.Fragment,{children:[t.jsx(gn,{className:"mr-2 h-4 w-4"}),"Импортировать из CSV"]})})]})]})]})]})}function Dd({products:e,isLoading:r,onEditProduct:n,onDeleteProduct:s,updateMutation:a}){return t.jsxs($t,{defaultValue:"products",children:[t.jsxs(It,{children:[t.jsx(ee,{value:"products",children:"Товары"}),t.jsx(ee,{value:"import-export",children:"Импорт/Экспорт"})]}),t.jsx(G,{value:"products",className:"space-y-4",children:t.jsx(Sd,{products:e,isLoading:r,onEditProduct:n,onDeleteProduct:s,updateMutation:a})}),t.jsx(G,{value:"import-export",children:t.jsx(Ed,{})})]})}function _d({onComplete:e}){const[r,n]=d.useState({initializing:!0,success:null,error:null,details:{products:!1,categories:!1}});d.useEffect(()=>{s()},[]);const s=async()=>{try{if(n(c=>({...c,initializing:!0,error:null})),console.log("Initializing storage..."),!await Ts())throw new Error("Failed to initialize storage. Please try again.");const o=await tr("products"),i=await tr("categories");console.log("Storage initialization results:",{products:o,categories:i});const l=o.success&&i.success;n({initializing:!1,success:l,error:l?null:"Some storage buckets could not be initialized.",details:{products:o.success,categories:i.success}}),e(l)}catch(a){console.error("Error initializing storage:",a),n({initializing:!1,success:!1,error:a instanceof Error?a.message:"Unknown error initializing storage",details:{products:!1,categories:!1}}),e(!1)}};return r.initializing?t.jsxs(Be,{variant:"default",className:"bg-muted/50",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(Y,{className:"h-4 w-4 mr-2 animate-spin text-primary"}),t.jsx(Ct,{children:"Initializing storage"})]}),t.jsx(Ve,{children:"Setting up storage buckets for images..."})]}):r.success===!1?t.jsxs(Be,{variant:"destructive",children:[t.jsx(Ct,{children:"Storage initialization failed"}),t.jsxs(Ve,{children:[t.jsx("p",{className:"mb-2",children:r.error||"Unable to initialize storage for images."}),t.jsx("div",{className:"mt-2",children:t.jsxs(R,{variant:"outline",size:"sm",onClick:s,className:"bg-white hover:bg-white/90",children:[t.jsx(hn,{className:"h-4 w-4 mr-2"})," Retry"]})}),t.jsx("div",{className:"mt-2 text-xs",children:t.jsxs("p",{children:["Status: Products: ",r.details.products?"Available":"Unavailable",", Categories: ",r.details.categories?"Available":"Unavailable"]})})]})]}):r.success===!0?t.jsxs(Be,{variant:"default",className:"bg-green-50 border-green-200",children:[t.jsxs("div",{className:"flex items-center text-green-600",children:[t.jsx(Nl,{className:"h-4 w-4 mr-2"}),t.jsx(Ct,{children:"Storage initialized"})]}),t.jsx(Ve,{className:"text-green-700",children:"Image storage is ready to use."})]}):null}const Pd=()=>{const{products:e,categories:r,isLoadingProducts:n,openDialog:s,setOpenDialog:a,editProduct:o,setEditProduct:i,imageForProduct:l,setImageForProduct:c,createProductMutation:u,updateProductMutation:f,deleteProductMutation:m,handleEditProduct:g,handleDeleteProduct:h,addProduct:v}=mc(),{showCategoryInput:p,setShowCategoryInput:x,newCategoryName:b,setNewCategoryName:y,fileForCategory:j,setFileForCategory:w,addCategoryMutation:C,handleAddCategory:S}=na(),{storageInitialized:P,handleStorageInitialized:_}=sa(),D=async(F,E)=>{console.log("Submitting product form:",{formData:F,imageFile:E,editProduct:o}),c(E);try{o?(console.log("Updating existing product:",o.id),await f.mutateAsync({id:o.id,data:{...F,imageFile:E instanceof File?E:void 0}})):(console.log("Creating new product"),await v(F,E)),a(!1),i(null),c(null)}catch(T){console.error("Ошибка при сохранении товара:",T)}};return d.useState("products"),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Управление товарами"}),t.jsx("div",{className:"flex gap-2",children:t.jsx(td,{openDialog:s,setOpenDialog:a,editProduct:o,categories:r||[],showCategoryInput:p,setShowCategoryInput:x,newCategoryName:b,setNewCategoryName:y,fileForProduct:l,setFileForProduct:c,fileForCategory:j,setFileForCategory:w,addCategoryMutation:C,onSubmit:D,handleAddCategory:S,createPending:u==null?void 0:u.isPending,updatePending:f==null?void 0:f.isPending})})]}),t.jsx(_d,{onComplete:_}),P===!1&&t.jsxs(Be,{variant:"destructive",children:[t.jsx(Ct,{children:"Storage initialization problem"}),t.jsx(Ve,{children:"There are issues with storage initialization. You may have problems uploading or displaying images. Try reloading the page or contact your administrator."})]}),t.jsx(Dd,{products:e,isLoading:n,onEditProduct:g,onDeleteProduct:h,updateMutation:f})]})},xo=async(e,r)=>{try{console.log("Updating order status:",{orderId:e,newStatus:r});const{data:n,error:s}=await V.from("bookings").update({status:r}).eq("order_id",e).select();if(s)throw console.error("Error updating order status:",s),s;console.log("Successfully updated order status:",{orderId:e,newStatus:r,updatedBookings:(n==null?void 0:n.length)||0})}catch(n){throw console.error("Error in updateOrderStatus:",n),n}},kd=async()=>{try{console.log("Starting order status analysis and cleanup...");const{data:e,error:r}=await V.from("bookings").select("*").not("order_id","is",null);if(r)throw r;const n=new Map;e==null||e.forEach(i=>{i.order_id&&(n.has(i.order_id)||n.set(i.order_id,[]),n.get(i.order_id).push(i))});const s=[];let a=0;const o={completed:4,confirmed:3,pending:2,cancelled:1};for(const[i,l]of n){const c=[...new Set(l.map(u=>u.status))];if(c.length>1){console.log(`Found inconsistent statuses for order ${i}:`,c);const u=c.reduce((f,m)=>{const g=o[m]||0,h=o[f]||0;return g>h?m:f},c[0]);await xo(i,u),s.push({orderId:i,currentStatuses:c,fixedStatus:u}),a++}}return console.log("Order status analysis completed:",{totalOrders:n.size,issuesFound:s.length,fixed:a}),{analyzed:n.size,fixed:a,issues:s}}catch(e){throw console.error("Error in analyzeAndFixOrderStatuses:",e),e}},Md=(e,r)=>({pending:["confirmed","cancelled"],confirmed:["completed","cancelled"],completed:[],cancelled:["pending"]}[e]||[]).includes(r)?{isValid:!0}:{isValid:!1,reason:`Переход от статуса "${e}" к "${r}" не разрешен`},Rd=({search:e,setSearch:r,statusFilter:n,setStatusFilter:s})=>t.jsxs("div",{className:"grid gap-4 mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(cn,{className:"h-4 w-4 text-gray-500"}),t.jsx(ie,{type:"search",placeholder:"Поиск бронирований...",value:e,onChange:a=>r(a.target.value),className:"bg-gray-100 border-gray-300 focus:ring-primary focus:border-primary"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("label",{htmlFor:"status-filter",className:"text-sm font-medium",children:"Статус:"}),t.jsxs("select",{id:"status-filter",className:"bg-gray-100 border-gray-300 rounded px-4 py-2 text-sm focus:outline-none focus:ring-primary focus:border-primary",value:n,onChange:a=>s(a.target.value),children:[t.jsx("option",{value:"all",children:"Все статусы"}),t.jsx("option",{value:"pending",children:"В ожидании"}),t.jsx("option",{value:"confirmed",children:"Подтверждено"}),t.jsx("option",{value:"cancelled",children:"Отменено"}),t.jsx("option",{value:"completed",children:"Завершено"})]})]})]}),$d={pending:"Ожидание",confirmed:"Подтверждено",cancelled:"Отменено",completed:"Завершено"},Id=({status:e})=>t.jsx(De,{variant:e==="pending"?"secondary":e==="confirmed"?"default":e==="cancelled"?"destructive":"outline",children:$d[e]}),cs=[{value:"pending",label:"Ожидание"},{value:"confirmed",label:"Подтверждено"},{value:"cancelled",label:"Отменено"},{value:"completed",label:"Завершено"}],yo=({booking:e,onStatusUpdate:r,showAllOptions:n=!1})=>{const[s,a]=Ie.useState(e.status),{toast:o}=te();Ie.useEffect(()=>{a(e.status)},[e.status]);const i=u=>{if(!n){const f=Md(e.status,u);if(!f.isValid){o({title:"Недопустимый переход статуса",description:f.reason,variant:"destructive"});return}}if(a(u),r&&u!==e.status){if(e.order_id&&!confirm(`Это действие обновит статус для всех бронирований в заказе ${e.order_id.slice(0,8)}. Продолжить?`)){a(e.status);return}r(e.id,u)}},c=(u=>{if(n)return cs;const m={pending:["pending","confirmed","cancelled"],confirmed:["confirmed","completed","cancelled"],completed:["completed"],cancelled:["cancelled","pending"]}[u]||[];return cs.filter(g=>m.includes(g.value))})(e.status);return t.jsxs(Br,{value:s,onValueChange:i,children:[t.jsx(Vr,{className:"w-[140px]",children:t.jsx(Hr,{children:t.jsx(Id,{status:s})})}),t.jsx(Kr,{children:c.map(u=>t.jsx(lt,{value:u.value,children:u.label},u.value))})]})},Ad=async e=>{try{console.log("Adding item to booking:",e);const{data:r,error:n}=await V.from("bookings").select("*").eq("id",e.bookingId).single();if(n)throw n;if(!r)throw new Error("Original booking not found");const s={product_id:e.productId,customer_name:r.customer_name,customer_email:r.customer_email,customer_phone:r.customer_phone,start_date:r.start_date,end_date:r.end_date,status:r.status,quantity:e.quantity,total_price:e.price*e.quantity,order_id:r.order_id||r.id,notes:r.notes},{error:a}=await V.from("bookings").insert(s);if(a)throw a;console.log("Successfully added item to booking")}catch(r){throw console.error("Error adding item to booking:",r),r}},Od=async e=>{try{if(console.log("Updating booking item quantity:",e),e.newQuantity<=0){await Td(e.bookingId,e.productId);return}const{data:r,error:n}=await V.from("bookings").select("*, products!inner(*)").eq("id",e.bookingId).eq("product_id",e.productId).single();if(n)throw n;if(!r)throw new Error("Booking item not found");const a=r.products.price*e.newQuantity,{error:o}=await V.from("bookings").update({quantity:e.newQuantity,total_price:a}).eq("id",e.bookingId);if(o)throw o;console.log("Successfully updated booking item quantity")}catch(r){throw console.error("Error updating booking item quantity:",r),r}},Td=async(e,r)=>{try{console.log("Removing item from booking:",{bookingId:e,productId:r});const{error:n}=await V.from("bookings").delete().eq("id",e).eq("product_id",r);if(n)throw n;console.log("Successfully removed item from booking")}catch(n){throw console.error("Error removing item from booking:",n),n}},Fd=async(e,r,n)=>{try{console.log("Getting available products for booking:",{bookingId:e,startDate:r,endDate:n});const{data:s,error:a}=await V.from("bookings").select("order_id").eq("id",e).single();if(a)throw a;const o=s.order_id||e,{data:i,error:l}=await V.from("bookings").select("product_id").eq("order_id",o);if(l)throw l;const c=(i==null?void 0:i.map(g=>g.product_id))||[],{data:u,error:f}=await V.from("products").select("*").eq("available",!0);if(f)throw f;const m=(u==null?void 0:u.filter(g=>!c.includes(g.id)))||[];return console.log("Available products for booking:",m.length),m}catch(s){throw console.error("Error getting available products for booking:",s),s}};var ds=1,Ld=.9,Ud=.8,qd=.17,Pr=.1,kr=.999,Wd=.9999,zd=.99,Bd=/[\\\/_+.#"@\[\(\{&]/,Vd=/[\\\/_+.#"@\[\(\{&]/g,Hd=/[\s-]/,bo=/[\s-]/g;function Zr(e,r,n,s,a,o,i){if(o===r.length)return a===e.length?ds:zd;var l=`${a},${o}`;if(i[l]!==void 0)return i[l];for(var c=s.charAt(o),u=n.indexOf(c,a),f=0,m,g,h,v;u>=0;)m=Zr(e,r,n,s,u+1,o+1,i),m>f&&(u===a?m*=ds:Bd.test(e.charAt(u-1))?(m*=Ud,h=e.slice(a,u-1).match(Vd),h&&a>0&&(m*=Math.pow(kr,h.length))):Hd.test(e.charAt(u-1))?(m*=Ld,v=e.slice(a,u-1).match(bo),v&&a>0&&(m*=Math.pow(kr,v.length))):(m*=qd,a>0&&(m*=Math.pow(kr,u-a))),e.charAt(u)!==r.charAt(o)&&(m*=Wd)),(m<Pr&&n.charAt(u-1)===s.charAt(o+1)||s.charAt(o+1)===s.charAt(o)&&n.charAt(u-1)!==s.charAt(o))&&(g=Zr(e,r,n,s,u+1,o+2,i),g*Pr>m&&(m=g*Pr)),m>f&&(f=m),u=n.indexOf(c,u+1);return i[l]=f,f}function us(e){return e.toLowerCase().replace(bo," ")}function Kd(e,r,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,Zr(e,r,us(e),us(r),0,0,{})}function le(){return le=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},le.apply(null,arguments)}function gt(e,r,{checkForDefaultPrevented:n=!0}={}){return function(a){if(e==null||e(a),n===!1||!a.defaultPrevented)return r==null?void 0:r(a)}}function Yd(e,r){typeof e=="function"?e(r):e!=null&&(e.current=r)}function jo(...e){return r=>e.forEach(n=>Yd(n,r))}function Tt(...e){return d.useCallback(jo(...e),e)}function Qd(e,r=[]){let n=[];function s(o,i){const l=d.createContext(i),c=n.length;n=[...n,i];function u(m){const{scope:g,children:h,...v}=m,p=(g==null?void 0:g[e][c])||l,x=d.useMemo(()=>v,Object.values(v));return d.createElement(p.Provider,{value:x},h)}function f(m,g){const h=(g==null?void 0:g[e][c])||l,v=d.useContext(h);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${m}\` must be used within \`${o}\``)}return u.displayName=o+"Provider",[u,f]}const a=()=>{const o=n.map(i=>d.createContext(i));return function(l){const c=(l==null?void 0:l[e])||o;return d.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return a.scopeName=e,[s,Xd(a,...r)]}function Xd(...e){const r=e[0];if(e.length===1)return r;const n=()=>{const s=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(o){const i=s.reduce((l,{useScope:c,scopeName:u})=>{const m=c(o)[`__scope${u}`];return{...l,...m}},{});return d.useMemo(()=>({[`__scope${r.scopeName}`]:i}),[i])}};return n.scopeName=r.scopeName,n}const Jr=globalThis!=null&&globalThis.document?d.useLayoutEffect:()=>{},Gd=Pi.useId||(()=>{});let Zd=0;function Mr(e){const[r,n]=d.useState(Gd());return Jr(()=>{e||n(s=>s??String(Zd++))},[e]),e||(r?`radix-${r}`:"")}function Je(e){const r=d.useRef(e);return d.useEffect(()=>{r.current=e}),d.useMemo(()=>(...n)=>{var s;return(s=r.current)===null||s===void 0?void 0:s.call(r,...n)},[])}function Jd({prop:e,defaultProp:r,onChange:n=()=>{}}){const[s,a]=eu({defaultProp:r,onChange:n}),o=e!==void 0,i=o?e:s,l=Je(n),c=d.useCallback(u=>{if(o){const m=typeof u=="function"?u(e):u;m!==e&&l(m)}else a(u)},[o,e,a,l]);return[i,c]}function eu({defaultProp:e,onChange:r}){const n=d.useState(e),[s]=n,a=d.useRef(s),o=Je(r);return d.useEffect(()=>{a.current!==s&&(o(s),a.current=s)},[s,a,o]),n}const Bn=d.forwardRef((e,r)=>{const{children:n,...s}=e,a=d.Children.toArray(n),o=a.find(ru);if(o){const i=o.props.children,l=a.map(c=>c===o?d.Children.count(i)>1?d.Children.only(null):d.isValidElement(i)?i.props.children:null:c);return d.createElement(en,le({},s,{ref:r}),d.isValidElement(i)?d.cloneElement(i,void 0,l):null)}return d.createElement(en,le({},s,{ref:r}),n)});Bn.displayName="Slot";const en=d.forwardRef((e,r)=>{const{children:n,...s}=e;return d.isValidElement(n)?d.cloneElement(n,{...nu(s,n.props),ref:r?jo(r,n.ref):n.ref}):d.Children.count(n)>1?d.Children.only(null):null});en.displayName="SlotClone";const tu=({children:e})=>d.createElement(d.Fragment,null,e);function ru(e){return d.isValidElement(e)&&e.type===tu}function nu(e,r){const n={...r};for(const s in r){const a=e[s],o=r[s];/^on[A-Z]/.test(s)?a&&o?n[s]=(...l)=>{o(...l),a(...l)}:a&&(n[s]=a):s==="style"?n[s]={...a,...o}:s==="className"&&(n[s]=[a,o].filter(Boolean).join(" "))}return{...e,...n}}const su=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],we=su.reduce((e,r)=>{const n=d.forwardRef((s,a)=>{const{asChild:o,...i}=s,l=o?Bn:r;return d.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),d.createElement(l,le({},i,{ref:a}))});return n.displayName=`Primitive.${r}`,{...e,[r]:n}},{});function au(e,r){e&&Fs.flushSync(()=>e.dispatchEvent(r))}function ou(e,r=globalThis==null?void 0:globalThis.document){const n=Je(e);d.useEffect(()=>{const s=a=>{a.key==="Escape"&&n(a)};return r.addEventListener("keydown",s),()=>r.removeEventListener("keydown",s)},[n,r])}const tn="dismissableLayer.update",iu="dismissableLayer.pointerDownOutside",lu="dismissableLayer.focusOutside";let fs;const cu=d.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),du=d.forwardRef((e,r)=>{var n;const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:a,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:l,onDismiss:c,...u}=e,f=d.useContext(cu),[m,g]=d.useState(null),h=(n=m==null?void 0:m.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,v]=d.useState({}),p=Tt(r,_=>g(_)),x=Array.from(f.layers),[b]=[...f.layersWithOutsidePointerEventsDisabled].slice(-1),y=x.indexOf(b),j=m?x.indexOf(m):-1,w=f.layersWithOutsidePointerEventsDisabled.size>0,C=j>=y,S=uu(_=>{const D=_.target,F=[...f.branches].some(E=>E.contains(D));!C||F||(o==null||o(_),l==null||l(_),_.defaultPrevented||c==null||c())},h),P=fu(_=>{const D=_.target;[...f.branches].some(E=>E.contains(D))||(i==null||i(_),l==null||l(_),_.defaultPrevented||c==null||c())},h);return ou(_=>{j===f.layers.size-1&&(a==null||a(_),!_.defaultPrevented&&c&&(_.preventDefault(),c()))},h),d.useEffect(()=>{if(m)return s&&(f.layersWithOutsidePointerEventsDisabled.size===0&&(fs=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),f.layersWithOutsidePointerEventsDisabled.add(m)),f.layers.add(m),ms(),()=>{s&&f.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=fs)}},[m,h,s,f]),d.useEffect(()=>()=>{m&&(f.layers.delete(m),f.layersWithOutsidePointerEventsDisabled.delete(m),ms())},[m,f]),d.useEffect(()=>{const _=()=>v({});return document.addEventListener(tn,_),()=>document.removeEventListener(tn,_)},[]),d.createElement(we.div,le({},u,{ref:p,style:{pointerEvents:w?C?"auto":"none":void 0,...e.style},onFocusCapture:gt(e.onFocusCapture,P.onFocusCapture),onBlurCapture:gt(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:gt(e.onPointerDownCapture,S.onPointerDownCapture)}))});function uu(e,r=globalThis==null?void 0:globalThis.document){const n=Je(e),s=d.useRef(!1),a=d.useRef(()=>{});return d.useEffect(()=>{const o=l=>{if(l.target&&!s.current){let u=function(){wo(iu,n,c,{discrete:!0})};const c={originalEvent:l};l.pointerType==="touch"?(r.removeEventListener("click",a.current),a.current=u,r.addEventListener("click",a.current,{once:!0})):u()}else r.removeEventListener("click",a.current);s.current=!1},i=window.setTimeout(()=>{r.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),r.removeEventListener("pointerdown",o),r.removeEventListener("click",a.current)}},[r,n]),{onPointerDownCapture:()=>s.current=!0}}function fu(e,r=globalThis==null?void 0:globalThis.document){const n=Je(e),s=d.useRef(!1);return d.useEffect(()=>{const a=o=>{o.target&&!s.current&&wo(lu,n,{originalEvent:o},{discrete:!1})};return r.addEventListener("focusin",a),()=>r.removeEventListener("focusin",a)},[r,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function ms(){const e=new CustomEvent(tn);document.dispatchEvent(e)}function wo(e,r,n,{discrete:s}){const a=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});r&&a.addEventListener(e,r,{once:!0}),s?au(a,o):a.dispatchEvent(o)}const Rr="focusScope.autoFocusOnMount",$r="focusScope.autoFocusOnUnmount",hs={bubbles:!1,cancelable:!0},mu=d.forwardRef((e,r)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:a,onUnmountAutoFocus:o,...i}=e,[l,c]=d.useState(null),u=Je(a),f=Je(o),m=d.useRef(null),g=Tt(r,p=>c(p)),h=d.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;d.useEffect(()=>{if(s){let p=function(j){if(h.paused||!l)return;const w=j.target;l.contains(w)?m.current=w:Ue(m.current,{select:!0})},x=function(j){if(h.paused||!l)return;const w=j.relatedTarget;w!==null&&(l.contains(w)||Ue(m.current,{select:!0}))},b=function(j){if(document.activeElement===document.body)for(const C of j)C.removedNodes.length>0&&Ue(l)};document.addEventListener("focusin",p),document.addEventListener("focusout",x);const y=new MutationObserver(b);return l&&y.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",x),y.disconnect()}}},[s,l,h.paused]),d.useEffect(()=>{if(l){vs.add(h);const p=document.activeElement;if(!l.contains(p)){const b=new CustomEvent(Rr,hs);l.addEventListener(Rr,u),l.dispatchEvent(b),b.defaultPrevented||(hu(yu(No(l)),{select:!0}),document.activeElement===p&&Ue(l))}return()=>{l.removeEventListener(Rr,u),setTimeout(()=>{const b=new CustomEvent($r,hs);l.addEventListener($r,f),l.dispatchEvent(b),b.defaultPrevented||Ue(p??document.body,{select:!0}),l.removeEventListener($r,f),vs.remove(h)},0)}}},[l,u,f,h]);const v=d.useCallback(p=>{if(!n&&!s||h.paused)return;const x=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,b=document.activeElement;if(x&&b){const y=p.currentTarget,[j,w]=gu(y);j&&w?!p.shiftKey&&b===w?(p.preventDefault(),n&&Ue(j,{select:!0})):p.shiftKey&&b===j&&(p.preventDefault(),n&&Ue(w,{select:!0})):b===y&&p.preventDefault()}},[n,s,h.paused]);return d.createElement(we.div,le({tabIndex:-1},i,{ref:g,onKeyDown:v}))});function hu(e,{select:r=!1}={}){const n=document.activeElement;for(const s of e)if(Ue(s,{select:r}),document.activeElement!==n)return}function gu(e){const r=No(e),n=gs(r,e),s=gs(r.reverse(),e);return[n,s]}function No(e){const r=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const a=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||a?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)r.push(n.currentNode);return r}function gs(e,r){for(const n of e)if(!vu(n,{upTo:r}))return n}function vu(e,{upTo:r}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(r!==void 0&&e===r)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function pu(e){return e instanceof HTMLInputElement&&"select"in e}function Ue(e,{select:r=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&pu(e)&&r&&e.select()}}const vs=xu();function xu(){let e=[];return{add(r){const n=e[0];r!==n&&(n==null||n.pause()),e=ps(e,r),e.unshift(r)},remove(r){var n;e=ps(e,r),(n=e[0])===null||n===void 0||n.resume()}}}function ps(e,r){const n=[...e],s=n.indexOf(r);return s!==-1&&n.splice(s,1),n}function yu(e){return e.filter(r=>r.tagName!=="A")}const bu=d.forwardRef((e,r)=>{var n;const{container:s=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...a}=e;return s?ki.createPortal(d.createElement(we.div,le({},a,{ref:r})),s):null});function ju(e,r){return d.useReducer((n,s)=>{const a=r[n][s];return a??n},e)}const pr=e=>{const{present:r,children:n}=e,s=wu(r),a=typeof n=="function"?n({present:s.isPresent}):d.Children.only(n),o=Tt(s.ref,a.ref);return typeof n=="function"||s.isPresent?d.cloneElement(a,{ref:o}):null};pr.displayName="Presence";function wu(e){const[r,n]=d.useState(),s=d.useRef({}),a=d.useRef(e),o=d.useRef("none"),i=e?"mounted":"unmounted",[l,c]=ju(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return d.useEffect(()=>{const u=Vt(s.current);o.current=l==="mounted"?u:"none"},[l]),Jr(()=>{const u=s.current,f=a.current;if(f!==e){const g=o.current,h=Vt(u);e?c("MOUNT"):h==="none"||(u==null?void 0:u.display)==="none"?c("UNMOUNT"):c(f&&g!==h?"ANIMATION_OUT":"UNMOUNT"),a.current=e}},[e,c]),Jr(()=>{if(r){const u=m=>{const h=Vt(s.current).includes(m.animationName);m.target===r&&h&&Fs.flushSync(()=>c("ANIMATION_END"))},f=m=>{m.target===r&&(o.current=Vt(s.current))};return r.addEventListener("animationstart",f),r.addEventListener("animationcancel",u),r.addEventListener("animationend",u),()=>{r.removeEventListener("animationstart",f),r.removeEventListener("animationcancel",u),r.removeEventListener("animationend",u)}}else c("ANIMATION_END")},[r,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:d.useCallback(u=>{u&&(s.current=getComputedStyle(u)),n(u)},[])}}function Vt(e){return(e==null?void 0:e.animationName)||"none"}let Ir=0;function Nu(){d.useEffect(()=>{var e,r;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(e=n[0])!==null&&e!==void 0?e:xs()),document.body.insertAdjacentElement("beforeend",(r=n[1])!==null&&r!==void 0?r:xs()),Ir++,()=>{Ir===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),Ir--}},[])}function xs(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var Co=Mi(),Ar=function(){},xr=d.forwardRef(function(e,r){var n=d.useRef(null),s=d.useState({onScrollCapture:Ar,onWheelCapture:Ar,onTouchMoveCapture:Ar}),a=s[0],o=s[1],i=e.forwardProps,l=e.children,c=e.className,u=e.removeScrollBar,f=e.enabled,m=e.shards,g=e.sideCar,h=e.noIsolation,v=e.inert,p=e.allowPinchZoom,x=e.as,b=x===void 0?"div":x,y=Ri(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),j=g,w=$i([n,r]),C=ct(ct({},y),a);return d.createElement(d.Fragment,null,f&&d.createElement(j,{sideCar:Co,removeScrollBar:u,shards:m,noIsolation:h,inert:v,setCallbacks:o,allowPinchZoom:!!p,lockRef:n}),i?d.cloneElement(d.Children.only(l),ct(ct({},C),{ref:w})):d.createElement(b,ct({},C,{className:c,ref:w}),l))});xr.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};xr.classNames={fullWidth:Ii,zeroRight:Ai};var rn=!1;if(typeof window<"u")try{var Ht=Object.defineProperty({},"passive",{get:function(){return rn=!0,!0}});window.addEventListener("test",Ht,Ht),window.removeEventListener("test",Ht,Ht)}catch{rn=!1}var ot=rn?{passive:!1}:!1,Cu=function(e){return e.tagName==="TEXTAREA"},So=function(e,r){var n=window.getComputedStyle(e);return n[r]!=="hidden"&&!(n.overflowY===n.overflowX&&!Cu(e)&&n[r]==="visible")},Su=function(e){return So(e,"overflowY")},Eu=function(e){return So(e,"overflowX")},ys=function(e,r){var n=r;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=Eo(e,n);if(s){var a=Do(e,n),o=a[1],i=a[2];if(o>i)return!0}n=n.parentNode}while(n&&n!==document.body);return!1},Du=function(e){var r=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[r,n,s]},_u=function(e){var r=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[r,n,s]},Eo=function(e,r){return e==="v"?Su(r):Eu(r)},Do=function(e,r){return e==="v"?Du(r):_u(r)},Pu=function(e,r){return e==="h"&&r==="rtl"?-1:1},ku=function(e,r,n,s,a){var o=Pu(e,window.getComputedStyle(r).direction),i=o*s,l=n.target,c=r.contains(l),u=!1,f=i>0,m=0,g=0;do{var h=Do(e,l),v=h[0],p=h[1],x=h[2],b=p-x-o*v;(v||b)&&Eo(e,l)&&(m+=b,g+=v),l=l.parentNode}while(!c&&l!==document.body||c&&(r.contains(l)||r===l));return(f&&(m===0||!a)||!f&&(g===0||!a))&&(u=!0),u},Kt=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},bs=function(e){return[e.deltaX,e.deltaY]},js=function(e){return e&&"current"in e?e.current:e},Mu=function(e,r){return e[0]===r[0]&&e[1]===r[1]},Ru=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},$u=0,it=[];function Iu(e){var r=d.useRef([]),n=d.useRef([0,0]),s=d.useRef(),a=d.useState($u++)[0],o=d.useState(function(){return Oi()})[0],i=d.useRef(e);d.useEffect(function(){i.current=e},[e]),d.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var p=Ti([e.lockRef.current],(e.shards||[]).map(js),!0).filter(Boolean);return p.forEach(function(x){return x.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),p.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var l=d.useCallback(function(p,x){if("touches"in p&&p.touches.length===2)return!i.current.allowPinchZoom;var b=Kt(p),y=n.current,j="deltaX"in p?p.deltaX:y[0]-b[0],w="deltaY"in p?p.deltaY:y[1]-b[1],C,S=p.target,P=Math.abs(j)>Math.abs(w)?"h":"v";if("touches"in p&&P==="h"&&S.type==="range")return!1;var _=ys(P,S);if(!_)return!0;if(_?C=P:(C=P==="v"?"h":"v",_=ys(P,S)),!_)return!1;if(!s.current&&"changedTouches"in p&&(j||w)&&(s.current=C),!C)return!0;var D=s.current||C;return ku(D,x,p,D==="h"?j:w,!0)},[]),c=d.useCallback(function(p){var x=p;if(!(!it.length||it[it.length-1]!==o)){var b="deltaY"in x?bs(x):Kt(x),y=r.current.filter(function(C){return C.name===x.type&&C.target===x.target&&Mu(C.delta,b)})[0];if(y&&y.should){x.cancelable&&x.preventDefault();return}if(!y){var j=(i.current.shards||[]).map(js).filter(Boolean).filter(function(C){return C.contains(x.target)}),w=j.length>0?l(x,j[0]):!i.current.noIsolation;w&&x.cancelable&&x.preventDefault()}}},[]),u=d.useCallback(function(p,x,b,y){var j={name:p,delta:x,target:b,should:y};r.current.push(j),setTimeout(function(){r.current=r.current.filter(function(w){return w!==j})},1)},[]),f=d.useCallback(function(p){n.current=Kt(p),s.current=void 0},[]),m=d.useCallback(function(p){u(p.type,bs(p),p.target,l(p,e.lockRef.current))},[]),g=d.useCallback(function(p){u(p.type,Kt(p),p.target,l(p,e.lockRef.current))},[]);d.useEffect(function(){return it.push(o),e.setCallbacks({onScrollCapture:m,onWheelCapture:m,onTouchMoveCapture:g}),document.addEventListener("wheel",c,ot),document.addEventListener("touchmove",c,ot),document.addEventListener("touchstart",f,ot),function(){it=it.filter(function(p){return p!==o}),document.removeEventListener("wheel",c,ot),document.removeEventListener("touchmove",c,ot),document.removeEventListener("touchstart",f,ot)}},[]);var h=e.removeScrollBar,v=e.inert;return d.createElement(d.Fragment,null,v?d.createElement(o,{styles:Ru(a)}):null,h?d.createElement(Fi,{gapMode:"margin"}):null)}const Au=Li(Co,Iu);var _o=d.forwardRef(function(e,r){return d.createElement(xr,ct({},e,{ref:r,sideCar:Au}))});_o.classNames=xr.classNames;const Po="Dialog",[ko,Ih]=Qd(Po),[Ou,rt]=ko(Po),Tu=e=>{const{__scopeDialog:r,children:n,open:s,defaultOpen:a,onOpenChange:o,modal:i=!0}=e,l=d.useRef(null),c=d.useRef(null),[u=!1,f]=Jd({prop:s,defaultProp:a,onChange:o});return d.createElement(Ou,{scope:r,triggerRef:l,contentRef:c,contentId:Mr(),titleId:Mr(),descriptionId:Mr(),open:u,onOpenChange:f,onOpenToggle:d.useCallback(()=>f(m=>!m),[f]),modal:i},n)},Mo="DialogPortal",[Fu,Ro]=ko(Mo,{forceMount:void 0}),Lu=e=>{const{__scopeDialog:r,forceMount:n,children:s,container:a}=e,o=rt(Mo,r);return d.createElement(Fu,{scope:r,forceMount:n},d.Children.map(s,i=>d.createElement(pr,{present:n||o.open},d.createElement(bu,{asChild:!0,container:a},i))))},nn="DialogOverlay",Uu=d.forwardRef((e,r)=>{const n=Ro(nn,e.__scopeDialog),{forceMount:s=n.forceMount,...a}=e,o=rt(nn,e.__scopeDialog);return o.modal?d.createElement(pr,{present:s||o.open},d.createElement(qu,le({},a,{ref:r}))):null}),qu=d.forwardRef((e,r)=>{const{__scopeDialog:n,...s}=e,a=rt(nn,n);return d.createElement(_o,{as:Bn,allowPinchZoom:!0,shards:[a.contentRef]},d.createElement(we.div,le({"data-state":Io(a.open)},s,{ref:r,style:{pointerEvents:"auto",...s.style}})))}),Pt="DialogContent",Wu=d.forwardRef((e,r)=>{const n=Ro(Pt,e.__scopeDialog),{forceMount:s=n.forceMount,...a}=e,o=rt(Pt,e.__scopeDialog);return d.createElement(pr,{present:s||o.open},o.modal?d.createElement(zu,le({},a,{ref:r})):d.createElement(Bu,le({},a,{ref:r})))}),zu=d.forwardRef((e,r)=>{const n=rt(Pt,e.__scopeDialog),s=d.useRef(null),a=Tt(r,n.contentRef,s);return d.useEffect(()=>{const o=s.current;if(o)return Ms(o)},[]),d.createElement($o,le({},e,{ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:gt(e.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=n.triggerRef.current)===null||i===void 0||i.focus()}),onPointerDownOutside:gt(e.onPointerDownOutside,o=>{const i=o.detail.originalEvent,l=i.button===0&&i.ctrlKey===!0;(i.button===2||l)&&o.preventDefault()}),onFocusOutside:gt(e.onFocusOutside,o=>o.preventDefault())}))}),Bu=d.forwardRef((e,r)=>{const n=rt(Pt,e.__scopeDialog),s=d.useRef(!1),a=d.useRef(!1);return d.createElement($o,le({},e,{ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i;if((i=e.onCloseAutoFocus)===null||i===void 0||i.call(e,o),!o.defaultPrevented){var l;s.current||(l=n.triggerRef.current)===null||l===void 0||l.focus(),o.preventDefault()}s.current=!1,a.current=!1},onInteractOutside:o=>{var i,l;(i=e.onInteractOutside)===null||i===void 0||i.call(e,o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const c=o.target;((l=n.triggerRef.current)===null||l===void 0?void 0:l.contains(c))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}}))}),$o=d.forwardRef((e,r)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:a,onCloseAutoFocus:o,...i}=e,l=rt(Pt,n),c=d.useRef(null),u=Tt(r,c);return Nu(),d.createElement(d.Fragment,null,d.createElement(mu,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:a,onUnmountAutoFocus:o},d.createElement(du,le({role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":Io(l.open)},i,{ref:u,onDismiss:()=>l.onOpenChange(!1)}))),!1)});function Io(e){return e?"open":"closed"}const Vu=Tu,Hu=Lu,Ku=Uu,Yu=Wu;var wt='[cmdk-group=""]',Or='[cmdk-group-items=""]',Qu='[cmdk-group-heading=""]',Vn='[cmdk-item=""]',ws=`${Vn}:not([aria-disabled="true"])`,sn="cmdk-item-select",Ge="data-value",Xu=(e,r,n)=>Kd(e,r,n),Ao=d.createContext(void 0),Ft=()=>d.useContext(Ao),Oo=d.createContext(void 0),Hn=()=>d.useContext(Oo),To=d.createContext(void 0),Fo=d.forwardRef((e,r)=>{let n=ut(()=>{var N,$;return{search:"",value:($=(N=e.value)!=null?N:e.defaultValue)!=null?$:"",filtered:{count:0,items:new Map,groups:new Set}}}),s=ut(()=>new Set),a=ut(()=>new Map),o=ut(()=>new Map),i=ut(()=>new Set),l=Lo(e),{label:c,children:u,value:f,onValueChange:m,filter:g,shouldFilter:h,loop:v,disablePointerSelection:p=!1,vimBindings:x=!0,...b}=e,y=d.useId(),j=d.useId(),w=d.useId(),C=d.useRef(null),S=lf();et(()=>{if(f!==void 0){let N=f.trim();n.current.value=N,P.emit()}},[f]),et(()=>{S(6,L)},[]);let P=d.useMemo(()=>({subscribe:N=>(i.current.add(N),()=>i.current.delete(N)),snapshot:()=>n.current,setState:(N,$,U)=>{var I,W,X;if(!Object.is(n.current[N],$)){if(n.current[N]=$,N==="search")T(),F(),S(1,E);else if(N==="value"&&(U||S(5,L),((I=l.current)==null?void 0:I.value)!==void 0)){let ye=$??"";(X=(W=l.current).onValueChange)==null||X.call(W,ye);return}P.emit()}},emit:()=>{i.current.forEach(N=>N())}}),[]),_=d.useMemo(()=>({value:(N,$,U)=>{var I;$!==((I=o.current.get(N))==null?void 0:I.value)&&(o.current.set(N,{value:$,keywords:U}),n.current.filtered.items.set(N,D($,U)),S(2,()=>{F(),P.emit()}))},item:(N,$)=>(s.current.add(N),$&&(a.current.has($)?a.current.get($).add(N):a.current.set($,new Set([N]))),S(3,()=>{T(),F(),n.current.value||E(),P.emit()}),()=>{o.current.delete(N),s.current.delete(N),n.current.filtered.items.delete(N);let U=Q();S(4,()=>{T(),(U==null?void 0:U.getAttribute("id"))===N&&E(),P.emit()})}),group:N=>(a.current.has(N)||a.current.set(N,new Set),()=>{o.current.delete(N),a.current.delete(N)}),filter:()=>l.current.shouldFilter,label:c||e["aria-label"],disablePointerSelection:p,listId:y,inputId:w,labelId:j,listInnerRef:C}),[]);function D(N,$){var U,I;let W=(I=(U=l.current)==null?void 0:U.filter)!=null?I:Xu;return N?W(N,n.current.search,$):0}function F(){if(!n.current.search||l.current.shouldFilter===!1)return;let N=n.current.filtered.items,$=[];n.current.filtered.groups.forEach(I=>{let W=a.current.get(I),X=0;W.forEach(ye=>{let Qe=N.get(ye);X=Math.max(Qe,X)}),$.push([I,X])});let U=C.current;ce().sort((I,W)=>{var X,ye;let Qe=I.getAttribute("id"),Wt=W.getAttribute("id");return((X=N.get(Wt))!=null?X:0)-((ye=N.get(Qe))!=null?ye:0)}).forEach(I=>{let W=I.closest(Or);W?W.appendChild(I.parentElement===W?I:I.closest(`${Or} > *`)):U.appendChild(I.parentElement===U?I:I.closest(`${Or} > *`))}),$.sort((I,W)=>W[1]-I[1]).forEach(I=>{let W=C.current.querySelector(`${wt}[${Ge}="${encodeURIComponent(I[0])}"]`);W==null||W.parentElement.appendChild(W)})}function E(){let N=ce().find(U=>U.getAttribute("aria-disabled")!=="true"),$=N==null?void 0:N.getAttribute(Ge);P.setState("value",$||void 0)}function T(){var N,$,U,I;if(!n.current.search||l.current.shouldFilter===!1){n.current.filtered.count=s.current.size;return}n.current.filtered.groups=new Set;let W=0;for(let X of s.current){let ye=($=(N=o.current.get(X))==null?void 0:N.value)!=null?$:"",Qe=(I=(U=o.current.get(X))==null?void 0:U.keywords)!=null?I:[],Wt=D(ye,Qe);n.current.filtered.items.set(X,Wt),Wt>0&&W++}for(let[X,ye]of a.current)for(let Qe of ye)if(n.current.filtered.items.get(Qe)>0){n.current.filtered.groups.add(X);break}n.current.filtered.count=W}function L(){var N,$,U;let I=Q();I&&(((N=I.parentElement)==null?void 0:N.firstChild)===I&&((U=($=I.closest(wt))==null?void 0:$.querySelector(Qu))==null||U.scrollIntoView({block:"nearest"})),I.scrollIntoView({block:"nearest"}))}function Q(){var N;return(N=C.current)==null?void 0:N.querySelector(`${Vn}[aria-selected="true"]`)}function ce(){var N;return Array.from((N=C.current)==null?void 0:N.querySelectorAll(ws))}function Ye(N){let $=ce()[N];$&&P.setState("value",$.getAttribute(Ge))}function M(N){var $;let U=Q(),I=ce(),W=I.findIndex(ye=>ye===U),X=I[W+N];($=l.current)!=null&&$.loop&&(X=W+N<0?I[I.length-1]:W+N===I.length?I[0]:I[W+N]),X&&P.setState("value",X.getAttribute(Ge))}function k(N){let $=Q(),U=$==null?void 0:$.closest(wt),I;for(;U&&!I;)U=N>0?af(U,wt):of(U,wt),I=U==null?void 0:U.querySelector(ws);I?P.setState("value",I.getAttribute(Ge)):M(N)}let Te=()=>Ye(ce().length-1),Fe=N=>{N.preventDefault(),N.metaKey?Te():N.altKey?k(1):M(1)},Le=N=>{N.preventDefault(),N.metaKey?Ye(0):N.altKey?k(-1):M(-1)};return d.createElement(we.div,{ref:r,tabIndex:-1,...b,"cmdk-root":"",onKeyDown:N=>{var $;if(($=b.onKeyDown)==null||$.call(b,N),!N.defaultPrevented)switch(N.key){case"n":case"j":{x&&N.ctrlKey&&Fe(N);break}case"ArrowDown":{Fe(N);break}case"p":case"k":{x&&N.ctrlKey&&Le(N);break}case"ArrowUp":{Le(N);break}case"Home":{N.preventDefault(),Ye(0);break}case"End":{N.preventDefault(),Te();break}case"Enter":if(!N.nativeEvent.isComposing&&N.keyCode!==229){N.preventDefault();let U=Q();if(U){let I=new Event(sn);U.dispatchEvent(I)}}}}},d.createElement("label",{"cmdk-label":"",htmlFor:_.inputId,id:_.labelId,style:df},c),yr(e,N=>d.createElement(Oo.Provider,{value:P},d.createElement(Ao.Provider,{value:_},N))))}),Gu=d.forwardRef((e,r)=>{var n,s;let a=d.useId(),o=d.useRef(null),i=d.useContext(To),l=Ft(),c=Lo(e),u=(s=(n=c.current)==null?void 0:n.forceMount)!=null?s:i==null?void 0:i.forceMount;et(()=>{if(!u)return l.item(a,i==null?void 0:i.id)},[u]);let f=Uo(a,o,[e.value,e.children,o],e.keywords),m=Hn(),g=tt(S=>S.value&&S.value===f.current),h=tt(S=>u||l.filter()===!1?!0:S.search?S.filtered.items.get(a)>0:!0);d.useEffect(()=>{let S=o.current;if(!(!S||e.disabled))return S.addEventListener(sn,v),()=>S.removeEventListener(sn,v)},[h,e.onSelect,e.disabled]);function v(){var S,P;p(),(P=(S=c.current).onSelect)==null||P.call(S,f.current)}function p(){m.setState("value",f.current,!0)}if(!h)return null;let{disabled:x,value:b,onSelect:y,forceMount:j,keywords:w,...C}=e;return d.createElement(we.div,{ref:kt([o,r]),...C,id:a,"cmdk-item":"",role:"option","aria-disabled":!!x,"aria-selected":!!g,"data-disabled":!!x,"data-selected":!!g,onPointerMove:x||l.disablePointerSelection?void 0:p,onClick:x?void 0:v},e.children)}),Zu=d.forwardRef((e,r)=>{let{heading:n,children:s,forceMount:a,...o}=e,i=d.useId(),l=d.useRef(null),c=d.useRef(null),u=d.useId(),f=Ft(),m=tt(h=>a||f.filter()===!1?!0:h.search?h.filtered.groups.has(i):!0);et(()=>f.group(i),[]),Uo(i,l,[e.value,e.heading,c]);let g=d.useMemo(()=>({id:i,forceMount:a}),[a]);return d.createElement(we.div,{ref:kt([l,r]),...o,"cmdk-group":"",role:"presentation",hidden:m?void 0:!0},n&&d.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:u},n),yr(e,h=>d.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?u:void 0},d.createElement(To.Provider,{value:g},h))))}),Ju=d.forwardRef((e,r)=>{let{alwaysRender:n,...s}=e,a=d.useRef(null),o=tt(i=>!i.search);return!n&&!o?null:d.createElement(we.div,{ref:kt([a,r]),...s,"cmdk-separator":"",role:"separator"})}),ef=d.forwardRef((e,r)=>{let{onValueChange:n,...s}=e,a=e.value!=null,o=Hn(),i=tt(f=>f.search),l=tt(f=>f.value),c=Ft(),u=d.useMemo(()=>{var f;let m=(f=c.listInnerRef.current)==null?void 0:f.querySelector(`${Vn}[${Ge}="${encodeURIComponent(l)}"]`);return m==null?void 0:m.getAttribute("id")},[]);return d.useEffect(()=>{e.value!=null&&o.setState("search",e.value)},[e.value]),d.createElement(we.input,{ref:r,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":u,id:c.inputId,type:"text",value:a?e.value:i,onChange:f=>{a||o.setState("search",f.target.value),n==null||n(f.target.value)}})}),tf=d.forwardRef((e,r)=>{let{children:n,label:s="Suggestions",...a}=e,o=d.useRef(null),i=d.useRef(null),l=Ft();return d.useEffect(()=>{if(i.current&&o.current){let c=i.current,u=o.current,f,m=new ResizeObserver(()=>{f=requestAnimationFrame(()=>{let g=c.offsetHeight;u.style.setProperty("--cmdk-list-height",g.toFixed(1)+"px")})});return m.observe(c),()=>{cancelAnimationFrame(f),m.unobserve(c)}}},[]),d.createElement(we.div,{ref:kt([o,r]),...a,"cmdk-list":"",role:"listbox","aria-label":s,id:l.listId},yr(e,c=>d.createElement("div",{ref:kt([i,l.listInnerRef]),"cmdk-list-sizer":""},c)))}),rf=d.forwardRef((e,r)=>{let{open:n,onOpenChange:s,overlayClassName:a,contentClassName:o,container:i,...l}=e;return d.createElement(Vu,{open:n,onOpenChange:s},d.createElement(Hu,{container:i},d.createElement(Ku,{"cmdk-overlay":"",className:a}),d.createElement(Yu,{"aria-label":e.label,"cmdk-dialog":"",className:o},d.createElement(Fo,{ref:r,...l}))))}),nf=d.forwardRef((e,r)=>tt(n=>n.filtered.count===0)?d.createElement(we.div,{ref:r,...e,"cmdk-empty":"",role:"presentation"}):null),sf=d.forwardRef((e,r)=>{let{progress:n,children:s,label:a="Loading...",...o}=e;return d.createElement(we.div,{ref:r,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},yr(e,i=>d.createElement("div",{"aria-hidden":!0},i)))}),ge=Object.assign(Fo,{List:tf,Item:Gu,Input:ef,Group:Zu,Separator:Ju,Dialog:rf,Empty:nf,Loading:sf});function af(e,r){let n=e.nextElementSibling;for(;n;){if(n.matches(r))return n;n=n.nextElementSibling}}function of(e,r){let n=e.previousElementSibling;for(;n;){if(n.matches(r))return n;n=n.previousElementSibling}}function Lo(e){let r=d.useRef(e);return et(()=>{r.current=e}),r}var et=typeof window>"u"?d.useEffect:d.useLayoutEffect;function ut(e){let r=d.useRef();return r.current===void 0&&(r.current=e()),r}function kt(e){return r=>{e.forEach(n=>{typeof n=="function"?n(r):n!=null&&(n.current=r)})}}function tt(e){let r=Hn(),n=()=>e(r.snapshot());return d.useSyncExternalStore(r.subscribe,n,n)}function Uo(e,r,n,s=[]){let a=d.useRef(),o=Ft();return et(()=>{var i;let l=(()=>{var u;for(let f of n){if(typeof f=="string")return f.trim();if(typeof f=="object"&&"current"in f)return f.current?(u=f.current.textContent)==null?void 0:u.trim():a.current}})(),c=s.map(u=>u.trim());o.value(e,l,c),(i=r.current)==null||i.setAttribute(Ge,l),a.current=l}),a}var lf=()=>{let[e,r]=d.useState(),n=ut(()=>new Map);return et(()=>{n.current.forEach(s=>s()),n.current=new Map},[e]),(s,a)=>{n.current.set(s,a),r({})}};function cf(e){let r=e.type;return typeof r=="function"?r(e.props):"render"in r?r.render(e.props):e}function yr({asChild:e,children:r},n){return e&&d.isValidElement(r)?d.cloneElement(cf(r),{ref:r.ref},n(r.props.children)):n(r)}var df={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const qo=d.forwardRef(({className:e,...r},n)=>t.jsx(ge,{ref:n,className:O("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...r}));qo.displayName=ge.displayName;const Wo=d.forwardRef(({className:e,...r},n)=>t.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[t.jsx(cn,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),t.jsx(ge.Input,{ref:n,className:O("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...r})]}));Wo.displayName=ge.Input.displayName;const zo=d.forwardRef(({className:e,...r},n)=>t.jsx(ge.List,{ref:n,className:O("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...r}));zo.displayName=ge.List.displayName;const Bo=d.forwardRef((e,r)=>t.jsx(ge.Empty,{ref:r,className:"py-6 text-center text-sm",...e}));Bo.displayName=ge.Empty.displayName;const Vo=d.forwardRef(({className:e,...r},n)=>t.jsx(ge.Group,{ref:n,className:O("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...r}));Vo.displayName=ge.Group.displayName;const uf=d.forwardRef(({className:e,...r},n)=>t.jsx(ge.Separator,{ref:n,className:O("-mx-1 h-px bg-border",e),...r}));uf.displayName=ge.Separator.displayName;const Ho=d.forwardRef(({className:e,...r},n)=>t.jsx(ge.Item,{ref:n,className:O("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...r}));Ho.displayName=ge.Item.displayName;const ff=({products:e,value:r,onValueChange:n,placeholder:s="Поиск продукта...",disabled:a=!1})=>{const[o,i]=d.useState(!1),l=e==null?void 0:e.find(c=>c.id===r);return t.jsxs(Ls,{open:o,onOpenChange:i,children:[t.jsx(Us,{asChild:!0,children:t.jsxs(R,{variant:"outline",role:"combobox","aria-expanded":o,className:"w-full justify-between",disabled:a,children:[l?t.jsxs("div",{className:"flex justify-between items-center w-full",children:[t.jsx("span",{children:l.title}),t.jsxs("span",{className:"text-muted-foreground ml-2",children:[l.price.toLocaleString()," ₽"]})]}):s,t.jsx(wl,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),t.jsx(qs,{className:"w-full p-0",align:"start",children:t.jsxs(qo,{children:[t.jsx(Wo,{placeholder:"Поиск продукта..."}),t.jsxs(zo,{children:[t.jsx(Bo,{children:"Продукт не найден."}),t.jsx(Vo,{children:e==null?void 0:e.map(c=>t.jsxs(Ho,{value:c.title,onSelect:()=>{n(c.id===r?"":c.id),i(!1)},children:[t.jsx(ln,{className:O("mr-2 h-4 w-4",r===c.id?"opacity-100":"opacity-0")}),t.jsxs("div",{className:"flex justify-between items-center w-full",children:[t.jsx("span",{children:c.title}),t.jsxs("span",{className:"text-muted-foreground ml-2",children:[c.price.toLocaleString()," ₽"]})]})]},c.id))})]})]})})]})},mf=({open:e,onOpenChange:r,groupedBooking:n,onSuccess:s})=>{const[a,o]=d.useState(""),[i,l]=d.useState(1),[c,u]=d.useState(!1),{toast:f}=te(),{data:m,isLoading:g}=oe({queryKey:["available-products-for-booking",n.id,n.startDate,n.endDate],queryFn:()=>Fd(n.id,n.startDate,n.endDate),enabled:e}),h=m==null?void 0:m.find(y=>y.id===a),v=h?h.price*i:0,p=(h==null?void 0:h.quantity)||1;Ie.useEffect(()=>{e||(o(""),l(1))},[e]);const x=async()=>{if(!h){f({title:"Ошибка",description:"Пожалуйста, выберите продукт",variant:"destructive"});return}if(i<=0){f({title:"Ошибка",description:"Количество должно быть больше 0",variant:"destructive"});return}if(i>p){f({title:"Ошибка",description:`Максимальное количество: ${p}`,variant:"destructive"});return}u(!0);try{await Ad({bookingId:n.id,productId:a,quantity:i,price:h.price}),f({title:"Успех",description:`Продукт "${h.title}" добавлен в заказ`}),s(),r(!1)}catch(y){console.error("Error adding product to booking:",y),f({title:"Ошибка",description:y.message||"Не удалось добавить продукт в заказ",variant:"destructive"})}finally{u(!1)}},b=h&&i>0&&i<=p;return t.jsx(Ot,{open:e,onOpenChange:r,children:t.jsxs(yt,{className:"sm:max-w-md",children:[t.jsx(bt,{children:t.jsx(jt,{children:"Добавить продукт в заказ"})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Продукт"}),g?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(Y,{className:"h-6 w-6 animate-spin mr-2"}),t.jsx("span",{children:"Загрузка продуктов..."})]}):(m==null?void 0:m.length)===0?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-sm text-muted-foreground",children:"Нет доступных продуктов для добавления"})}):t.jsx(ff,{products:m||[],value:a,onValueChange:o,placeholder:"Поиск и выбор продукта...",disabled:g})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Количество"}),t.jsx(vl,{quantity:i,onQuantityChange:l,maxQuantity:p,minQuantity:1,disabled:!h}),h&&i>p&&t.jsxs("p",{className:"text-sm text-destructive mt-1",children:["Максимальное доступное количество: ",p]})]}),t.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Стоимость:"}),t.jsxs("span",{className:"font-medium",children:[v.toLocaleString()," ₽"]})]}),h&&t.jsx("div",{className:"flex justify-between items-center mt-1",children:t.jsxs("span",{className:"text-xs text-muted-foreground",children:[h.price.toLocaleString()," ₽ × ",i]})})]}),t.jsxs("div",{className:"flex gap-2 pt-4",children:[t.jsx(R,{variant:"outline",onClick:()=>r(!1),className:"flex-1",disabled:c,children:"Отмена"}),t.jsx(R,{onClick:x,disabled:!b||c,className:"flex-1",children:c?t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"h-4 w-4 animate-spin mr-2"}),"Добавление..."]}):"Добавить"})]})]})]})})},hf=({bookingId:e,productId:r,currentQuantity:n,onSuccess:s})=>{const[a,o]=d.useState(!1),[i,l]=d.useState(n),[c,u]=d.useState(!1),{toast:f}=te(),m=async()=>{if(i===n){o(!1);return}if(i<0){f({title:"Ошибка",description:"Количество не может быть отрицательным",variant:"destructive"});return}u(!0);try{await Od({bookingId:e,productId:r,newQuantity:i}),f({title:"Успех",description:i===0?"Товар удален из заказа":"Количество обновлено"}),s(),o(!1)}catch(h){console.error("Error updating quantity:",h),f({title:"Ошибка",description:h.message||"Не удалось обновить количество",variant:"destructive"}),l(n)}finally{u(!1)}},g=()=>{l(n),o(!1)};return a?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ie,{type:"number",value:i,onChange:h=>l(parseInt(h.target.value)||0),className:"w-20 h-8",min:"0",autoFocus:!0}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(R,{size:"sm",variant:"ghost",onClick:m,disabled:c,className:"h-8 w-8 p-0",children:t.jsx(ln,{className:"h-4 w-4 text-green-600"})}),t.jsx(R,{size:"sm",variant:"ghost",onClick:g,disabled:c,className:"h-8 w-8 p-0",children:t.jsx(on,{className:"h-4 w-4 text-red-600"})})]})]}):t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-sm",children:[n," шт."]}),t.jsx(R,{size:"sm",variant:"ghost",onClick:()=>o(!0),className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx(Ml,{className:"h-3 w-3"})})]})},gf=({groupedBooking:e,onStatusUpdate:r,onDelete:n,isDeleting:s,onItemsChanged:a})=>{var g;const[o,i]=d.useState(!1),l=async(h,v)=>{h.preventDefault(),h.stopPropagation(),console.log("Delete button clicked for booking:",v),n?(console.log("Calling onDelete function"),await n(v)):console.log("onDelete function not provided")},c=h=>{h.stopPropagation()},u=()=>{a&&a()},f=e.items[0],m=f==null?void 0:f.product;return t.jsxs("div",{className:"mt-4 p-4 bg-muted/30 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"text-sm font-medium",children:"Детали заказа"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Статус:"}),t.jsx("div",{onClick:c,children:t.jsx(yo,{booking:{id:e.id,productId:(f==null?void 0:f.productId)||"",customerName:e.customerName,customerEmail:e.customerEmail,customerPhone:e.customerPhone,startDate:e.startDate,endDate:e.endDate,status:e.status,totalPrice:e.totalPrice,quantity:e.items.reduce((h,v)=>h+v.quantity,0),notes:e.notes||"",createdAt:e.createdAt,product:m||void 0},onStatusUpdate:r,showAllOptions:!0})})]}),t.jsx("div",{className:"h-4 w-px bg-border"}),t.jsxs(R,{variant:"outline",size:"sm",onClick:()=>i(!0),className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:[t.jsx(cr,{className:"h-4 w-4 mr-1"}),"Добавить товар"]}),t.jsx(R,{variant:"outline",size:"sm",onClick:h=>l(h,e.id),disabled:s===e.id,className:"text-red-600 hover:text-red-700 hover:bg-red-50 disabled:opacity-50",children:s===e.id?t.jsx(Y,{className:"h-4 w-4 animate-spin"}):t.jsx(At,{className:"h-4 w-4"})})]})]}),t.jsxs(hr,{children:[t.jsx(gr,{children:t.jsxs(_e,{children:[t.jsx(J,{children:"Товар"}),t.jsx(J,{children:"Количество"}),t.jsx(J,{children:"Цена за единицу"}),t.jsx(J,{children:"Сумма"})]})}),t.jsxs(vr,{children:[e.items.map((h,v)=>{var p,x,b;return t.jsxs(_e,{className:"group",children:[t.jsx(K,{children:t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"text-sm",children:((p=h.product)==null?void 0:p.title)||"Неизвестный продукт"})})}),t.jsx(K,{children:t.jsx(hf,{bookingId:e.id,productId:h.productId,currentQuantity:h.quantity,onSuccess:u})}),t.jsx(K,{children:(x=h.product)!=null&&x.price?`${h.product.price.toLocaleString()} ₽`:"—"}),t.jsx(K,{className:"font-medium",children:(b=h.product)!=null&&b.price&&h.quantity?`${(h.product.price*h.quantity).toLocaleString()} ₽`:"—"})]},`${e.id}-detail-${v}`)}),t.jsxs(_e,{className:"border-t-2 font-medium bg-muted/20",children:[t.jsx(K,{colSpan:3,className:"text-right",children:"Итого:"}),t.jsxs(K,{className:"font-bold",children:[((g=e.totalPrice)==null?void 0:g.toLocaleString())||"0"," ₽"]})]})]})]}),t.jsx(mf,{open:o,onOpenChange:i,groupedBooking:e,onSuccess:u})]})},vf=({groupedBooking:e,allBookings:r,onViewDetails:n,onStatusUpdate:s,onDelete:a,isDeleting:o,onItemsChanged:i})=>{var h,v;const[l,c]=d.useState(!1),u=async p=>{p.preventDefault(),p.stopPropagation();const b=e.items.length>1?`Вы уверены, что хотите удалить весь заказ? Это удалит ${e.items.length} товаров.`:"Вы уверены, что хотите удалить это бронирование?";confirm(b)&&await a(e.id)},f=()=>{c(!l)},m=e.items[0],g=e.items.length>1;return t.jsxs(t.Fragment,{children:[t.jsxs(_e,{className:"cursor-pointer hover:bg-muted/50",onClick:f,children:[t.jsx(K,{children:t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium",children:e.customerName}),t.jsx("div",{className:"text-sm text-muted-foreground",children:e.customerEmail}),t.jsx("div",{className:"text-sm text-muted-foreground",children:e.customerPhone})]})}),t.jsx(K,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[l?t.jsx(Ui,{className:"h-4 w-4"}):t.jsx(dn,{className:"h-4 w-4"}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium",children:[((h=m==null?void 0:m.product)==null?void 0:h.title)||"Неизвестный продукт",g&&t.jsxs(De,{variant:"secondary",className:"ml-2 text-xs",children:["+",e.items.length-1," товар(ов)"]})]}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Общее кол-во: ",e.items.reduce((p,x)=>p+x.quantity,0)," шт."]})]})]})}),t.jsx(K,{className:"w-1/4",children:t.jsxs("div",{className:"text-sm",children:[t.jsx("div",{children:new Date(e.startDate).toLocaleDateString()}),t.jsxs("div",{className:"text-muted-foreground",children:["до ",new Date(e.endDate).toLocaleDateString()]})]})}),t.jsx(K,{className:"w-1/6",children:t.jsxs("div",{className:"font-medium",children:[((v=e.totalPrice)==null?void 0:v.toLocaleString())||"0"," ₽"]})}),t.jsx(K,{className:"text-right",children:t.jsx("div",{className:"flex gap-2 justify-end",onClick:p=>p.stopPropagation(),children:t.jsx(R,{variant:"outline",size:"sm",onClick:u,disabled:o===e.id,className:"text-red-600 hover:text-red-700",children:o===e.id?t.jsx(Y,{className:"h-4 w-4 animate-spin"}):t.jsx(At,{className:"h-4 w-4"})})})})]}),l&&t.jsx(_e,{children:t.jsx(K,{colSpan:5,className:"p-0",children:t.jsx(gf,{groupedBooking:e,onStatusUpdate:s,onDelete:a,isDeleting:o,onItemsChanged:i})})})]})},pf=({bookings:e,isLoading:r,isError:n,onViewDetails:s,onStatusUpdate:a,onDelete:o,isDeleting:i,groupedBookings:l,onItemsChanged:c})=>r?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(Y,{className:"h-8 w-8 animate-spin"}),t.jsx("span",{className:"ml-2",children:"Загрузка бронирований..."})]}):n?t.jsx(Be,{variant:"destructive",children:t.jsx(Ve,{children:"Ошибка при загрузке бронирований. Пожалуйста, попробуйте еще раз."})}):l.length===0?t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Бронирования не найдены"}):t.jsx("div",{className:"rounded-md border",children:t.jsxs(hr,{children:[t.jsx(gr,{children:t.jsxs(_e,{children:[t.jsx(J,{children:"Клиент"}),t.jsx(J,{children:"Товары"}),t.jsx(J,{className:"w-1/4",children:"Даты"}),t.jsx(J,{className:"w-1/6",children:"Сумма"}),t.jsx(J,{className:"text-right",children:"Действия"})]})}),t.jsx(vr,{children:l.map(u=>t.jsx(vf,{groupedBooking:u,allBookings:e,onViewDetails:s,onStatusUpdate:a,onDelete:o,isDeleting:i,onItemsChanged:c},u.id))})]})}),xf=({booking:e,open:r,onOpenChange:n,onStatusUpdate:s,onItemsChanged:a})=>{var o,i;return e?t.jsx(Ot,{open:r,onOpenChange:n,children:t.jsxs(yt,{className:"max-w-md",children:[t.jsx(bt,{children:t.jsx(jt,{children:"Детали бронирования"})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Js,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.customerName}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Клиент"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(qi,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.customerEmail}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Email"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Wi,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.customerPhone}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Телефон"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ws,{className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium",children:[new Date(e.startDate).toLocaleDateString()," - ",new Date(e.endDate).toLocaleDateString()]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Период аренды"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm font-medium",children:"Продукт:"}),t.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:((o=e.product)==null?void 0:o.title)||"Неизвестный продукт"}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Количество: ",e.quantity," шт."]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"font-medium",children:[(i=e.totalPrice)==null?void 0:i.toLocaleString()," ₽"]})})]})]}),e.notes&&t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(Cl,{className:"h-4 w-4 text-muted-foreground mt-1"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:"Примечания:"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:e.notes})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[t.jsx("span",{className:"text-sm font-medium",children:"Статус:"}),t.jsx(yo,{booking:e,onStatusUpdate:s})]})]})]})}):null},yf=()=>{const[e,r]=d.useState(""),[n,s]=d.useState("all"),[a,o]=d.useState(null),[i,l]=d.useState(!1),[c,u]=d.useState(null),[f,m]=d.useState(!1),{toast:g}=te(),h=Pe(),{data:v}=oe({queryKey:["admin-products"],queryFn:xn}),{data:p,refetch:x,isLoading:b,isError:y}=oe({queryKey:["bookings"],queryFn:zs}),j=Ie.useMemo(()=>!p||!v?[]:p.map(E=>{const T=v.find(L=>L.id===E.productId);return{...E,product:T}}),[p,v]),w=Ie.useMemo(()=>{if(!j)return[];let E=[...j];if(e){const T=e.toLowerCase();E=E.filter(L=>{var Q;return L.customerName.toLowerCase().includes(T)||L.customerEmail.toLowerCase().includes(T)||L.customerPhone.toLowerCase().includes(T)||((Q=L.product)==null?void 0:Q.title.toLowerCase().includes(T))||!1})}return n!=="all"&&(E=E.filter(T=>T.status===n)),E},[j,e,n]),C=Ie.useMemo(()=>{console.log("AdminBookings - Grouping filtered bookings:",w.length);const E=ta(w);return console.log("AdminBookings - Grouped result:",E.length),E},[w]),S=async()=>{m(!0);try{console.log("Starting status analysis and cleanup...");const E=await kd();g({title:"Анализ завершен",description:`Проанализировано заказов: ${E.analyzed}, исправлено: ${E.fixed}`}),E.issues.length>0&&(console.log("Issues found and fixed:",E.issues),g({title:"Найдены и исправлены проблемы",description:`Исправлено ${E.issues.length} заказов с несогласованными статусами`})),await h.invalidateQueries({queryKey:["bookings"]})}catch(E){console.error("Error during status analysis:",E),g({title:"Ошибка анализа",description:E.message||"Не удалось выполнить анализ статусов",variant:"destructive"})}finally{m(!1)}},P=async(E,T)=>{try{console.log("Updating booking status:",E,T);const L=j.find(Q=>Q.id===E);if(!L)throw new Error("Бронирование не найдено");L.order_id?(console.log("Updating entire order status:",L.order_id,T),await xo(L.order_id,T),g({title:"Успех",description:"Статус заказа обновлен для всех связанных бронирований."})):(await zi(E,T),g({title:"Успех",description:"Статус бронирования успешно обновлен."})),await h.invalidateQueries({queryKey:["bookings"]}),l(!1)}catch(L){console.error("Error updating booking status:",L),g({title:"Ошибка",description:L.message||"Не удалось обновить статус бронирования.",variant:"destructive"})}},_=async E=>{if(console.log("handleDeleteBooking called with id:",E),c===E){console.log("Already deleting this booking, ignoring request");return}const T=confirm("Вы уверены, что хотите удалить это бронирование? Это действие нельзя отменить.");if(console.log("User confirmed deletion:",T),!!T){u(E);try{console.log("Calling deleteBooking service for ID:",E);const L=await Bi(E);console.log("Booking deletion result:",L),g({title:"Успех",description:"Бронирование успешно удалено."}),console.log("Invalidating queries to refresh data"),await h.invalidateQueries({queryKey:["bookings"]}),(a==null?void 0:a.id)===E&&(console.log("Closing dialog for deleted booking"),l(!1),o(null))}catch(L){console.error("Error deleting booking:",L),g({title:"Ошибка",description:L.message||"Не удалось удалить бронирование.",variant:"destructive"})}finally{u(null)}}},D=async()=>{console.log("Booking items changed, refreshing data"),await h.invalidateQueries({queryKey:["bookings"]}),await h.invalidateQueries({queryKey:["admin-products"]})},F=E=>{console.log("Opening details for booking:",E.id),o(E),l(!0)};return t.jsxs("div",{className:"container mx-auto py-10",children:[t.jsxs(se,{className:"shadow-md",children:[t.jsx(ue,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(ve,{className:"text-2xl font-bold",children:"Управление бронированиями"}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(R,{variant:"outline",onClick:S,disabled:f,className:"flex items-center gap-2",children:[f?t.jsx(hn,{className:"h-4 w-4 animate-spin"}):t.jsx(Jt,{className:"h-4 w-4"}),f?"Анализируем...":"Исправить статусы"]})})]})}),t.jsxs(ae,{children:[t.jsx(Rd,{search:e,setSearch:r,statusFilter:n,setStatusFilter:s}),t.jsx(pf,{bookings:w,isLoading:b,isError:y,onViewDetails:F,onStatusUpdate:P,onDelete:_,isDeleting:c,groupedBookings:C,onItemsChanged:D})]})]}),t.jsx(xf,{booking:a,open:i,onOpenChange:l,onStatusUpdate:P,onItemsChanged:D})]})};var A=function(){return A=Object.assign||function(r){for(var n,s=1,a=arguments.length;s<a;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},A.apply(this,arguments)};function bf(e,r){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&r.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)r.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]]);return n}function Ko(e,r,n){for(var s=0,a=r.length,o;s<a;s++)(o||!(s in r))&&(o||(o=Array.prototype.slice.call(r,0,s)),o[s]=r[s]);return e.concat(o||Array.prototype.slice.call(r))}function Lt(e){return e.mode==="multiple"}function Ut(e){return e.mode==="range"}function br(e){return e.mode==="single"}var jf={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function wf(e,r){return pe(e,"LLLL y",r)}function Nf(e,r){return pe(e,"d",r)}function Cf(e,r){return pe(e,"LLLL",r)}function Sf(e){return"".concat(e)}function Ef(e,r){return pe(e,"cccccc",r)}function Df(e,r){return pe(e,"yyyy",r)}var _f=Object.freeze({__proto__:null,formatCaption:wf,formatDay:Nf,formatMonthCaption:Cf,formatWeekNumber:Sf,formatWeekdayName:Ef,formatYearCaption:Df}),Pf=function(e,r,n){return pe(e,"do MMMM (EEEE)",n)},kf=function(){return"Month: "},Mf=function(){return"Go to next month"},Rf=function(){return"Go to previous month"},$f=function(e,r){return pe(e,"cccc",r)},If=function(e){return"Week n. ".concat(e)},Af=function(){return"Year: "},Of=Object.freeze({__proto__:null,labelDay:Pf,labelMonthDropdown:kf,labelNext:Mf,labelPrevious:Rf,labelWeekNumber:If,labelWeekday:$f,labelYearDropdown:Af});function Tf(){var e="buttons",r=jf,n=ks,s={},a={},o=1,i={},l=new Date;return{captionLayout:e,classNames:r,formatters:_f,labels:Of,locale:n,modifiersClassNames:s,modifiers:a,numberOfMonths:o,styles:i,today:l,mode:"default"}}function Ff(e){var r=e.fromYear,n=e.toYear,s=e.fromMonth,a=e.toMonth,o=e.fromDate,i=e.toDate;return s?o=me(s):r&&(o=new Date(r,0,1)),a?i=dr(a):n&&(i=new Date(n,11,31)),{fromDate:o?rr(o):void 0,toDate:i?rr(i):void 0}}var Yo=d.createContext(void 0);function Lf(e){var r,n=e.initialProps,s=Tf(),a=Ff(n),o=a.fromDate,i=a.toDate,l=(r=n.captionLayout)!==null&&r!==void 0?r:s.captionLayout;l!=="buttons"&&(!o||!i)&&(l="buttons");var c;(br(n)||Lt(n)||Ut(n))&&(c=n.onSelect);var u=A(A(A({},s),n),{captionLayout:l,classNames:A(A({},s.classNames),n.classNames),components:A({},n.components),formatters:A(A({},s.formatters),n.formatters),fromDate:o,labels:A(A({},s.labels),n.labels),mode:n.mode||s.mode,modifiers:A(A({},s.modifiers),n.modifiers),modifiersClassNames:A(A({},s.modifiersClassNames),n.modifiersClassNames),onSelect:c,styles:A(A({},s.styles),n.styles),toDate:i});return t.jsx(Yo.Provider,{value:u,children:e.children})}function B(){var e=d.useContext(Yo);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function Qo(e){var r=B(),n=r.locale,s=r.classNames,a=r.styles,o=r.formatters.formatCaption;return t.jsx("div",{className:s.caption_label,style:a.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:n})})}function Uf(e){return t.jsx("svg",A({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:t.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Xo(e){var r,n,s=e.onChange,a=e.value,o=e.children,i=e.caption,l=e.className,c=e.style,u=B(),f=(n=(r=u.components)===null||r===void 0?void 0:r.IconDropdown)!==null&&n!==void 0?n:Uf;return t.jsxs("div",{className:l,style:c,children:[t.jsx("span",{className:u.classNames.vhidden,children:e["aria-label"]}),t.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:u.classNames.dropdown,style:u.styles.dropdown,value:a,onChange:s,children:o}),t.jsxs("div",{className:u.classNames.caption_label,style:u.styles.caption_label,"aria-hidden":"true",children:[i,t.jsx(f,{className:u.classNames.dropdown_icon,style:u.styles.dropdown_icon})]})]})}function qf(e){var r,n=B(),s=n.fromDate,a=n.toDate,o=n.styles,i=n.locale,l=n.formatters.formatMonthCaption,c=n.classNames,u=n.components,f=n.labels.labelMonthDropdown;if(!s)return t.jsx(t.Fragment,{});if(!a)return t.jsx(t.Fragment,{});var m=[];if(Zl(s,a))for(var g=me(s),h=s.getMonth();h<=a.getMonth();h++)m.push(_r(g,h));else for(var g=me(new Date),h=0;h<=11;h++)m.push(_r(g,h));var v=function(x){var b=Number(x.target.value),y=_r(me(e.displayMonth),b);e.onChange(y)},p=(r=u==null?void 0:u.Dropdown)!==null&&r!==void 0?r:Xo;return t.jsx(p,{name:"months","aria-label":f(),className:c.dropdown_month,style:o.dropdown_month,onChange:v,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:i}),children:m.map(function(x){return t.jsx("option",{value:x.getMonth(),children:l(x,{locale:i})},x.getMonth())})})}function Wf(e){var r,n=e.displayMonth,s=B(),a=s.fromDate,o=s.toDate,i=s.locale,l=s.styles,c=s.classNames,u=s.components,f=s.formatters.formatYearCaption,m=s.labels.labelYearDropdown,g=[];if(!a)return t.jsx(t.Fragment,{});if(!o)return t.jsx(t.Fragment,{});for(var h=a.getFullYear(),v=o.getFullYear(),p=h;p<=v;p++)g.push(as(Vi(new Date),p));var x=function(y){var j=as(me(n),Number(y.target.value));e.onChange(j)},b=(r=u==null?void 0:u.Dropdown)!==null&&r!==void 0?r:Xo;return t.jsx(b,{name:"years","aria-label":m(),className:c.dropdown_year,style:l.dropdown_year,onChange:x,value:n.getFullYear(),caption:f(n,{locale:i}),children:g.map(function(y){return t.jsx("option",{value:y.getFullYear(),children:f(y,{locale:i})},y.getFullYear())})})}function zf(e,r){var n=d.useState(e),s=n[0],a=n[1],o=r===void 0?s:r;return[o,a]}function Bf(e){var r=e.month,n=e.defaultMonth,s=e.today,a=r||n||s||new Date,o=e.toDate,i=e.fromDate,l=e.numberOfMonths,c=l===void 0?1:l;if(o&&vt(o,a)<0){var u=-1*(c-1);a=Ce(o,u)}return i&&vt(a,i)<0&&(a=i),me(a)}function Vf(){var e=B(),r=Bf(e),n=zf(r,e.month),s=n[0],a=n[1],o=function(i){var l;if(!e.disableNavigation){var c=me(i);a(c),(l=e.onMonthChange)===null||l===void 0||l.call(e,c)}};return[s,o]}function Hf(e,r){for(var n=r.reverseMonths,s=r.numberOfMonths,a=me(e),o=me(Ce(a,s)),i=vt(o,a),l=[],c=0;c<i;c++){var u=Ce(a,c);l.push(u)}return n&&(l=l.reverse()),l}function Kf(e,r){if(!r.disableNavigation){var n=r.toDate,s=r.pagedNavigation,a=r.numberOfMonths,o=a===void 0?1:a,i=s?o:1,l=me(e);if(!n)return Ce(l,i);var c=vt(n,e);if(!(c<o))return Ce(l,i)}}function Yf(e,r){if(!r.disableNavigation){var n=r.fromDate,s=r.pagedNavigation,a=r.numberOfMonths,o=a===void 0?1:a,i=s?o:1,l=me(e);if(!n)return Ce(l,-i);var c=vt(l,n);if(!(c<=0))return Ce(l,-i)}}var Go=d.createContext(void 0);function Qf(e){var r=B(),n=Vf(),s=n[0],a=n[1],o=Hf(s,r),i=Kf(s,r),l=Yf(s,r),c=function(m){return o.some(function(g){return pn(m,g)})},u=function(m,g){c(m)||(g&&Bs(m,g)?a(Ce(m,1+r.numberOfMonths*-1)):a(m))},f={currentMonth:s,displayMonths:o,goToMonth:a,goToDate:u,previousMonth:l,nextMonth:i,isDateDisplayed:c};return t.jsx(Go.Provider,{value:f,children:e.children})}function qt(){var e=d.useContext(Go);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function Ns(e){var r,n=B(),s=n.classNames,a=n.styles,o=n.components,i=qt().goToMonth,l=function(f){i(Ce(f,e.displayIndex?-e.displayIndex:0))},c=(r=o==null?void 0:o.CaptionLabel)!==null&&r!==void 0?r:Qo,u=t.jsx(c,{id:e.id,displayMonth:e.displayMonth});return t.jsxs("div",{className:s.caption_dropdowns,style:a.caption_dropdowns,children:[t.jsx("div",{className:s.vhidden,children:u}),t.jsx(qf,{onChange:l,displayMonth:e.displayMonth}),t.jsx(Wf,{onChange:l,displayMonth:e.displayMonth})]})}function Xf(e){return t.jsx("svg",A({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:t.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Gf(e){return t.jsx("svg",A({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:t.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var ir=d.forwardRef(function(e,r){var n=B(),s=n.classNames,a=n.styles,o=[s.button_reset,s.button];e.className&&o.push(e.className);var i=o.join(" "),l=A(A({},a.button_reset),a.button);return e.style&&Object.assign(l,e.style),t.jsx("button",A({},e,{ref:r,type:"button",className:i,style:l}))});function Zf(e){var r,n,s=B(),a=s.dir,o=s.locale,i=s.classNames,l=s.styles,c=s.labels,u=c.labelPrevious,f=c.labelNext,m=s.components;if(!e.nextMonth&&!e.previousMonth)return t.jsx(t.Fragment,{});var g=u(e.previousMonth,{locale:o}),h=[i.nav_button,i.nav_button_previous].join(" "),v=f(e.nextMonth,{locale:o}),p=[i.nav_button,i.nav_button_next].join(" "),x=(r=m==null?void 0:m.IconRight)!==null&&r!==void 0?r:Gf,b=(n=m==null?void 0:m.IconLeft)!==null&&n!==void 0?n:Xf;return t.jsxs("div",{className:i.nav,style:l.nav,children:[!e.hidePrevious&&t.jsx(ir,{name:"previous-month","aria-label":g,className:h,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:a==="rtl"?t.jsx(x,{className:i.nav_icon,style:l.nav_icon}):t.jsx(b,{className:i.nav_icon,style:l.nav_icon})}),!e.hideNext&&t.jsx(ir,{name:"next-month","aria-label":v,className:p,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:a==="rtl"?t.jsx(b,{className:i.nav_icon,style:l.nav_icon}):t.jsx(x,{className:i.nav_icon,style:l.nav_icon})})]})}function Cs(e){var r=B().numberOfMonths,n=qt(),s=n.previousMonth,a=n.nextMonth,o=n.goToMonth,i=n.displayMonths,l=i.findIndex(function(v){return pn(e.displayMonth,v)}),c=l===0,u=l===i.length-1,f=r>1&&(c||!u),m=r>1&&(u||!c),g=function(){s&&o(s)},h=function(){a&&o(a)};return t.jsx(Zf,{displayMonth:e.displayMonth,hideNext:f,hidePrevious:m,nextMonth:a,previousMonth:s,onPreviousClick:g,onNextClick:h})}function Jf(e){var r,n=B(),s=n.classNames,a=n.disableNavigation,o=n.styles,i=n.captionLayout,l=n.components,c=(r=l==null?void 0:l.CaptionLabel)!==null&&r!==void 0?r:Qo,u;return a?u=t.jsx(c,{id:e.id,displayMonth:e.displayMonth}):i==="dropdown"?u=t.jsx(Ns,{displayMonth:e.displayMonth,id:e.id}):i==="dropdown-buttons"?u=t.jsxs(t.Fragment,{children:[t.jsx(Ns,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),t.jsx(Cs,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):u=t.jsxs(t.Fragment,{children:[t.jsx(c,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),t.jsx(Cs,{displayMonth:e.displayMonth,id:e.id})]}),t.jsx("div",{className:s.caption,style:o.caption,children:u})}function em(e){var r=B(),n=r.footer,s=r.styles,a=r.classNames.tfoot;return n?t.jsx("tfoot",{className:a,style:s.tfoot,children:t.jsx("tr",{children:t.jsx("td",{colSpan:8,children:n})})}):t.jsx(t.Fragment,{})}function tm(e,r,n){for(var s=n?un(new Date):Dt(new Date,{locale:e,weekStartsOn:r}),a=[],o=0;o<7;o++){var i=Z(s,o);a.push(i)}return a}function rm(){var e=B(),r=e.classNames,n=e.styles,s=e.showWeekNumber,a=e.locale,o=e.weekStartsOn,i=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,u=tm(a,o,i);return t.jsxs("tr",{style:n.head_row,className:r.head_row,children:[s&&t.jsx("td",{style:n.head_cell,className:r.head_cell}),u.map(function(f,m){return t.jsx("th",{scope:"col",className:r.head_cell,style:n.head_cell,"aria-label":c(f,{locale:a}),children:l(f,{locale:a})},m)})]})}function nm(){var e,r=B(),n=r.classNames,s=r.styles,a=r.components,o=(e=a==null?void 0:a.HeadRow)!==null&&e!==void 0?e:rm;return t.jsx("thead",{style:s.head,className:n.head,children:t.jsx(o,{})})}function sm(e){var r=B(),n=r.locale,s=r.formatters.formatDay;return t.jsx(t.Fragment,{children:s(e.date,{locale:n})})}var Kn=d.createContext(void 0);function am(e){if(!Lt(e.initialProps)){var r={selected:void 0,modifiers:{disabled:[]}};return t.jsx(Kn.Provider,{value:r,children:e.children})}return t.jsx(om,{initialProps:e.initialProps,children:e.children})}function om(e){var r=e.initialProps,n=e.children,s=r.selected,a=r.min,o=r.max,i=function(u,f,m){var g,h;(g=r.onDayClick)===null||g===void 0||g.call(r,u,f,m);var v=!!(f.selected&&a&&(s==null?void 0:s.length)===a);if(!v){var p=!!(!f.selected&&o&&(s==null?void 0:s.length)===o);if(!p){var x=s?Ko([],s):[];if(f.selected){var b=x.findIndex(function(y){return re(u,y)});x.splice(b,1)}else x.push(u);(h=r.onSelect)===null||h===void 0||h.call(r,x,u,f,m)}}},l={disabled:[]};s&&l.disabled.push(function(u){var f=o&&s.length>o-1,m=s.some(function(g){return re(g,u)});return!!(f&&!m)});var c={selected:s,onDayClick:i,modifiers:l};return t.jsx(Kn.Provider,{value:c,children:n})}function Yn(){var e=d.useContext(Kn);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function im(e,r){var n=r||{},s=n.from,a=n.to;return s&&a?re(a,e)&&re(s,e)?void 0:re(a,e)?{from:a,to:void 0}:re(s,e)?void 0:Yr(s,e)?{from:e,to:a}:{from:s,to:e}:a?Yr(e,a)?{from:a,to:e}:{from:e,to:a}:s?Bs(e,s)?{from:e,to:s}:{from:s,to:e}:{from:e,to:void 0}}var Qn=d.createContext(void 0);function lm(e){if(!Ut(e.initialProps)){var r={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return t.jsx(Qn.Provider,{value:r,children:e.children})}return t.jsx(cm,{initialProps:e.initialProps,children:e.children})}function cm(e){var r=e.initialProps,n=e.children,s=r.selected,a=s||{},o=a.from,i=a.to,l=r.min,c=r.max,u=function(h,v,p){var x,b;(x=r.onDayClick)===null||x===void 0||x.call(r,h,v,p);var y=im(h,s);(b=r.onSelect)===null||b===void 0||b.call(r,y,h,v,p)},f={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(f.range_start=[o],i?(f.range_end=[i],re(o,i)||(f.range_middle=[{after:o,before:i}])):f.range_end=[o]):i&&(f.range_start=[i],f.range_end=[i]),l&&(o&&!i&&f.disabled.push({after:Dr(o,l-1),before:Z(o,l-1)}),o&&i&&f.disabled.push({after:o,before:Z(o,l-1)}),!o&&i&&f.disabled.push({after:Dr(i,l-1),before:Z(i,l-1)})),c){if(o&&!i&&(f.disabled.push({before:Z(o,-c+1)}),f.disabled.push({after:Z(o,c-1)})),o&&i){var m=$e(i,o)+1,g=c-m;f.disabled.push({before:Dr(o,g)}),f.disabled.push({after:Z(i,g)})}!o&&i&&(f.disabled.push({before:Z(i,-c+1)}),f.disabled.push({after:Z(i,c-1)}))}return t.jsx(Qn.Provider,{value:{selected:s,onDayClick:u,modifiers:f},children:n})}function Xn(){var e=d.useContext(Qn);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function Xt(e){return Array.isArray(e)?Ko([],e):e!==void 0?[e]:[]}function dm(e){var r={};return Object.entries(e).forEach(function(n){var s=n[0],a=n[1];r[s]=Xt(a)}),r}var Se;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Se||(Se={}));var um=Se.Selected,Me=Se.Disabled,fm=Se.Hidden,mm=Se.Today,Tr=Se.RangeEnd,Fr=Se.RangeMiddle,Lr=Se.RangeStart,hm=Se.Outside;function gm(e,r,n){var s,a=(s={},s[um]=Xt(e.selected),s[Me]=Xt(e.disabled),s[fm]=Xt(e.hidden),s[mm]=[e.today],s[Tr]=[],s[Fr]=[],s[Lr]=[],s[hm]=[],s);return e.fromDate&&a[Me].push({before:e.fromDate}),e.toDate&&a[Me].push({after:e.toDate}),Lt(e)?a[Me]=a[Me].concat(r.modifiers[Me]):Ut(e)&&(a[Me]=a[Me].concat(n.modifiers[Me]),a[Lr]=n.modifiers[Lr],a[Fr]=n.modifiers[Fr],a[Tr]=n.modifiers[Tr]),a}var Zo=d.createContext(void 0);function vm(e){var r=B(),n=Yn(),s=Xn(),a=gm(r,n,s),o=dm(r.modifiers),i=A(A({},a),o);return t.jsx(Zo.Provider,{value:i,children:e.children})}function Jo(){var e=d.useContext(Zo);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function pm(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function xm(e){return!!(e&&typeof e=="object"&&"from"in e)}function ym(e){return!!(e&&typeof e=="object"&&"after"in e)}function bm(e){return!!(e&&typeof e=="object"&&"before"in e)}function jm(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function wm(e,r){var n,s=r.from,a=r.to;if(s&&a){var o=$e(a,s)<0;o&&(n=[a,s],s=n[0],a=n[1]);var i=$e(e,s)>=0&&$e(a,e)>=0;return i}return a?re(a,e):s?re(s,e):!1}function Nm(e){return Vs(e)}function Cm(e){return Array.isArray(e)&&e.every(Vs)}function Sm(e,r){return r.some(function(n){if(typeof n=="boolean")return n;if(Nm(n))return re(e,n);if(Cm(n))return n.includes(e);if(xm(n))return wm(e,n);if(jm(n))return n.dayOfWeek.includes(e.getDay());if(pm(n)){var s=$e(n.before,e),a=$e(n.after,e),o=s>0,i=a<0,l=Yr(n.before,n.after);return l?i&&o:o||i}return ym(n)?$e(e,n.after)>0:bm(n)?$e(n.before,e)>0:typeof n=="function"?n(e):!1})}function Gn(e,r,n){var s=Object.keys(r).reduce(function(o,i){var l=r[i];return Sm(e,l)&&o.push(i),o},[]),a={};return s.forEach(function(o){return a[o]=!0}),n&&!pn(e,n)&&(a.outside=!0),a}function Em(e,r){for(var n=me(e[0]),s=dr(e[e.length-1]),a,o,i=n;i<=s;){var l=Gn(i,r),c=!l.disabled&&!l.hidden;if(!c){i=Z(i,1);continue}if(l.selected)return i;l.today&&!o&&(o=i),a||(a=i),i=Z(i,1)}return o||a}var Dm=365;function ei(e,r){var n=r.moveBy,s=r.direction,a=r.context,o=r.modifiers,i=r.retry,l=i===void 0?{count:0,lastFocused:e}:i,c=a.weekStartsOn,u=a.fromDate,f=a.toDate,m=a.locale,g={day:Z,week:Xr,month:Ce,year:Fl,startOfWeek:function(x){return a.ISOWeek?un(x):Dt(x,{locale:m,weekStartsOn:c})},endOfWeek:function(x){return a.ISOWeek?ea(x):vn(x,{locale:m,weekStartsOn:c})}},h=g[n](e,s==="after"?1:-1);s==="before"&&u?h=Ll([u,h]):s==="after"&&f&&(h=Ul([f,h]));var v=!0;if(o){var p=Gn(h,o);v=!p.disabled&&!p.hidden}return v?h:l.count>Dm?l.lastFocused:ei(h,{moveBy:n,direction:s,context:a,modifiers:o,retry:A(A({},l),{count:l.count+1})})}var ti=d.createContext(void 0);function _m(e){var r=qt(),n=Jo(),s=d.useState(),a=s[0],o=s[1],i=d.useState(),l=i[0],c=i[1],u=Em(r.displayMonths,n),f=a??(l&&r.isDateDisplayed(l))?l:u,m=function(){c(a),o(void 0)},g=function(x){o(x)},h=B(),v=function(x,b){if(a){var y=ei(a,{moveBy:x,direction:b,context:h,modifiers:n});re(a,y)||(r.goToDate(y,a),g(y))}},p={focusedDay:a,focusTarget:f,blur:m,focus:g,focusDayAfter:function(){return v("day","after")},focusDayBefore:function(){return v("day","before")},focusWeekAfter:function(){return v("week","after")},focusWeekBefore:function(){return v("week","before")},focusMonthBefore:function(){return v("month","before")},focusMonthAfter:function(){return v("month","after")},focusYearBefore:function(){return v("year","before")},focusYearAfter:function(){return v("year","after")},focusStartOfWeek:function(){return v("startOfWeek","before")},focusEndOfWeek:function(){return v("endOfWeek","after")}};return t.jsx(ti.Provider,{value:p,children:e.children})}function Zn(){var e=d.useContext(ti);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function Pm(e,r){var n=Jo(),s=Gn(e,n,r);return s}var Jn=d.createContext(void 0);function km(e){if(!br(e.initialProps)){var r={selected:void 0};return t.jsx(Jn.Provider,{value:r,children:e.children})}return t.jsx(Mm,{initialProps:e.initialProps,children:e.children})}function Mm(e){var r=e.initialProps,n=e.children,s=function(o,i,l){var c,u,f;if((c=r.onDayClick)===null||c===void 0||c.call(r,o,i,l),i.selected&&!r.required){(u=r.onSelect)===null||u===void 0||u.call(r,void 0,o,i,l);return}(f=r.onSelect)===null||f===void 0||f.call(r,o,o,i,l)},a={selected:r.selected,onDayClick:s};return t.jsx(Jn.Provider,{value:a,children:n})}function ri(){var e=d.useContext(Jn);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function Rm(e,r){var n=B(),s=ri(),a=Yn(),o=Xn(),i=Zn(),l=i.focusDayAfter,c=i.focusDayBefore,u=i.focusWeekAfter,f=i.focusWeekBefore,m=i.blur,g=i.focus,h=i.focusMonthBefore,v=i.focusMonthAfter,p=i.focusYearBefore,x=i.focusYearAfter,b=i.focusStartOfWeek,y=i.focusEndOfWeek,j=function(M){var k,Te,Fe,Le;br(n)?(k=s.onDayClick)===null||k===void 0||k.call(s,e,r,M):Lt(n)?(Te=a.onDayClick)===null||Te===void 0||Te.call(a,e,r,M):Ut(n)?(Fe=o.onDayClick)===null||Fe===void 0||Fe.call(o,e,r,M):(Le=n.onDayClick)===null||Le===void 0||Le.call(n,e,r,M)},w=function(M){var k;g(e),(k=n.onDayFocus)===null||k===void 0||k.call(n,e,r,M)},C=function(M){var k;m(),(k=n.onDayBlur)===null||k===void 0||k.call(n,e,r,M)},S=function(M){var k;(k=n.onDayMouseEnter)===null||k===void 0||k.call(n,e,r,M)},P=function(M){var k;(k=n.onDayMouseLeave)===null||k===void 0||k.call(n,e,r,M)},_=function(M){var k;(k=n.onDayPointerEnter)===null||k===void 0||k.call(n,e,r,M)},D=function(M){var k;(k=n.onDayPointerLeave)===null||k===void 0||k.call(n,e,r,M)},F=function(M){var k;(k=n.onDayTouchCancel)===null||k===void 0||k.call(n,e,r,M)},E=function(M){var k;(k=n.onDayTouchEnd)===null||k===void 0||k.call(n,e,r,M)},T=function(M){var k;(k=n.onDayTouchMove)===null||k===void 0||k.call(n,e,r,M)},L=function(M){var k;(k=n.onDayTouchStart)===null||k===void 0||k.call(n,e,r,M)},Q=function(M){var k;(k=n.onDayKeyUp)===null||k===void 0||k.call(n,e,r,M)},ce=function(M){var k;switch(M.key){case"ArrowLeft":M.preventDefault(),M.stopPropagation(),n.dir==="rtl"?l():c();break;case"ArrowRight":M.preventDefault(),M.stopPropagation(),n.dir==="rtl"?c():l();break;case"ArrowDown":M.preventDefault(),M.stopPropagation(),u();break;case"ArrowUp":M.preventDefault(),M.stopPropagation(),f();break;case"PageUp":M.preventDefault(),M.stopPropagation(),M.shiftKey?p():h();break;case"PageDown":M.preventDefault(),M.stopPropagation(),M.shiftKey?x():v();break;case"Home":M.preventDefault(),M.stopPropagation(),b();break;case"End":M.preventDefault(),M.stopPropagation(),y();break}(k=n.onDayKeyDown)===null||k===void 0||k.call(n,e,r,M)},Ye={onClick:j,onFocus:w,onBlur:C,onKeyDown:ce,onKeyUp:Q,onMouseEnter:S,onMouseLeave:P,onPointerEnter:_,onPointerLeave:D,onTouchCancel:F,onTouchEnd:E,onTouchMove:T,onTouchStart:L};return Ye}function $m(){var e=B(),r=ri(),n=Yn(),s=Xn(),a=br(e)?r.selected:Lt(e)?n.selected:Ut(e)?s.selected:void 0;return a}function Im(e){return Object.values(Se).includes(e)}function Am(e,r){var n=[e.classNames.day];return Object.keys(r).forEach(function(s){var a=e.modifiersClassNames[s];if(a)n.push(a);else if(Im(s)){var o=e.classNames["day_".concat(s)];o&&n.push(o)}}),n}function Om(e,r){var n=A({},e.styles.day);return Object.keys(r).forEach(function(s){var a;n=A(A({},n),(a=e.modifiersStyles)===null||a===void 0?void 0:a[s])}),n}function Tm(e,r,n){var s,a,o,i=B(),l=Zn(),c=Pm(e,r),u=Rm(e,c),f=$m(),m=!!(i.onDayClick||i.mode!=="default");d.useEffect(function(){var S;c.outside||l.focusedDay&&m&&re(l.focusedDay,e)&&((S=n.current)===null||S===void 0||S.focus())},[l.focusedDay,e,n,m,c.outside]);var g=Am(i,c).join(" "),h=Om(i,c),v=!!(c.outside&&!i.showOutsideDays||c.hidden),p=(o=(a=i.components)===null||a===void 0?void 0:a.DayContent)!==null&&o!==void 0?o:sm,x=t.jsx(p,{date:e,displayMonth:r,activeModifiers:c}),b={style:h,className:g,children:x,role:"gridcell"},y=l.focusTarget&&re(l.focusTarget,e)&&!c.outside,j=l.focusedDay&&re(l.focusedDay,e),w=A(A(A({},b),(s={disabled:c.disabled,role:"gridcell"},s["aria-selected"]=c.selected,s.tabIndex=j||y?0:-1,s)),u),C={isButton:m,isHidden:v,activeModifiers:c,selectedDays:f,buttonProps:w,divProps:b};return C}function Fm(e){var r=d.useRef(null),n=Tm(e.date,e.displayMonth,r);return n.isHidden?t.jsx("div",{role:"gridcell"}):n.isButton?t.jsx(ir,A({name:"day",ref:r},n.buttonProps)):t.jsx("div",A({},n.divProps))}function Lm(e){var r=e.number,n=e.dates,s=B(),a=s.onWeekNumberClick,o=s.styles,i=s.classNames,l=s.locale,c=s.labels.labelWeekNumber,u=s.formatters.formatWeekNumber,f=u(Number(r),{locale:l});if(!a)return t.jsx("span",{className:i.weeknumber,style:o.weeknumber,children:f});var m=c(Number(r),{locale:l}),g=function(h){a(r,n,h)};return t.jsx(ir,{name:"week-number","aria-label":m,className:i.weeknumber,style:o.weeknumber,onClick:g,children:f})}function Um(e){var r,n,s=B(),a=s.styles,o=s.classNames,i=s.showWeekNumber,l=s.components,c=(r=l==null?void 0:l.Day)!==null&&r!==void 0?r:Fm,u=(n=l==null?void 0:l.WeekNumber)!==null&&n!==void 0?n:Lm,f;return i&&(f=t.jsx("td",{className:o.cell,style:a.cell,children:t.jsx(u,{number:e.weekNumber,dates:e.dates})})),t.jsxs("tr",{className:o.row,style:a.row,children:[f,e.dates.map(function(m){return t.jsx("td",{className:o.cell,style:a.cell,role:"presentation",children:t.jsx(c,{displayMonth:e.displayMonth,date:m})},Ql(m))})]})}function Ss(e,r,n){for(var s=n!=null&&n.ISOWeek?ea(r):vn(r,n),a=n!=null&&n.ISOWeek?un(e):Dt(e,n),o=$e(s,a),i=[],l=0;l<=o;l++)i.push(Z(a,l));var c=i.reduce(function(u,f){var m=n!=null&&n.ISOWeek?Hi(f):Ki(f,n),g=u.find(function(h){return h.weekNumber===m});return g?(g.dates.push(f),u):(u.push({weekNumber:m,dates:[f]}),u)},[]);return c}function qm(e,r){var n=Ss(me(e),dr(e),r);if(r!=null&&r.useFixedWeeks){var s=Gl(e,r);if(s<6){var a=n[n.length-1],o=a.dates[a.dates.length-1],i=Xr(o,6-s),l=Ss(Xr(o,1),i,r);n.push.apply(n,l)}}return n}function Wm(e){var r,n,s,a=B(),o=a.locale,i=a.classNames,l=a.styles,c=a.hideHead,u=a.fixedWeeks,f=a.components,m=a.weekStartsOn,g=a.firstWeekContainsDate,h=a.ISOWeek,v=qm(e.displayMonth,{useFixedWeeks:!!u,ISOWeek:h,locale:o,weekStartsOn:m,firstWeekContainsDate:g}),p=(r=f==null?void 0:f.Head)!==null&&r!==void 0?r:nm,x=(n=f==null?void 0:f.Row)!==null&&n!==void 0?n:Um,b=(s=f==null?void 0:f.Footer)!==null&&s!==void 0?s:em;return t.jsxs("table",{id:e.id,className:i.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&t.jsx(p,{}),t.jsx("tbody",{className:i.tbody,style:l.tbody,children:v.map(function(y){return t.jsx(x,{displayMonth:e.displayMonth,dates:y.dates,weekNumber:y.weekNumber},y.weekNumber)})}),t.jsx(b,{displayMonth:e.displayMonth})]})}function zm(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Bm=zm()?d.useLayoutEffect:d.useEffect,Ur=!1,Vm=0;function Es(){return"react-day-picker-".concat(++Vm)}function Hm(e){var r,n=e??(Ur?Es():null),s=d.useState(n),a=s[0],o=s[1];return Bm(function(){a===null&&o(Es())},[]),d.useEffect(function(){Ur===!1&&(Ur=!0)},[]),(r=e??a)!==null&&r!==void 0?r:void 0}function Km(e){var r,n,s=B(),a=s.dir,o=s.classNames,i=s.styles,l=s.components,c=qt().displayMonths,u=Hm(s.id?"".concat(s.id,"-").concat(e.displayIndex):void 0),f=s.id?"".concat(s.id,"-grid-").concat(e.displayIndex):void 0,m=[o.month],g=i.month,h=e.displayIndex===0,v=e.displayIndex===c.length-1,p=!h&&!v;a==="rtl"&&(r=[h,v],v=r[0],h=r[1]),h&&(m.push(o.caption_start),g=A(A({},g),i.caption_start)),v&&(m.push(o.caption_end),g=A(A({},g),i.caption_end)),p&&(m.push(o.caption_between),g=A(A({},g),i.caption_between));var x=(n=l==null?void 0:l.Caption)!==null&&n!==void 0?n:Jf;return t.jsxs("div",{className:m.join(" "),style:g,children:[t.jsx(x,{id:u,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),t.jsx(Wm,{id:f,"aria-labelledby":u,displayMonth:e.displayMonth})]},e.displayIndex)}function Ym(e){var r=B(),n=r.classNames,s=r.styles;return t.jsx("div",{className:n.months,style:s.months,children:e.children})}function Qm(e){var r,n,s=e.initialProps,a=B(),o=Zn(),i=qt(),l=d.useState(!1),c=l[0],u=l[1];d.useEffect(function(){a.initialFocus&&o.focusTarget&&(c||(o.focus(o.focusTarget),u(!0)))},[a.initialFocus,c,o.focus,o.focusTarget,o]);var f=[a.classNames.root,a.className];a.numberOfMonths>1&&f.push(a.classNames.multiple_months),a.showWeekNumber&&f.push(a.classNames.with_weeknumber);var m=A(A({},a.styles.root),a.style),g=Object.keys(s).filter(function(v){return v.startsWith("data-")}).reduce(function(v,p){var x;return A(A({},v),(x={},x[p]=s[p],x))},{}),h=(n=(r=s.components)===null||r===void 0?void 0:r.Months)!==null&&n!==void 0?n:Ym;return t.jsx("div",A({className:f.join(" "),style:m,dir:a.dir,id:a.id,nonce:s.nonce,title:s.title,lang:s.lang},g,{children:t.jsx(h,{children:i.displayMonths.map(function(v,p){return t.jsx(Km,{displayIndex:p,displayMonth:v},p)})})}))}function Xm(e){var r=e.children,n=bf(e,["children"]);return t.jsx(Lf,{initialProps:n,children:t.jsx(Qf,{children:t.jsx(km,{initialProps:n,children:t.jsx(am,{initialProps:n,children:t.jsx(lm,{initialProps:n,children:t.jsx(vm,{children:t.jsx(_m,{children:r})})})})})})})}function Gm(e){return t.jsx(Xm,A({},e,{children:t.jsx(Qm,{initialProps:e})}))}function ni({className:e,classNames:r,showOutsideDays:n=!0,modifiersStyles:s,locale:a=Mt,...o}){return t.jsx(Gm,{showOutsideDays:n,locale:a,className:O("p-3 w-full pointer-events-auto",e),modifiersStyles:{range_start:{color:"white",backgroundColor:"#ea384c",borderTopLeftRadius:"50%",borderBottomLeftRadius:"50%"},range_end:{color:"white",backgroundColor:"#ea384c",borderTopRightRadius:"50%",borderBottomRightRadius:"50%"},range_middle:{color:"inherit",backgroundColor:"#0EA5E9",opacity:.2},...s},classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0 w-full",month:"space-y-4 w-full",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:O(er({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-70 hover:opacity-100 transition-opacity"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex w-full",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem] flex-1",row:"flex w-full mt-2",cell:O("h-9 w-9 text-center text-sm p-0 relative flex-1 focus-within:relative focus-within:z-20"),day:O(er({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100 hover:bg-accent hover:text-accent-foreground"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_range_middle:"day-range-middle",day_selected:"",day_today:"bg-accent text-accent-foreground",day_outside:"text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_hidden:"invisible",...r},components:{IconLeft:({...i})=>t.jsx(Hs,{className:"h-4 w-4"}),IconRight:({...i})=>t.jsx(dn,{className:"h-4 w-4"})},...o})}ni.displayName="Calendar";const Zm=({startDate:e,daysToShow:r,filteredCategory:n,categories:s,onCategoryChange:a,onDaysToShowChange:o,onStartDateChange:i,onNavigatePrevious:l,onNavigateNext:c,onResetToToday:u})=>{const[f,m]=d.useState(!1);return t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Календарь бронирований"}),t.jsx("p",{className:"text-muted-foreground",children:"Шахматка бронирований оборудования"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(Br,{value:n,onValueChange:a,children:[t.jsxs(Vr,{className:"w-[200px]",children:[t.jsx(Dl,{className:"h-4 w-4 mr-2"}),t.jsx(Hr,{placeholder:"Все категории"})]}),t.jsxs(Kr,{children:[t.jsx(lt,{value:"",children:"Все категории"}),s==null?void 0:s.map(g=>t.jsx(lt,{value:g.name,children:g.name},g.id))]})]}),t.jsxs(Br,{value:r.toString(),onValueChange:g=>o(parseInt(g)),children:[t.jsx(Vr,{className:"w-[180px]",children:t.jsx(Hr,{placeholder:"Период"})}),t.jsxs(Kr,{children:[t.jsx(lt,{value:"7",children:"7 дней"}),t.jsx(lt,{value:"14",children:"14 дней"}),t.jsx(lt,{value:"30",children:"30 дней"})]})]}),t.jsxs(Ls,{open:f,onOpenChange:m,children:[t.jsx(Us,{asChild:!0,children:t.jsxs(R,{variant:"outline",children:[t.jsx(Ws,{className:"h-4 w-4 mr-2"}),pe(e,"dd.MM.yyyy")]})}),t.jsx(qs,{className:"w-auto p-0",align:"end",children:t.jsx(ni,{mode:"single",selected:e,onSelect:g=>{g&&(i(g),m(!1))},initialFocus:!0,locale:Mt,className:"p-3 pointer-events-auto"})})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(R,{variant:"outline",size:"icon",onClick:l,children:t.jsx(Hs,{className:"h-4 w-4"})}),t.jsx(R,{variant:"outline",size:"sm",onClick:u,children:"Сегодня"}),t.jsx(R,{variant:"outline",size:"icon",onClick:c,children:t.jsx(dn,{className:"h-4 w-4"})})]})]})]})},Jm=({days:e,products:r,extendedBookings:n,isLoadingProducts:s,hasActiveBookings:a})=>{const{data:o}=oe({queryKey:["categories"],queryFn:xt}),i=f=>{switch(f){case"confirmed":return"bg-green-500";case"pending":return"bg-yellow-400";case"cancelled":return"bg-red-500";case"completed":return"bg-blue-500";default:return"bg-gray-400"}},l=f=>{const m=new Date(f.startDate),g=new Date(f.endDate);let h=e.findIndex(p=>Zi(p,{start:rr(m),end:Gr(g)})||re(p,m)||re(p,g));if(h===-1)return null;m<rr(e[0])&&(h=0);let v=1;for(let p=h+1;p<e.length&&e[p]<=Gr(g);p++)v++;return{index:h,span:v}},c=f=>n.filter(m=>m.productId===f).map(m=>{const g=l(m);return g?{booking:m,...g}:null}).filter(Boolean),u=r.findIndex(f=>!a(f.id));return t.jsx("div",{className:"rounded-md border bg-card overflow-x-auto",children:t.jsxs("table",{className:"w-full min-w-max",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-muted/50",children:[t.jsx("th",{className:"sticky left-0 z-10 bg-muted/50 p-3 text-sm font-medium text-left min-w-[200px] border-r",children:"Товар"}),e.map((f,m)=>t.jsxs("th",{className:`p-2 text-center text-sm font-medium min-w-[100px] border-r ${f.getDay()===0||f.getDay()===6?"bg-muted/70":""}`,children:[t.jsx("div",{children:pe(f,"EEEEEE",{locale:Mt})}),t.jsx("div",{children:pe(f,"dd.MM")})]},m))]})}),t.jsx("tbody",{children:r.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:e.length+1,className:"text-center py-8",children:s?"Загрузка товаров...":"Нет доступных товаров"})}):r.map((f,m)=>{var p;const g=c(f.id),h=((p=o==null?void 0:o.find(x=>x.category_id===f.category_id))==null?void 0:p.name)||"Без категории",v=u!==-1&&m===u;return t.jsxs("tr",{className:`border-t hover:bg-muted/30 ${v?"border-t-2 border-muted-foreground/20":""}`,children:[t.jsx("td",{className:"sticky left-0 z-10 bg-card p-3 font-medium border-r",children:t.jsxs("div",{className:"flex items-center gap-2",children:[f.imageUrl&&t.jsx("div",{className:"w-8 h-8 rounded bg-center bg-cover flex-shrink-0",style:{backgroundImage:`url(${f.imageUrl})`}}),t.jsxs("div",{children:[t.jsx("div",{className:"truncate max-w-[150px]",children:f.title}),t.jsx("div",{className:"text-xs text-muted-foreground",children:h})]})]})}),t.jsx("td",{colSpan:e.length,className:"relative p-0",children:t.jsx("div",{className:"h-12 relative w-full",children:g==null?void 0:g.map((x,b)=>{if(!x)return null;const{booking:y,index:j,span:w}=x,C=j/e.length*100,S=w/e.length*100;return t.jsx(Yi,{children:t.jsxs(Qi,{children:[t.jsx(Xi,{asChild:!0,children:t.jsx("div",{className:`absolute h-6 ${i(y.status)} rounded-sm flex items-center justify-center text-white text-xs whitespace-nowrap overflow-hidden px-2`,style:{left:`${C}%`,width:`${S}%`,top:"12px"},children:y.customerName.split(" ")[0]})}),t.jsx(Gi,{className:"p-0",children:t.jsxs("div",{className:"p-3 max-w-[250px]",children:[t.jsx("div",{className:"font-medium mb-1",children:y.customerName}),t.jsxs("div",{className:"text-xs mb-2",children:[pe(new Date(y.startDate),"dd.MM.yyyy")," - ",pe(new Date(y.endDate),"dd.MM.yyyy")]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:y.customerPhone}),t.jsx(De,{variant:"outline",children:y.status==="confirmed"?"Подтверждено":y.status==="pending"?"В ожидании":y.status==="cancelled"?"Отменено":"Завершено"})]})]})})]})},y.id)})})})]},f.id)})})]})})},eh=()=>t.jsxs("div",{className:"mt-6 flex items-center justify-end gap-4",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Статусы:"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),t.jsx("span",{className:"text-xs",children:"Подтверждено"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-400"}),t.jsx("span",{className:"text-xs",children:"В ожидании"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),t.jsx("span",{className:"text-xs",children:"Отменено"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),t.jsx("span",{className:"text-xs",children:"Завершено"})]})]})]}),th=()=>{const[e,r]=d.useState(new Date),[n,s]=d.useState(14),[a,o]=d.useState(""),[i,l]=d.useState([]),{data:c,isLoading:u}=oe({queryKey:["admin-bookings"],queryFn:zs}),{data:f,isLoading:m}=oe({queryKey:["admin-products"],queryFn:xn}),{data:g=[]}=oe({queryKey:["categories"],queryFn:xt});d.useEffect(()=>{if(c&&f&&g){const j=c.map(w=>{var P;const C=f.find(_=>_.id===w.productId),S=((P=g.find(_=>_.category_id===(C==null?void 0:C.category_id)))==null?void 0:P.name)||"Неизвестная категория";return{...w,productName:(C==null?void 0:C.title)||"Неизвестный товар",productCategory:S}});l(j)}},[c,f,g]);const h=j=>i.some(w=>w.productId===j&&["confirmed","pending"].includes(w.status)),v=d.useMemo(()=>{if(!f)return[];const j=f.filter(S=>{var _;return a?((_=g.find(D=>D.category_id===S.category_id))==null?void 0:_.name)===a:!0}),w=j.filter(S=>h(S.id)),C=j.filter(S=>!h(S.id));return[...w,...C]},[f,g,a,i]),p=Array.from({length:n},(j,w)=>Z(e,w)),x=()=>{r(Z(e,-n))},b=()=>{r(Z(e,n))},y=()=>{r(new Date)};return u||m?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):t.jsxs("div",{children:[t.jsx(Zm,{startDate:e,daysToShow:n,filteredCategory:a,categories:g,onCategoryChange:o,onDaysToShowChange:s,onStartDateChange:r,onNavigatePrevious:x,onNavigateNext:b,onResetToToday:y}),t.jsx(Jm,{days:p,products:v,extendedBookings:i,isLoadingProducts:m,hasActiveBookings:h}),t.jsx(eh,{})]})},rh=()=>{const[e,r]=d.useState(!1),[n,s]=d.useState(null),[a,o]=d.useState(!1),[i,l]=d.useState(""),[c,u]=d.useState(null),[f,m]=d.useState({name:"",slug:"",description:"",imageUrl:""}),[g,h]=d.useState(null),[v,p]=d.useState(""),[x,b]=d.useState("file");return{openDialog:e,setOpenDialog:r,editCategory:n,setEditCategory:s,showAddSection:a,setShowAddSection:o,newCategoryName:i,setNewCategoryName:l,fileForCategory:c,setFileForCategory:u,formData:f,setFormData:m,imageFile:g,setImageFile:h,imagePreview:v,setImagePreview:p,uploadType:x,setUploadType:b,handleInputChange:S=>{const{name:P,value:_}=S.target;m(D=>({...D,[P]:_})),P==="name"&&(!f.slug||f.slug==="")&&m(D=>({...D,slug:_.toLowerCase().replace(/\s+/g,"-")}))},handleFileChange:S=>{var _;const P=(_=S.target.files)==null?void 0:_[0];P&&(h(P),p(URL.createObjectURL(P)))},resetForm:()=>{s(null),m({name:"",slug:"",description:"",imageUrl:""}),h(null),p(""),b("file"),l(""),u(null)},handleEdit:S=>{var P;s(S),m({name:S.name,slug:S.slug||"",description:S.description||"",imageUrl:S.imageUrl||""}),p(S.imageUrl||""),b((P=S.imageUrl)!=null&&P.startsWith("http")?"url":"file"),r(!0)}}},nh=e=>{const[r,n]=d.useState(!1),[s,a]=d.useState(null),[o,i]=d.useState([]),[l,c]=d.useState(!1);return d.useEffect(()=>{e&&!l&&i(e)},[e,l]),{isDragging:r,draggedIndex:s,categoriesOrder:o,hasOrderChanged:l,handleDragStart:h=>{a(h),n(!0)},handleDragOver:(h,v)=>{if(h.preventDefault(),s===null||s===v)return;const p=[...o],x=p[s];p.splice(s,1),p.splice(v,0,x),i(p),a(v),c(!0)},handleDragEnd:()=>{n(!1),a(null)},resetOrderChange:()=>{c(!1)}}},si=()=>{const{toast:e}=te(),r=Pe(),n=fe({mutationFn:async o=>{let i=o.imageUrl;return o.uploadType==="file"&&o.imageFile&&(i=await ns(o.imageFile)),Zt({name:o.name,slug:o.slug,description:o.description,imageUrl:i})},onSuccess:()=>{r.invalidateQueries({queryKey:["categories"]}),e({title:"Категория добавлена",description:"Категория успешно добавлена."})},onError:o=>{e({title:"Ошибка",description:`Не удалось добавить категорию: ${o}`,variant:"destructive"})}}),s=fe({mutationFn:async o=>{let i=o.imageUrl;return o.uploadType==="file"&&o.imageFile&&(i=await ns(o.imageFile)),Ji(o.id,{...o,imageUrl:i})},onSuccess:()=>{r.invalidateQueries({queryKey:["categories"]}),e({title:"Категория обновлена",description:"Категория успешно обновлена."})},onError:o=>{e({title:"Ошибка",description:`Не удалось обновить категорию: ${o}`,variant:"destructive"})}}),a=fe({mutationFn:async o=>{console.log("=== MUTATION FUNCTION START ==="),console.log("Delete mutation function called with ID:",o),console.log("ID type in mutation:",typeof o),console.log("ID value in mutation:",o),console.log("Calling categoryService.deleteCategory...");const i=await el(o);if(console.log("categoryService.deleteCategory result:",i),console.log("Result type:",typeof i),!i)throw console.error("Delete operation returned false/null"),new Error("Failed to delete category - service returned false");return console.log("=== MUTATION FUNCTION SUCCESS ==="),i},onSuccess:()=>{console.log("=== MUTATION onSuccess TRIGGERED ==="),console.log("Delete mutation successful, invalidating queries"),console.log("Current cache state before invalidation:",r.getQueryData(["categories"])),r.removeQueries({queryKey:["categories"]}),r.invalidateQueries({queryKey:["categories"]}),r.refetchQueries({queryKey:["categories"]}),console.log("Query invalidation and refetch completed"),e({title:"Категория удалена",description:"Категория успешно удалена."}),console.log("=== MUTATION onSuccess COMPLETED ===")},onError:o=>{console.error("=== MUTATION onError TRIGGERED ==="),console.error("Delete mutation error:",o),console.error("Error type:",typeof o),console.error("Error message:",o instanceof Error?o.message:"Unknown error"),e({title:"Ошибка",description:`Не удалось удалить категорию: ${o}`,variant:"destructive"}),console.error("=== MUTATION onError COMPLETED ===")}});return{addCategoryMutation:n,updateCategoryMutation:s,deleteCategoryMutation:a}},sh=()=>{const{toast:e}=te(),r=Pe(),{deleteCategoryMutation:n}=si();return{handleDelete:async o=>{if(console.log("=== DELETE OPERATION START ==="),console.log("handleDelete called with ID:",o),console.log("Category ID type:",typeof o),console.log("Category ID length:",o.length),window.confirm("Вы уверены, что хотите удалить эту категорию?")){console.log("User confirmed deletion"),console.log("Mutation pending state before call:",n.isPending);try{console.log("Calling deleteCategoryMutation.mutateAsync with ID:",o);const i=await n.mutateAsync(o);console.log("Mutation completed successfully, result:",i),console.log("=== DELETE OPERATION SUCCESS ===")}catch(i){console.error("=== DELETE OPERATION FAILED ==="),console.error("Error in handleDelete:",i),console.error("Error type:",typeof i),console.error("Error message:",i instanceof Error?i.message:"Unknown error")}}else console.log("User cancelled deletion"),console.log("=== DELETE OPERATION CANCELLED ===")},handleAddNewCategory:async({name:o,slug:i,imageUrl:l},c)=>{try{if(!o.trim())return e({title:"Ошибка",description:"Название категории не может быть пустым",variant:"destructive"}),!1;let u=l||"";if(c)try{const{uploadCategoryImage:m}=await Wr(async()=>{const{uploadCategoryImage:g}=await import("./index-CKzDOQbx.js").then(h=>h.bX);return{uploadCategoryImage:g}},__vite__mapDeps([0,1]));u=await m(c),console.log("Uploaded image URL:",u)}catch(m){console.error("Error uploading image:",m),e({title:"Ошибка",description:"Не удалось загрузить изображение",variant:"destructive"})}const{addCategory:f}=await Wr(async()=>{const{addCategory:m}=await import("./index-CKzDOQbx.js").then(g=>g.bX);return{addCategory:m}},__vite__mapDeps([0,1]));return await f({name:o,slug:i,description:"",imageUrl:u}),r.invalidateQueries({queryKey:["categories"]}),e({title:"Категория добавлена",description:"Категория успешно добавлена."}),!0}catch(u){return console.error("Error adding category:",u),e({title:"Ошибка",description:`Не удалось добавить категорию: ${u}`,variant:"destructive"}),!1}},isDeleting:n.isPending}};function ah({form:e,onAddCategory:r,show:n,setShow:s,newCategoryName:a,setNewCategoryName:o,fileForCategory:i,setFileForCategory:l,isPending:c}){const[u,f]=d.useState(!1),m=async()=>{if(!a.trim()){Nr.error("Название категории не может быть пустым");return}try{f(!0);let g;i&&(g=await zr(i)),r({name:a,slug:a.toLowerCase().replace(/\s+/g,"-"),imageUrl:g}),l(null)}catch(g){console.error("Error uploading category image:",g),Nr.error("Не удалось загрузить изображение. Категория будет создана без изображения."),r({name:a,slug:a.toLowerCase().replace(/\s+/g,"-")})}finally{f(!1)}};return t.jsxs("div",{className:"flex gap-2 items-end",children:[t.jsx(ie,{placeholder:"Новая категория...",value:a,onChange:g=>o(g.target.value),className:"flex-1",disabled:c||u}),t.jsx(ur,{label:"",previewUrl:i?URL.createObjectURL(i):null,onChange:g=>{g instanceof File?l(g):Nr.error("URLs are not supported for categories. Please upload a file.")},disabled:c||u}),t.jsx(R,{type:"button",variant:"outline",onClick:m,size:"sm",disabled:c||u,children:u?"Загрузка...":"Добавить"}),t.jsx(R,{type:"button",variant:"ghost",size:"sm",onClick:()=>s(!1),disabled:u,children:t.jsx(on,{className:"h-4 w-4"})})]})}function oh({hasOrderChanged:e,onSaveOrder:r,updateCategoryOrderMutation:n,showAddSection:s,setShowAddSection:a,newCategoryName:o,setNewCategoryName:i,fileForCategory:l,setFileForCategory:c,onAddCategory:u,addCategoryMutation:f}){return t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Управление категориями"}),t.jsxs("div",{className:"flex gap-2",children:[e&&t.jsx(R,{onClick:r,variant:"outline",disabled:n.isPending,children:n.isPending?t.jsxs("span",{className:"flex items-center",children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Сохранение..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Il,{className:"mr-2 h-4 w-4"}),"Сохранить порядок"]})}),s?t.jsx(ah,{form:{},onAddCategory:u,show:s,setShow:a,newCategoryName:o,setNewCategoryName:i,fileForCategory:l,setFileForCategory:c,isPending:f.isPending}):t.jsxs(R,{onClick:()=>a(!0),children:[t.jsx(cr,{className:"mr-2 h-4 w-4"}),"Добавить категорию"]})]})]})}function ih({open:e,onOpenChange:r,editCategory:n,onSubmit:s,formData:a,onInputChange:o,uploadType:i,onUploadTypeChange:l,imagePreview:c,onFileChange:u,onCancel:f,isSubmitting:m}){return t.jsx(Ot,{open:e,onOpenChange:r,children:t.jsxs(yt,{className:"sm:max-w-[500px]",children:[t.jsx(bt,{children:t.jsx(jt,{children:n?"Редактировать категорию":"Добавить категорию"})}),t.jsxs("form",{onSubmit:s,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(ft,{htmlFor:"name",children:"Название категории"}),t.jsx(ie,{id:"name",name:"name",value:a.name,onChange:o,required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(ft,{htmlFor:"slug",children:"Slug (для URL)"}),t.jsx(ie,{id:"slug",name:"slug",value:a.slug,onChange:o})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(ft,{htmlFor:"description",children:"Описание"}),t.jsx(Qs,{id:"description",name:"description",value:a.description,onChange:o,rows:3})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(ft,{children:"Изображение категории"}),t.jsxs("div",{className:"flex space-x-4 mb-2",children:[t.jsx(R,{type:"button",variant:i==="file"?"default":"outline",onClick:()=>l("file"),children:"Загрузить файл"}),t.jsx(R,{type:"button",variant:i==="url"?"default":"outline",onClick:()=>l("url"),children:"Указать URL"})]}),i==="file"?t.jsx("div",{className:"space-y-2",children:t.jsx("div",{className:"flex items-center justify-center w-full",children:t.jsxs("label",{htmlFor:"dropzone-file",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer bg-muted/50 hover:bg-muted",children:[c?t.jsx("div",{className:"relative w-full h-full",children:t.jsx("img",{src:c,alt:"Preview",className:"object-cover w-full h-full rounded-lg"})}):t.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[t.jsx(gn,{className:"w-8 h-8 mb-2 text-gray-500"}),t.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[t.jsx("span",{className:"font-semibold",children:"Нажмите для загрузки"})," или перетащите файл"]}),t.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG до 5MB"})]}),t.jsx("input",{id:"dropzone-file",type:"file",className:"hidden",accept:"image/*",onChange:u})]})})}):t.jsxs("div",{className:"space-y-2",children:[t.jsx(ie,{id:"imageUrl",name:"imageUrl",placeholder:"https://example.com/image.jpg",value:a.imageUrl,onChange:o}),a.imageUrl&&t.jsx("div",{className:"relative w-full h-32 mt-2",children:t.jsx("img",{src:a.imageUrl,alt:"Preview",className:"object-cover w-full h-full rounded-lg",onError:g=>{g.target.src="https://via.placeholder.com/300x150?text=Invalid+Image+URL"}})})]})]}),t.jsxs(Sa,{children:[t.jsx(R,{type:"button",variant:"outline",onClick:f,children:"Отмена"}),t.jsx(R,{type:"submit",disabled:m,children:n?"Сохранить":"Добавить"})]})]})]})})}function lh({category:e,index:r,isDragging:n,draggedIndex:s,onDragStart:a,onDragOver:o,onDragEnd:i,onEdit:l,onDelete:c,isDeleting:u=!1}){return t.jsx("div",{draggable:!0,onDragStart:()=>a(r),onDragOver:f=>o(f,r),onDragEnd:i,className:`border rounded-md overflow-hidden ${n&&s===r?"opacity-50":""} ${n?"cursor-grabbing":"cursor-grab"}`,children:t.jsxs("div",{className:"flex items-center p-4",children:[t.jsx("div",{className:"mr-4 text-muted-foreground cursor-grab",children:t.jsx(Zs,{className:"h-6 w-6"})}),t.jsx("div",{className:"h-12 w-12 rounded overflow-hidden bg-muted flex-shrink-0",children:e.imageUrl?t.jsx("img",{src:e.imageUrl,alt:e.name,className:"w-full h-full object-cover",onError:f=>{const m=f.target;m.onerror=null,m.src="https://via.placeholder.com/48?text=No+Image"}}):t.jsx("div",{className:"flex items-center justify-center h-full bg-primary/10",children:t.jsx("span",{className:"text-xs text-primary",children:"Нет фото"})})}),t.jsxs("div",{className:"ml-4 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:"font-medium",children:e.name}),t.jsxs("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded font-mono",children:["ID: ",e.category_id]})]}),e.description&&e.description.trim()&&t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:e.description})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(R,{size:"sm",variant:"ghost",onClick:()=>l(e),children:t.jsx(Rl,{className:"h-4 w-4"})}),t.jsx(R,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>c(e.id),disabled:u,children:t.jsx(At,{className:"h-4 w-4"})})]})]})},e.id)}function ch({categories:e,isDragging:r,draggedIndex:n,onDragStart:s,onDragOver:a,onDragEnd:o,onEdit:i,onDelete:l,isDeleting:c=!1}){return t.jsx("div",{className:"space-y-4",children:e.map((u,f)=>t.jsx(lh,{category:u,index:f,isDragging:r,draggedIndex:n,onDragStart:s,onDragOver:a,onDragEnd:o,onEdit:i,onDelete:l,isDeleting:c},u.id))})}function dh(){return t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>t.jsxs(se,{className:"animate-pulse",children:[t.jsx(ue,{className:"bg-muted h-24"}),t.jsxs(ae,{className:"p-4",children:[t.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),t.jsx("div",{className:"h-3 bg-muted rounded w-full"})]})]},e))})}const uh=()=>{const{handleUpdateCategoriesOrder:e,updateCategoryOrderMutation:r}=na(),{openDialog:n,setOpenDialog:s,editCategory:a,showAddSection:o,setShowAddSection:i,newCategoryName:l,setNewCategoryName:c,fileForCategory:u,setFileForCategory:f,formData:m,imageFile:g,imagePreview:h,uploadType:v,setUploadType:p,handleInputChange:x,handleFileChange:b,resetForm:y,handleEdit:j}=rh(),{data:w,isLoading:C}=oe({queryKey:["categories"],queryFn:async()=>{console.log("=== FETCHING CATEGORIES ===");const N=await xt();return console.log("Categories fetched:",N),console.log("Number of categories:",N.length),console.log("Category IDs:",N.map($=>$.id)),N}}),{isDragging:S,draggedIndex:P,categoriesOrder:_,hasOrderChanged:D,handleDragStart:F,handleDragOver:E,handleDragEnd:T,resetOrderChange:L}=nh(w),{addCategoryMutation:Q,updateCategoryMutation:ce}=si(),{handleDelete:Ye,handleAddNewCategory:M,isDeleting:k}=sh(),Te=N=>{N.preventDefault();const $={name:m.name,slug:m.slug,description:m.description,imageUrl:v==="url"?m.imageUrl:"",uploadType:v,imageFile:g};a?ce.mutate({...$,id:a.id}):Q.mutate($),!ce.isError&&!Q.isError&&(s(!1),y())},Fe=()=>{e(_),L()},Le=async N=>{const $=await M(N,u);return $&&(c(""),f(null),i(!1)),$};return t.jsxs("div",{className:"space-y-6",children:[t.jsx(oh,{hasOrderChanged:D,onSaveOrder:Fe,updateCategoryOrderMutation:r,showAddSection:o,setShowAddSection:i,newCategoryName:l,setNewCategoryName:c,fileForCategory:u,setFileForCategory:f,onAddCategory:Le,addCategoryMutation:Q}),C?t.jsx(dh,{}):t.jsx(ch,{categories:_,isDragging:S,draggedIndex:P,onDragStart:F,onDragOver:E,onDragEnd:T,onEdit:j,onDelete:Ye,isDeleting:k}),t.jsx(ih,{open:n,onOpenChange:s,editCategory:a,onSubmit:Te,formData:m,onInputChange:x,uploadType:v,onUploadTypeChange:p,imagePreview:h,onFileChange:b,onCancel:()=>{s(!1),y()},isSubmitting:Q.isPending||ce.isPending})]})},fh=()=>{const{toast:e}=te(),r=Pe(),[n,s]=d.useState(!1),a=oe({queryKey:["promotions"],queryFn:al}),o=fe({mutationFn:async u=>{s(!0);try{return await tl(u)}finally{s(!1)}},onSuccess:()=>{r.invalidateQueries({queryKey:["promotions"]}),e({title:"Акция добавлена",description:"Новая акция успешно добавлена в слайдер"})},onError:u=>{e({title:"Ошибка",description:`Не удалось добавить акцию: ${u.message}`,variant:"destructive"})}}),i=fe({mutationFn:async({id:u,data:f})=>{s(!0);try{return await rl(u,f)}finally{s(!1)}},onSuccess:()=>{r.invalidateQueries({queryKey:["promotions"]}),e({title:"Акция обновлена",description:"Акция успешно обновлена"})},onError:u=>{e({title:"Ошибка",description:`Не удалось обновить акцию: ${u.message}`,variant:"destructive"})}}),l=fe({mutationFn:nl,onSuccess:()=>{r.invalidateQueries({queryKey:["promotions"]}),e({title:"Акция удалена",description:"Акция успешно удалена из слайдера"})},onError:u=>{e({title:"Ошибка",description:`Не удалось удалить акцию: ${u.message}`,variant:"destructive"})}}),c=fe({mutationFn:sl,onSuccess:()=>{r.invalidateQueries({queryKey:["promotions"]}),e({title:"Порядок изменен",description:"Порядок акций успешно обновлен"})},onError:u=>{e({title:"Ошибка",description:`Не удалось изменить порядок акций: ${u.message}`,variant:"destructive"})}});return{promotions:a.data||[],isLoading:n||a.isLoading,isError:a.isError,error:a.error,refetch:a.refetch,addPromotion:o.mutate,updatePromotion:i.mutate,deletePromotion:l.mutate,reorderPromotions:c.mutate}},mh=be.object({title:be.string().min(1,"Название акции обязательно"),linkUrl:be.string().min(1,"URL страницы акции обязателен"),active:be.boolean().default(!0)}),hh=({promotion:e,onSubmit:r,onCancel:n,isSubmitting:s})=>{const[a,o]=d.useState(null),[i,l]=d.useState(e!=null&&e.imageurl?e.imageurl.startsWith("http")?e.imageurl:`https://xwylatyyhqyfwsxfwzmn.supabase.co/storage/v1/object/public/products/${e.imageurl}`:null),c=fn({resolver:mn(mh),defaultValues:{title:(e==null?void 0:e.title)||"",linkUrl:(e==null?void 0:e.linkurl)||"",active:(e==null?void 0:e.active)!==void 0?e.active:!0}}),u=m=>{typeof m=="string"?(l(m),o(null)):(o(m),l(URL.createObjectURL(m)))},f=m=>{r({title:m.title,imageFile:a,imageUrl:typeof i=="string"?i:void 0,linkUrl:m.linkUrl,active:m.active})};return t.jsx(Ys,{...c,children:t.jsxs("form",{onSubmit:c.handleSubmit(f),className:"space-y-6",children:[t.jsx(St,{control:c.control,name:"title",render:({field:m})=>t.jsxs(Et,{children:[t.jsx(ze,{children:"Название акции"}),t.jsx(mt,{children:t.jsx(ie,{placeholder:"Введите название акции",...m})}),t.jsx(nr,{})]})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(ze,{children:"Изображение (соотношение 3:4)"}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx(ur,{label:"Загрузить изображение",onChange:u,previewUrl:i}),t.jsx(Cr,{className:"mt-2",children:"Рекомендуемый размер: 900×1200px, соотношение сторон 3:4"})]}),i&&t.jsx("div",{className:"w-full max-w-xs mx-auto",children:t.jsx(Ks,{ratio:3/4,className:"bg-muted overflow-hidden rounded-md border",children:t.jsx("img",{src:i,alt:"Preview",className:"object-cover w-full h-full"})})})]})]}),t.jsx(St,{control:c.control,name:"linkUrl",render:({field:m})=>t.jsxs(Et,{children:[t.jsx(ze,{children:"URL страницы акции"}),t.jsx(mt,{children:t.jsx(ie,{placeholder:"Например: /catalog или /product/123",...m})}),t.jsx(Cr,{children:"Относительный URL (/catalog) или абсолютный (https://example.com)"}),t.jsx(nr,{})]})}),t.jsx(St,{control:c.control,name:"active",render:({field:m})=>t.jsxs(Et,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsx(ze,{className:"text-base",children:"Активна"}),t.jsx(Cr,{children:"Акция будет отображаться на сайте, если активна"})]}),t.jsx(mt,{children:t.jsx(Pn,{checked:m.value,onCheckedChange:m.onChange})})]})}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(R,{type:"button",variant:"outline",onClick:n,disabled:s,children:"Отмена"}),t.jsx(R,{type:"submit",disabled:s,children:s?"Сохранение...":e?"Обновить":"Добавить"})]})]})})},gh=({promotions:e,onEdit:r,onDelete:n,onReorder:s})=>{const[a,o]=d.useState(null),[i,l]=d.useState(null),c=h=>{o(h)},u=()=>{a&&(n(a),o(null))},f=(h,v)=>{h.dataTransfer.setData("text/plain",v.toString()),l(v)},m=h=>{h.preventDefault()},g=(h,v)=>{h.preventDefault();const p=parseInt(h.dataTransfer.getData("text/plain"));if(p===v)return;const x=[...e],[b]=x.splice(p,1);x.splice(v,0,b),l(null),s(x.map(y=>y.id))};return t.jsxs("div",{className:"space-y-4",children:[e.length===0?t.jsx("div",{className:"text-center p-8 border rounded-lg",children:t.jsx("p",{className:"text-muted-foreground",children:"Нет акций. Добавьте первую акцию."})}):t.jsx("div",{className:"space-y-4",children:e.map((h,v)=>t.jsxs(se,{className:`relative ${i===v?"opacity-50":""}`,draggable:!0,onDragStart:p=>f(p,v),onDragOver:m,onDrop:p=>g(p,v),children:[t.jsx("div",{className:"absolute left-0 top-0 bottom-0 px-2 cursor-grab flex items-center",children:t.jsx(Zs,{className:"text-muted-foreground"})}),t.jsxs(ae,{className:"flex flex-row items-center p-4 pl-10",children:[t.jsx("div",{className:"w-20 flex-shrink-0",children:t.jsx(Ks,{ratio:9/16,className:"bg-muted rounded overflow-hidden",children:t.jsx("img",{src:h.imageurl.startsWith("http")?h.imageurl:`https://xwylatyyhqyfwsxfwzmn.supabase.co/storage/v1/object/public/products/${h.imageurl}`,alt:h.title,className:"object-cover w-full h-full",onError:p=>{const x=p.target;x.onerror=null,x.src="/placeholder.svg"}})})}),t.jsxs("div",{className:"ml-4 flex-grow",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("h3",{className:"font-medium",children:h.title}),h.active?t.jsx(Gs,{className:"h-4 w-4 text-green-500 ml-2"}):t.jsx(Xs,{className:"h-4 w-4 text-muted-foreground ml-2"})]}),t.jsx("p",{className:"text-sm text-muted-foreground",children:h.linkurl})]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>r(h),children:[t.jsx(Al,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Редактировать"})]}),t.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>c(h.id),children:[t.jsx(At,{className:"h-4 w-4 text-destructive"}),t.jsx("span",{className:"sr-only",children:"Удалить"})]})]})]})]},h.id))}),t.jsx(vo,{open:!!a,onOpenChange:h=>!h&&o(null),children:t.jsxs(Tn,{children:[t.jsxs(Fn,{children:[t.jsx(Un,{children:"Вы уверены?"}),t.jsx(qn,{children:"Это действие нельзя отменить. Акция будет удалена навсегда."})]}),t.jsxs(Ln,{children:[t.jsx(zn,{children:"Отмена"}),t.jsx(Wn,{onClick:u,className:"bg-destructive text-destructive-foreground",children:"Удалить"})]})]})})]})};function vh(){const{promotions:e,isLoading:r,addPromotion:n,updatePromotion:s,deletePromotion:a,reorderPromotions:o}=fh(),[i,l]=d.useState(!1),[c,u]=d.useState(void 0),f=()=>{u(void 0),l(!0)},m=x=>{u(x),l(!0)},g=x=>{c?s({id:c.id,data:x}):n(x),l(!1)},h=()=>{l(!1)},v=x=>{a(x)},p=x=>{o(x)};return t.jsxs("div",{className:"container mx-auto py-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Управление акциями"}),t.jsxs(R,{onClick:f,children:[t.jsx(cr,{className:"mr-2 h-4 w-4"}),"Добавить акцию"]})]}),t.jsxs("div",{className:"my-4 p-4 bg-muted/50 rounded-lg",children:[t.jsx("h3",{className:"font-medium mb-2",children:"Инструкция"}),t.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-sm",children:[t.jsx("li",{children:"Создайте акцию с названием, изображением и ссылкой"}),t.jsx("li",{children:"Изображение будет отображаться с соотношением сторон 3:4"}),t.jsx("li",{children:"Перетаскивайте карточки, чтобы изменить порядок акций в слайдере"}),t.jsx("li",{children:"Используйте переключатель «Активна», чтобы временно скрыть акцию"})]})]}),r?t.jsx("p",{className:"text-center py-4",children:"Загрузка..."}):t.jsx(gh,{promotions:e,onEdit:m,onDelete:v,onReorder:p}),t.jsx(Ot,{open:i,onOpenChange:l,children:t.jsxs(yt,{className:"max-w-2xl max-h-[90vh]",children:[t.jsx(bt,{children:t.jsx(jt,{children:c?"Редактировать акцию":"Добавить акцию"})}),t.jsx(In,{className:"max-h-[70vh]",children:t.jsx("div",{className:"pr-4",children:t.jsx(hh,{promotion:c,onSubmit:g,onCancel:h,isSubmitting:r})})})]})})]})}const qr={async getBackupLogs(){const{data:e,error:r}=await V.from("backup_logs").select("*").order("created_at",{ascending:!1});if(r)throw new Error(`Failed to fetch backup logs: ${r.message}`);return e||[]},async createAndDownloadBackup(e){try{console.log(`Creating ${e} backup via server API...`),await xl(e)}catch(r){throw console.error("Error creating backup:",r),r}},async deleteBackupLog(e){const{error:r}=await V.from("backup_logs").delete().eq("id",e);if(r)throw new Error(`Failed to delete backup log: ${r.message}`)},async getBackupStatus(e){const{data:r,error:n}=await V.from("backup_logs").select("*").eq("id",e).single();if(n){if(n.code==="PGRST116")return null;throw new Error(`Failed to get backup status: ${n.message}`)}return r}},ph=()=>{const[e,r]=d.useState(!1),{toast:n}=te(),s=Pe(),{data:a,isLoading:o}=oe({queryKey:["backup-logs"],queryFn:qr.getBackupLogs}),i=fe({mutationFn:async v=>{await qr.createAndDownloadBackup(v)},onSuccess:()=>{n({title:"Резервная копия создана",description:"Файл резервной копии загружается на ваш компьютер"}),s.invalidateQueries({queryKey:["backup-logs"]})},onError:v=>{n({title:"Ошибка создания резервной копии",description:v.message||"Произошла ошибка при создании резервной копии",variant:"destructive"})}}),l=fe({mutationFn:async v=>{await qr.deleteBackupLog(v)},onSuccess:()=>{n({title:"Запись удалена",description:"Запись о резервной копии удалена из истории"}),s.invalidateQueries({queryKey:["backup-logs"]})},onError:v=>{n({title:"Ошибка удаления",description:v.message||"Не удалось удалить запись",variant:"destructive"})}}),c=async v=>{r(!0);try{await i.mutateAsync(v)}finally{r(!1)}},u=v=>{switch(v){case"completed":return t.jsx(il,{className:"h-4 w-4 text-green-500"});case"failed":return t.jsx(Jt,{className:"h-4 w-4 text-red-500"});case"in_progress":return t.jsx(Y,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return t.jsx(ol,{className:"h-4 w-4 text-yellow-500"})}},f=v=>{switch(v){case"completed":return"default";case"failed":return"destructive";case"in_progress":return"secondary";default:return"outline"}},m=v=>{if(!v)return"Неизвестно";const p=["Б","КБ","МБ","ГБ"];let x=v,b=0;for(;x>=1024&&b<p.length-1;)x/=1024,b++;return`${x.toFixed(1)} ${p[b]}`},g=v=>{switch(v){case"storage":case"full":return t.jsx(Er,{className:"h-4 w-4"});default:return t.jsx(Sr,{className:"h-4 w-4"})}},h=v=>{const p=Kl(new Date(v.created_at),{addSuffix:!0,locale:Mt});return v.file_size?`${p} • ${m(v.file_size)}`:p};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2",children:"Резервные копии"}),t.jsx("p",{className:"text-muted-foreground",children:"Создавайте и скачивайте резервные копии базы данных и файлов напрямую"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsxs(ve,{className:"flex items-center gap-2",children:[t.jsx(Sr,{className:"h-5 w-5"}),"База данных"]}),t.jsx(Ne,{children:"Скачать резервную копию всех таблиц и данных"})]}),t.jsx(ae,{children:t.jsxs(R,{onClick:()=>c("database"),disabled:e||i.isPending,className:"w-full",children:[i.isPending?t.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):t.jsx(Nt,{className:"mr-2 h-4 w-4"}),"Скачать БД"]})})]}),t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsxs(ve,{className:"flex items-center gap-2",children:[t.jsx(Er,{className:"h-5 w-5"}),"Файлы"]}),t.jsx(Ne,{children:"Скачать ZIP-архив всех загруженных файлов"})]}),t.jsx(ae,{children:t.jsxs(R,{onClick:()=>c("storage"),disabled:e||i.isPending,className:"w-full",variant:"outline",children:[i.isPending?t.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):t.jsx(Nt,{className:"mr-2 h-4 w-4"}),"Скачать файлы"]})})]}),t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsxs(ve,{className:"flex items-center gap-2",children:[t.jsx(Sr,{className:"h-5 w-5"}),t.jsx(Er,{className:"h-4 w-4"}),"Полная копия"]}),t.jsx(Ne,{children:"Скачать полную резервную копию в ZIP-архиве"})]}),t.jsx(ae,{children:t.jsxs(R,{onClick:()=>c("full"),disabled:e||i.isPending,className:"w-full",variant:"secondary",children:[i.isPending?t.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):t.jsx(Nt,{className:"mr-2 h-4 w-4"}),"Скачать всё"]})})]})]}),t.jsxs(Be,{children:[t.jsx(Nt,{className:"h-4 w-4"}),t.jsx(Ve,{children:"Резервные копии теперь создаются и скачиваются напрямую на ваш компьютер без сохранения на сервере. Это позволяет работать с файлами любого размера и обеспечивает полную конфиденциальность."})]}),t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsx(ve,{children:"История резервных копий"}),t.jsx(Ne,{children:"Журнал созданных резервных копий (файлы скачиваются напрямую)"})]}),t.jsx(ae,{children:o?t.jsx("div",{className:"flex justify-center py-8",children:t.jsx(Y,{className:"h-6 w-6 animate-spin"})}):!a||a.length===0?t.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Резервные копии пока не создавались"}):t.jsx("div",{className:"space-y-4",children:a.map(v=>t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[u(v.status),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"font-medium flex items-center gap-2",children:[g(v.backup_type),v.backup_type==="database"&&"База данных",v.backup_type==="storage"&&"Архив файлов",v.backup_type==="full"&&"Полная копия"]}),t.jsxs(De,{variant:f(v.status),children:[v.status==="completed"&&"Завершено",v.status==="failed"&&"Ошибка",v.status==="in_progress"&&"В процессе",v.status==="pending"&&"Ожидание"]})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:h(v)}),v.error_message&&t.jsx("div",{className:"text-sm text-red-600 mt-1",children:v.error_message})]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(R,{size:"sm",variant:"outline",onClick:()=>l.mutate(v.id),disabled:l.isPending,children:t.jsx(At,{className:"h-4 w-4"})})})]},v.id))})})]})]})},xh=()=>{const{toast:e}=te(),[r,n]=d.useState(null),[s,a]=d.useState(null),[o,i]=d.useState(!1);d.useEffect(()=>{(async()=>{try{i(!0);const{data:f,error:m}=await V.from("settings").select("*").eq("key","hero_banner_image").single();if(m){console.error("Error fetching banner settings:",m);return}f!=null&&f.value&&a(f.value)}catch(f){console.error("Error:",f)}finally{i(!1)}})()},[]);const l=u=>{n(u);const f=URL.createObjectURL(u);a(f)},c=async()=>{if(!r){e({title:"Ошибка",description:"Сначала выберите изображение",variant:"destructive"});return}try{i(!0);const u=`hero_banner_${Date.now()}`,{data:f,error:m}=await V.storage.from("hero-banners").upload(u,r);if(m)throw new Error(m.message);const{data:g}=V.storage.from("hero-banners").getPublicUrl(u),h=g.publicUrl,{error:v}=await V.from("settings").upsert({key:"hero_banner_image",value:h,updated_at:new Date().toISOString()});if(v)throw new Error(v.message);e({title:"Успешно",description:"Баннер главной страницы обновлен"}),a(h)}catch(u){e({title:"Ошибка при сохранении",description:u.message,variant:"destructive"})}finally{i(!1)}};return t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsx(ve,{children:"Баннер главной страницы"}),t.jsx(Ne,{children:"Загрузите изображение для баннера главной страницы. Рекомендуемый размер: 1920x1080px."})]}),t.jsx(ae,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(ft,{htmlFor:"hero-banner",children:"Изображение баннера"}),t.jsx("div",{className:"mt-2",children:t.jsx(ur,{onChange:l,previewUrl:s,disabled:o})})]}),s&&t.jsxs("div",{className:"mt-4",children:[t.jsx(ft,{children:"Предпросмотр"}),t.jsx("div",{className:"mt-2 relative w-full h-[200px] overflow-hidden rounded-md border",children:t.jsx("img",{src:s,alt:"Предпросмотр баннера",className:"w-full h-full object-cover"})})]})]})}),t.jsx(Os,{className:"flex justify-end",children:t.jsxs(R,{onClick:c,disabled:!r||o,children:[o&&t.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранить"]})})]})},yh=()=>{const[e,r]=d.useState("general");return t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-6",children:"Настройки"}),t.jsxs($t,{value:e,onValueChange:r,className:"space-y-6",children:[t.jsxs(It,{children:[t.jsx(ee,{value:"general",children:"Общие"}),t.jsx(ee,{value:"appearance",children:"Оформление"}),t.jsx(ee,{value:"advanced",children:"Расширенные"})]}),t.jsx(G,{value:"general",children:t.jsx("div",{className:"space-y-6",children:t.jsx("p",{className:"text-muted-foreground",children:"Здесь будут общие настройки системы"})})}),t.jsx(G,{value:"appearance",children:t.jsx("div",{className:"space-y-6",children:t.jsx(xh,{})})}),t.jsx(G,{value:"advanced",children:t.jsx("div",{className:"space-y-6",children:t.jsx("p",{className:"text-muted-foreground",children:"Здесь будут расширенные настройки системы"})})})]})]})},bh=()=>{const{toast:e}=te(),[r,n]=d.useState("products"),[s,a]=d.useState([]),[o,i]=d.useState(!1),[l,c]=d.useState(!1),[u,f]=d.useState({products:!1,categories:!1,loading:!0});d.useEffect(()=>{m()},[]);const m=async()=>{f(y=>({...y,loading:!0}));try{const y=await tr("products"),j=await tr("categories");f({products:y.success,categories:j.success,loading:!1}),(!y.success||!j.success)&&e({title:"Проблема с хранилищем",description:"Некоторые хранилища недоступны. Попробуйте сбросить разрешения.",variant:"destructive"})}catch(y){console.error("Error checking storage connections:",y),f({products:!1,categories:!1,loading:!1})}},g=async()=>{c(!0);try{await Ts()?(e({title:"Успешно",description:"Разрешения хранилища успешно сброшены"}),await m(),await h(r)):e({title:"Ошибка",description:"Не удалось сбросить разрешения хранилища",variant:"destructive"})}catch(y){console.error("Error resetting storage permissions:",y),e({title:"Ошибка",description:"Произошла ошибка при сбросе разрешений",variant:"destructive"})}finally{c(!1)}},h=async y=>{i(!0);try{const j=await cl(y);console.log(`Files from ${y}:`,j),a(j)}catch(j){console.error(`Error fetching files from ${y}:`,j),e({title:"Ошибка",description:`Не удалось загрузить файлы из хранилища ${y}`,variant:"destructive"}),a([])}finally{i(!1)}};d.useEffect(()=>{h(r)},[r]);const v=()=>{h(r)},p=y=>{var C;const j=["jpg","jpeg","png","gif","webp","svg"],w=((C=y.split(".").pop())==null?void 0:C.toLowerCase())||"";return j.includes(w)},x=y=>y?y<1024?`${y} B`:y<1024*1024?`${(y/1024).toFixed(2)} KB`:`${(y/(1024*1024)).toFixed(2)} MB`:"Unknown size";return t.jsxs(se,{children:[t.jsxs(ue,{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx(ve,{children:"Файловый менеджер"}),t.jsx(Ne,{children:"Просмотр и управление файлами в хранилище"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(R,{variant:"outline",onClick:g,disabled:l||u.loading,children:[l?t.jsx(Y,{className:"h-4 w-4 animate-spin mr-2"}):t.jsx(hn,{className:"h-4 w-4 mr-2"}),"Сбросить разрешения"]}),t.jsx(R,{variant:"outline",onClick:v,disabled:o,children:o?t.jsx(Y,{className:"h-4 w-4 animate-spin"}):"Обновить"})]})]}),t.jsxs("div",{className:"flex gap-4 mt-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${u.products?"bg-green-500":"bg-red-500"}`}),t.jsxs("span",{className:"text-sm",children:["Products: ",u.products?"Доступно":"Недоступно"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${u.categories?"bg-green-500":"bg-red-500"}`}),t.jsxs("span",{className:"text-sm",children:["Categories: ",u.categories?"Доступно":"Недоступно"]})]})]})]}),t.jsx(ae,{children:t.jsxs($t,{defaultValue:"products",value:r,onValueChange:n,children:[t.jsxs(It,{className:"mb-4",children:[t.jsx(ee,{value:"products",children:"Товары"}),t.jsx(ee,{value:"categories",children:"Категории"})]}),t.jsx(G,{value:"products",className:"space-y-4",children:b("products")}),t.jsx(G,{value:"categories",className:"space-y-4",children:b("categories")})]})})]});function b(y){return o?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(Y,{className:"h-8 w-8 animate-spin text-primary"})}):s.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[t.jsx(_l,{className:"h-16 w-16 text-muted-foreground mb-4"}),t.jsx("p",{className:"text-lg font-medium",children:"Папка пуста"}),t.jsx("p",{className:"text-muted-foreground",children:"В этой папке нет файлов"})]}):t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:s.map(j=>{var S;const w=p(j.name),C=w?ll(y,j.name):null;return t.jsxs("div",{className:"border rounded-md p-2 flex flex-col",children:[t.jsx("div",{className:"h-32 flex items-center justify-center bg-muted rounded-md mb-2",children:w&&C?t.jsx("div",{className:"w-full h-full bg-center bg-cover bg-no-repeat",style:{backgroundImage:`url(${C})`}}):t.jsx(El,{className:"h-16 w-16 text-muted-foreground"})}),t.jsxs("div",{className:"mt-auto",children:[t.jsx("p",{className:"text-sm font-medium truncate",title:j.name,children:j.name}),t.jsx("p",{className:"text-xs text-muted-foreground",children:x((S=j.metadata)==null?void 0:S.size)})]})]},j.id)})})}};function Ah(){const[e,r]=d.useState("dashboard"),n=dl(),{toast:s}=te(),[a,o]=d.useState(null),[i,l]=d.useState(!0);d.useEffect(()=>{(async()=>{l(!0);try{if(!await ul()){s({title:"Ошибка аутентификации",description:"Пожалуйста, войдите снова",variant:"destructive"}),n("/login");return}const m=fl();o(m);const{data:g,error:h}=await V.auth.getSession();if(h||!g.session){s({title:"Сессия истекла",description:"Пожалуйста, войдите снова",variant:"destructive"}),ss(),n("/login");return}}catch(f){console.error("Error verifying authentication:",f),s({title:"Ошибка аутентификации",description:"Произошла ошибка при проверке аутентификации",variant:"destructive"}),n("/login")}finally{l(!1)}})()},[n,s]);const c=()=>{ss(),s({title:"Выход выполнен",description:"Вы успешно вышли из системы"}),n("/login")};return i?t.jsx("div",{className:"flex justify-center items-center h-screen",children:t.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):t.jsxs("div",{className:"container mx-auto px-4 py-10",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Панель администратора"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[t.jsx(Js,{className:"h-4 w-4"}),t.jsx("span",{children:a==null?void 0:a.email})]}),t.jsxs(R,{variant:"outline",onClick:c,children:[t.jsx(kl,{className:"mr-2 h-4 w-4"}),"Выйти"]})]})]}),t.jsxs($t,{defaultValue:"dashboard",value:e,onValueChange:r,children:[t.jsxs(It,{className:"mb-8 w-full justify-start overflow-x-auto",children:[t.jsx(ee,{value:"dashboard",children:"Обзор"}),t.jsx(ee,{value:"products",children:"Товары"}),t.jsx(ee,{value:"categories",children:"Категории"}),t.jsx(ee,{value:"promotions",children:"Акции"}),t.jsx(ee,{value:"bookings",children:"Бронирования"}),t.jsx(ee,{value:"calendar",children:"Календарь"}),t.jsx(ee,{value:"backup",children:"Резервные копии"}),t.jsx(ee,{value:"settings",children:"Настройки"})]}),t.jsx(G,{value:"dashboard",children:t.jsx(ic,{})}),t.jsx(G,{value:"products",children:t.jsx(Pd,{})}),t.jsx(G,{value:"categories",children:t.jsx(uh,{})}),t.jsx(G,{value:"promotions",children:t.jsx(vh,{})}),t.jsx(G,{value:"bookings",children:t.jsx(yf,{})}),t.jsx(G,{value:"calendar",children:t.jsx(th,{})}),t.jsx(G,{value:"backup",children:t.jsx(ph,{})}),t.jsx(G,{value:"storage",children:t.jsx(bh,{})}),t.jsx(G,{value:"settings",children:t.jsx(yh,{})})]})]})}export{Ah as default};
