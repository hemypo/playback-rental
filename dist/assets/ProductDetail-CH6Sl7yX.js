import{m as Ge,r as i,j as e,c as E,u as ee,S as Ue,C as qe,a as He,b as Qe,d as G,e as U,f as We,X as Xe,g as me,h as Ye,i as O,k as Je,l as fe,P,n as Ze,o as xe,p as L,q as R,R as et,$ as tt,s as H,t as W,D as nt,v as st,w as ie,L as ge,x as at,y as rt,z as ot,A as it,B as ct,E as lt,F as Q,G as dt,H as ut,I as ce,J as mt,K as ft,M as xt,N as gt,O as vt}from"./index-CKzDOQbx.js";import{S as ve,f as le}from"./separator-B5PMj3PH.js";import{d as ht,g as pt,P as Nt,T as jt,a as wt,b as yt,c as Ct}from"./tabs-Cps5xYGZ.js";import{Q as bt}from"./QuantitySelector-_QMh9DO_.js";function Rt(t,n,a){const r=ht(t,n)/Ge;return pt(a==null?void 0:a.roundingMethod)(r)}const he=i.forwardRef(({...t},n)=>e.jsx("nav",{ref:n,"aria-label":"breadcrumb",...t}));he.displayName="Breadcrumb";const pe=i.forwardRef(({className:t,...n},a)=>e.jsx("ol",{ref:a,className:E("flex flex-wrap items-center gap-1 break-words text-sm text-muted-foreground sm:gap-2.5",t),...n}));pe.displayName="BreadcrumbList";const F=i.forwardRef(({className:t,...n},a)=>e.jsx("li",{ref:a,className:E("inline-flex items-center gap-1.5",t),...n}));F.displayName="BreadcrumbItem";const K=i.forwardRef(({asChild:t,className:n,...a},r)=>{const o=t?Ue:"a";return ee(),e.jsx(o,{ref:r,className:E("transition-colors hover:text-foreground truncate max-w-[120px] sm:max-w-none",n),...a})});K.displayName="BreadcrumbLink";const Ne=i.forwardRef(({className:t,...n},a)=>(ee(),e.jsx("span",{ref:a,role:"link","aria-disabled":"true","aria-current":"page",className:E("font-normal text-foreground truncate max-w-[160px] sm:max-w-none",t),...n})));Ne.displayName="BreadcrumbPage";const $=({children:t,className:n,...a})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:E("[&>svg]:size-3.5",n),...a,children:t??e.jsx(qe,{})});$.displayName="BreadcrumbSeparator";const Tt=({children:t,show:n,type:a="fade",duration:r=300,className:o,unmountOnExit:c=!0})=>{const[s,m]=i.useState(n),[l,g]=i.useState(!1);if(i.useEffect(()=>{if(n){m(!0);const u=setTimeout(()=>g(!0),10);return()=>clearTimeout(u)}else if(g(!1),c){const u=setTimeout(()=>m(!1),r);return()=>clearTimeout(u)}},[n,r,c]),!s)return null;const d=()=>{const u="transition-all overflow-hidden",p=`duration-${r}`;switch(a){case"fade":return`${u} ${p} ${l?"opacity-100":"opacity-0"}`;case"slide-up":return`${u} ${p} ${l?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`;case"slide-down":return`${u} ${p} ${l?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}`;case"scale":return`${u} ${p} ${l?"opacity-100 scale-100":"opacity-0 scale-95"}`;default:return`${u} ${p} ${l?"opacity-100":"opacity-0"}`}};return e.jsx("div",{className:E(d(),o),children:t})},Mt=({basePrice:t,startDate:n,endDate:a,className:r})=>{const[o,c]=i.useState({hours:0,days:0,subtotal:0,discount:0,total:0,hourlyRate:0,dayDiscount:0});return i.useEffect(()=>{if(n&&a&&!isNaN(n.getTime())&&!isNaN(a.getTime())){const s=Rt(a,n);if(s<=0)return;const m=Math.ceil(s/24),{total:l,subtotal:g,discount:d,hourlyRate:u,dayDiscount:p}=Qe(t,s);c({hours:s,days:m,subtotal:g,discount:d,total:l,hourlyRate:u,dayDiscount:p})}},[n,a,t]),!n||!a?null:e.jsx(Tt,{show:!0,type:"slide-up",children:e.jsx(He,{className:r,children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Стоимость аренды"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Базовая цена:"}),e.jsxs("span",{children:[t.toLocaleString()," ₽/сутки"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Период аренды:"}),e.jsxs("span",{children:[o.hours," ч. (",o.days," ",o.days===1?"день":"дней",")"]})]}),o.dayDiscount>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"Скидка за объем:"}),e.jsxs("span",{children:["-",o.dayDiscount,"%"]})]})]}),e.jsx(ve,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Подытог:"}),e.jsxs("span",{children:[o.subtotal.toLocaleString()," ₽"]})]}),o.discount>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"Скидка:"}),e.jsxs("span",{children:["-",o.discount.toLocaleString()," ₽"]})]}),e.jsxs("div",{className:"flex justify-between font-medium text-lg pt-2",children:[e.jsx("span",{children:"Итого:"}),e.jsxs("span",{children:[o.total.toLocaleString()," ₽"]})]})]})]})})})},Et=()=>e.jsxs("div",{className:"p-6 rounded-xl glass-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-primary/10",children:e.jsx(Nt,{className:"h-5 w-5 text-primary"})}),e.jsx("h3",{className:"font-medium",children:"Условия аренды"})]}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-600 mt-1 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Профессиональное оборудование в отличном состоянии"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-green-600 mt-1 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Залог - паспорт или фиксированная сумма по договору"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-green-600 mt-1 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Гибкие сроки аренды от 4 часов до нескольких недель"})]})]})]}),Dt=({product:t,bookings:n,onBookingChange:a,bookingDates:r})=>{const o=[...n].sort((l,g)=>l.startDate.getTime()-g.startDate.getTime()),s=(()=>{if(!r.startDate||!r.endDate){const u=new Date,p=o.filter(f=>f.startDate.getTime()>u.getTime());return p.length>0?p[0]:null}const l=o.find(u=>u.startDate.getTime()<=r.endDate.getTime()&&u.endDate.getTime()>=r.startDate.getTime());if(l)return l;const g=r.endDate.getTime(),d=o.filter(u=>u.startDate.getTime()>g);return d.length>0?d[0]:null})(),m=r.startDate&&r.endDate&&o.some(l=>l.startDate.getTime()<=r.endDate.getTime()&&l.endDate.getTime()>=r.startDate.getTime());return e.jsx(jt,{value:"details",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(Et,{}),e.jsxs("div",{className:"p-6 rounded-xl glass-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-primary/10",children:e.jsx(We,{className:"h-5 w-5 text-primary"})}),e.jsx("h3",{className:"font-medium",children:"Стоимость аренды"})]}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"4 часа:"}),e.jsxs("span",{className:"font-medium",children:[(t.price*.7).toLocaleString()," ₽"]}),e.jsx("span",{className:"text-xs text-green-600",children:"(-30%)"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Сутки:"}),e.jsxs("span",{className:"font-medium",children:[t.price.toLocaleString()," ₽"]})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"от 3-ех суток:"}),e.jsxs("span",{className:"font-medium",children:[(t.price*.9).toLocaleString()," ₽/день"]}),e.jsx("span",{className:"text-xs text-green-600",children:"(-10%)"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"от 5 дней:"}),e.jsxs("span",{className:"font-medium",children:[(t.price*.7).toLocaleString()," ₽/день"]}),e.jsx("span",{className:"text-xs text-green-600",children:"(-30%)"})]})]})]}),e.jsxs("div",{className:"p-6 rounded-xl glass-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-full bg-primary/10",children:e.jsx(U,{className:"h-5 w-5 text-primary"})}),e.jsx("h3",{className:"font-medium",children:"Доступность"})]}),t.available?e.jsxs(e.Fragment,{children:[r.startDate&&r.endDate?m?e.jsxs("div",{className:"text-red-600 font-medium flex items-center gap-2 mb-4",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{children:"Товар недоступен для выбранных дат"})]}):e.jsxs("div",{className:"text-green-600 font-medium flex items-center gap-2 mb-4",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs("span",{children:["Доступно для аренды с ",le(r.startDate,r.endDate)]})]}):e.jsxs("div",{className:"text-green-600 font-medium flex items-center gap-2 mb-4",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:"Доступно для аренды"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 font-medium",children:m?"Конфликтующее бронирование:":"Ближайшее бронирование:"}),e.jsxs("div",{className:"text-sm bg-secondary p-2 rounded",children:[le(s.startDate,s.endDate),m&&e.jsx("div",{className:"mt-1 text-red-500",children:"Эти даты уже забронированы. Пожалуйста, выберите другой период."})]})]}),!s&&e.jsx("p",{className:"mb-4",children:"Нет предстоящих бронирований."})]})]}):e.jsx("div",{className:"text-red-500 font-medium mb-4",children:"Забронирован"})]})]})})};var A="NavigationMenu",[te,je,It]=me(A),[X,Pt,St]=me(A),[ne,sn]=Ye(A,[It,St]),[_t,I]=ne(A),[Lt,kt]=ne(A),we=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,value:r,onValueChange:o,defaultValue:c,delayDuration:s=200,skipDelayDuration:m=300,orientation:l="horizontal",dir:g,...d}=t,[u,p]=i.useState(null),f=O(n,j=>p(j)),w=Je(g),N=i.useRef(0),C=i.useRef(0),b=i.useRef(0),[D,h]=i.useState(!0),[v="",x]=fe({prop:r,onChange:j=>{const _=j!=="",M=m>0;_?(window.clearTimeout(b.current),M&&h(!1)):(window.clearTimeout(b.current),b.current=window.setTimeout(()=>h(!0),m)),o==null||o(j)},defaultProp:c}),y=i.useCallback(()=>{window.clearTimeout(C.current),C.current=window.setTimeout(()=>x(""),150)},[x]),T=i.useCallback(j=>{window.clearTimeout(C.current),x(j)},[x]),S=i.useCallback(j=>{v===j?window.clearTimeout(C.current):N.current=window.setTimeout(()=>{window.clearTimeout(C.current),x(j)},s)},[v,x,s]);return i.useEffect(()=>()=>{window.clearTimeout(N.current),window.clearTimeout(C.current),window.clearTimeout(b.current)},[]),e.jsx(Ce,{scope:a,isRootMenu:!0,value:v,dir:w,orientation:l,rootNavigationMenu:u,onTriggerEnter:j=>{window.clearTimeout(N.current),D?S(j):T(j)},onTriggerLeave:()=>{window.clearTimeout(N.current),y()},onContentEnter:()=>window.clearTimeout(C.current),onContentLeave:y,onItemSelect:j=>{x(_=>_===j?"":j)},onItemDismiss:()=>x(""),children:e.jsx(P.nav,{"aria-label":"Main","data-orientation":l,dir:w,...d,ref:f})})});we.displayName=A;var ye="NavigationMenuSub",At=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,value:r,onValueChange:o,defaultValue:c,orientation:s="horizontal",...m}=t,l=I(ye,a),[g="",d]=fe({prop:r,onChange:o,defaultProp:c});return e.jsx(Ce,{scope:a,isRootMenu:!1,value:g,dir:l.dir,orientation:s,rootNavigationMenu:l.rootNavigationMenu,onTriggerEnter:u=>d(u),onItemSelect:u=>d(u),onItemDismiss:()=>d(""),children:e.jsx(P.div,{"data-orientation":s,...m,ref:n})})});At.displayName=ye;var Ce=t=>{const{scope:n,isRootMenu:a,rootNavigationMenu:r,dir:o,orientation:c,children:s,value:m,onItemSelect:l,onItemDismiss:g,onTriggerEnter:d,onTriggerLeave:u,onContentEnter:p,onContentLeave:f}=t,[w,N]=i.useState(null),[C,b]=i.useState(new Map),[D,h]=i.useState(null);return e.jsx(_t,{scope:n,isRootMenu:a,rootNavigationMenu:r,value:m,previousValue:Ze(m),baseId:xe(),dir:o,orientation:c,viewport:w,onViewportChange:N,indicatorTrack:D,onIndicatorTrackChange:h,onTriggerEnter:L(d),onTriggerLeave:L(u),onContentEnter:L(p),onContentLeave:L(f),onItemSelect:L(l),onItemDismiss:L(g),onViewportContentChange:i.useCallback((v,x)=>{b(y=>(y.set(v,x),new Map(y)))},[]),onViewportContentRemove:i.useCallback(v=>{b(x=>x.has(v)?(x.delete(v),new Map(x)):x)},[]),children:e.jsx(te.Provider,{scope:n,children:e.jsx(Lt,{scope:n,items:C,children:s})})})},be="NavigationMenuList",Re=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,...r}=t,o=I(be,a),c=e.jsx(P.ul,{"data-orientation":o.orientation,...r,ref:n});return e.jsx(P.div,{style:{position:"relative"},ref:o.onIndicatorTrackChange,children:e.jsx(te.Slot,{scope:a,children:o.isRootMenu?e.jsx(_e,{asChild:!0,children:c}):c})})});Re.displayName=be;var Te="NavigationMenuItem",[Ft,Me]=ne(Te),Ot=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,value:r,...o}=t,c=xe(),s=r||c||"LEGACY_REACT_AUTO_VALUE",m=i.useRef(null),l=i.useRef(null),g=i.useRef(null),d=i.useRef(()=>{}),u=i.useRef(!1),p=i.useCallback((w="start")=>{if(m.current){d.current();const N=J(m.current);N.length&&re(w==="start"?N:N.reverse())}},[]),f=i.useCallback(()=>{if(m.current){const w=J(m.current);w.length&&(d.current=qt(w))}},[]);return e.jsx(Ft,{scope:a,value:s,triggerRef:l,contentRef:m,focusProxyRef:g,wasEscapeCloseRef:u,onEntryKeyDown:p,onFocusProxyEnter:p,onRootContentClose:f,onContentFocusOutside:f,children:e.jsx(P.li,{...o,ref:n})})});Ot.displayName=Te;var Y="NavigationMenuTrigger",Ee=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,disabled:r,...o}=t,c=I(Y,t.__scopeNavigationMenu),s=Me(Y,t.__scopeNavigationMenu),m=i.useRef(null),l=O(m,s.triggerRef,n),g=ke(c.baseId,s.value),d=Ae(c.baseId,s.value),u=i.useRef(!1),p=i.useRef(!1),f=s.value===c.value;return e.jsxs(e.Fragment,{children:[e.jsx(te.ItemSlot,{scope:a,value:s.value,children:e.jsx(Le,{asChild:!0,children:e.jsx(P.button,{id:g,disabled:r,"data-disabled":r?"":void 0,"data-state":oe(f),"aria-expanded":f,"aria-controls":d,...o,ref:l,onPointerEnter:R(t.onPointerEnter,()=>{p.current=!1,s.wasEscapeCloseRef.current=!1}),onPointerMove:R(t.onPointerMove,q(()=>{r||p.current||s.wasEscapeCloseRef.current||u.current||(c.onTriggerEnter(s.value),u.current=!0)})),onPointerLeave:R(t.onPointerLeave,q(()=>{r||(c.onTriggerLeave(),u.current=!1)})),onClick:R(t.onClick,()=>{c.onItemSelect(s.value),p.current=f}),onKeyDown:R(t.onKeyDown,w=>{const C={horizontal:"ArrowDown",vertical:c.dir==="rtl"?"ArrowLeft":"ArrowRight"}[c.orientation];f&&w.key===C&&(s.onEntryKeyDown(),w.preventDefault())})})})}),f&&e.jsxs(e.Fragment,{children:[e.jsx(et,{"aria-hidden":!0,tabIndex:0,ref:s.focusProxyRef,onFocus:w=>{const N=s.contentRef.current,C=w.relatedTarget,b=C===m.current,D=N==null?void 0:N.contains(C);(b||!D)&&s.onFocusProxyEnter(b?"start":"end")}}),c.viewport&&e.jsx("span",{"aria-owns":d})]})]})});Ee.displayName=Y;var Bt="NavigationMenuLink",de="navigationMenu.linkSelect",Kt=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,active:r,onSelect:o,...c}=t;return e.jsx(Le,{asChild:!0,children:e.jsx(P.a,{"data-active":r?"":void 0,"aria-current":r?"page":void 0,...c,ref:n,onClick:R(t.onClick,s=>{const m=s.target,l=new CustomEvent(de,{bubbles:!0,cancelable:!0});if(m.addEventListener(de,g=>o==null?void 0:o(g),{once:!0}),ie(m,l),!l.defaultPrevented&&!s.metaKey){const g=new CustomEvent(V,{bubbles:!0,cancelable:!0});ie(m,g)}},{checkForDefaultPrevented:!1})})})});Kt.displayName=Bt;var se="NavigationMenuIndicator",De=i.forwardRef((t,n)=>{const{forceMount:a,...r}=t,o=I(se,t.__scopeNavigationMenu),c=!!o.value;return o.indicatorTrack?tt.createPortal(e.jsx(H,{present:a||c,children:e.jsx($t,{...r,ref:n})}),o.indicatorTrack):null});De.displayName=se;var $t=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,...r}=t,o=I(se,a),c=je(a),[s,m]=i.useState(null),[l,g]=i.useState(null),d=o.orientation==="horizontal",u=!!o.value;i.useEffect(()=>{var N;const w=(N=c().find(C=>C.value===o.value))==null?void 0:N.ref.current;w&&m(w)},[c,o.value]);const p=()=>{s&&g({size:d?s.offsetWidth:s.offsetHeight,offset:d?s.offsetLeft:s.offsetTop})};return Z(s,p),Z(o.indicatorTrack,p),l?e.jsx(P.div,{"aria-hidden":!0,"data-state":u?"visible":"hidden","data-orientation":o.orientation,...r,ref:n,style:{position:"absolute",...d?{left:0,width:l.size+"px",transform:`translateX(${l.offset}px)`}:{top:0,height:l.size+"px",transform:`translateY(${l.offset}px)`},...r.style}}):null}),k="NavigationMenuContent",Ie=i.forwardRef((t,n)=>{const{forceMount:a,...r}=t,o=I(k,t.__scopeNavigationMenu),c=Me(k,t.__scopeNavigationMenu),s=O(c.contentRef,n),m=c.value===o.value,l={value:c.value,triggerRef:c.triggerRef,focusProxyRef:c.focusProxyRef,wasEscapeCloseRef:c.wasEscapeCloseRef,onContentFocusOutside:c.onContentFocusOutside,onRootContentClose:c.onRootContentClose,...r};return o.viewport?e.jsx(Vt,{forceMount:a,...l,ref:s}):e.jsx(H,{present:a||m,children:e.jsx(Pe,{"data-state":oe(m),...l,ref:s,onPointerEnter:R(t.onPointerEnter,o.onContentEnter),onPointerLeave:R(t.onPointerLeave,q(o.onContentLeave)),style:{pointerEvents:!m&&o.isRootMenu?"none":void 0,...l.style}})})});Ie.displayName=k;var Vt=i.forwardRef((t,n)=>{const a=I(k,t.__scopeNavigationMenu),{onViewportContentChange:r,onViewportContentRemove:o}=a;return W(()=>{r(t.value,{ref:n,...t})},[t,n,r]),W(()=>()=>o(t.value),[t.value,o]),null}),V="navigationMenu.rootContentDismiss",Pe=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,value:r,triggerRef:o,focusProxyRef:c,wasEscapeCloseRef:s,onRootContentClose:m,onContentFocusOutside:l,...g}=t,d=I(k,a),u=i.useRef(null),p=O(u,n),f=ke(d.baseId,r),w=Ae(d.baseId,r),N=je(a),C=i.useRef(null),{onItemDismiss:b}=d;i.useEffect(()=>{const h=u.current;if(d.isRootMenu&&h){const v=()=>{var x;b(),m(),h.contains(document.activeElement)&&((x=o.current)==null||x.focus())};return h.addEventListener(V,v),()=>h.removeEventListener(V,v)}},[d.isRootMenu,t.value,o,b,m]);const D=i.useMemo(()=>{const v=N().map(_=>_.value);d.dir==="rtl"&&v.reverse();const x=v.indexOf(d.value),y=v.indexOf(d.previousValue),T=r===d.value,S=y===v.indexOf(r);if(!T&&!S)return C.current;const j=(()=>{if(x!==y){if(T&&y!==-1)return x>y?"from-end":"from-start";if(S&&x!==-1)return x>y?"to-start":"to-end"}return null})();return C.current=j,j},[d.previousValue,d.value,d.dir,N,r]);return e.jsx(_e,{asChild:!0,children:e.jsx(nt,{id:w,"aria-labelledby":f,"data-motion":D,"data-orientation":d.orientation,...g,ref:p,disableOutsidePointerEvents:!1,onDismiss:()=>{var v;const h=new Event(V,{bubbles:!0,cancelable:!0});(v=u.current)==null||v.dispatchEvent(h)},onFocusOutside:R(t.onFocusOutside,h=>{var x;l();const v=h.target;(x=d.rootNavigationMenu)!=null&&x.contains(v)&&h.preventDefault()}),onPointerDownOutside:R(t.onPointerDownOutside,h=>{var T;const v=h.target,x=N().some(S=>{var j;return(j=S.ref.current)==null?void 0:j.contains(v)}),y=d.isRootMenu&&((T=d.viewport)==null?void 0:T.contains(v));(x||y||!d.isRootMenu)&&h.preventDefault()}),onKeyDown:R(t.onKeyDown,h=>{var y;const v=h.altKey||h.ctrlKey||h.metaKey;if(h.key==="Tab"&&!v){const T=J(h.currentTarget),S=document.activeElement,j=T.findIndex(B=>B===S),M=h.shiftKey?T.slice(0,j).reverse():T.slice(j+1,T.length);re(M)?h.preventDefault():(y=c.current)==null||y.focus()}}),onEscapeKeyDown:R(t.onEscapeKeyDown,h=>{s.current=!0})})})}),ae="NavigationMenuViewport",Se=i.forwardRef((t,n)=>{const{forceMount:a,...r}=t,c=!!I(ae,t.__scopeNavigationMenu).value;return e.jsx(H,{present:a||c,children:e.jsx(zt,{...r,ref:n})})});Se.displayName=ae;var zt=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,children:r,...o}=t,c=I(ae,a),s=O(n,c.onViewportChange),m=kt(k,t.__scopeNavigationMenu),[l,g]=i.useState(null),[d,u]=i.useState(null),p=l?(l==null?void 0:l.width)+"px":void 0,f=l?(l==null?void 0:l.height)+"px":void 0,w=!!c.value,N=w?c.value:c.previousValue;return Z(d,()=>{d&&g({width:d.offsetWidth,height:d.offsetHeight})}),e.jsx(P.div,{"data-state":oe(w),"data-orientation":c.orientation,...o,ref:s,style:{pointerEvents:!w&&c.isRootMenu?"none":void 0,"--radix-navigation-menu-viewport-width":p,"--radix-navigation-menu-viewport-height":f,...o.style},onPointerEnter:R(t.onPointerEnter,c.onContentEnter),onPointerLeave:R(t.onPointerLeave,q(c.onContentLeave)),children:Array.from(m.items).map(([b,{ref:D,forceMount:h,...v}])=>{const x=N===b;return e.jsx(H,{present:h||x,children:e.jsx(Pe,{...v,ref:st(D,y=>{x&&y&&u(y)})})},b)})})}),Gt="FocusGroup",_e=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,...r}=t,o=I(Gt,a);return e.jsx(X.Provider,{scope:a,children:e.jsx(X.Slot,{scope:a,children:e.jsx(P.div,{dir:o.dir,...r,ref:n})})})}),ue=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Ut="FocusGroupItem",Le=i.forwardRef((t,n)=>{const{__scopeNavigationMenu:a,...r}=t,o=Pt(a),c=I(Ut,a);return e.jsx(X.ItemSlot,{scope:a,children:e.jsx(P.button,{...r,ref:n,onKeyDown:R(t.onKeyDown,s=>{if(["Home","End",...ue].includes(s.key)){let l=o().map(u=>u.ref.current);if([c.dir==="rtl"?"ArrowRight":"ArrowLeft","ArrowUp","End"].includes(s.key)&&l.reverse(),ue.includes(s.key)){const u=l.indexOf(s.currentTarget);l=l.slice(u+1)}setTimeout(()=>re(l)),s.preventDefault()}})})})});function J(t){const n=[],a=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)n.push(a.currentNode);return n}function re(t){const n=document.activeElement;return t.some(a=>a===n?!0:(a.focus(),document.activeElement!==n))}function qt(t){return t.forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")}),()=>{t.forEach(n=>{const a=n.dataset.tabindex;n.setAttribute("tabindex",a)})}}function Z(t,n){const a=L(n);W(()=>{let r=0;if(t){const o=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(a)});return o.observe(t),()=>{window.cancelAnimationFrame(r),o.unobserve(t)}}},[t,a])}function oe(t){return t?"open":"closed"}function ke(t,n){return`${t}-trigger-${n}`}function Ae(t,n){return`${t}-content-${n}`}function q(t){return n=>n.pointerType==="mouse"?t(n):void 0}var Fe=we,Oe=Re,Be=Ee,Ke=De,$e=Ie,Ve=Se;const z=i.forwardRef(({to:t,onClick:n,...a},r)=>{const o=c=>{window.scrollTo({top:0,behavior:"smooth"}),n&&n(c)};return e.jsx(ge,{to:t,onClick:o,...a,ref:r})});z.displayName="ScrollToTopLink";const Ht=i.forwardRef(({className:t,children:n,...a},r)=>e.jsxs(Fe,{ref:r,className:E("relative z-10 flex max-w-max flex-1 items-center justify-center",t),...a,children:[n,e.jsx(ze,{})]}));Ht.displayName=Fe.displayName;const Qt=i.forwardRef(({className:t,...n},a)=>e.jsx(Oe,{ref:a,className:E("group flex flex-1 list-none items-center justify-center space-x-1",t),...n}));Qt.displayName=Oe.displayName;const Wt=rt("group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"),Xt=i.forwardRef(({className:t,children:n,...a},r)=>e.jsxs(Be,{ref:r,className:E(Wt(),"group",t),...a,children:[n," ",e.jsx(at,{className:"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180","aria-hidden":"true"})]}));Xt.displayName=Be.displayName;const Yt=i.forwardRef(({className:t,...n},a)=>e.jsx($e,{ref:a,className:E("left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",t),...n}));Yt.displayName=$e.displayName;const ze=i.forwardRef(({className:t,...n},a)=>e.jsx("div",{className:E("absolute left-0 top-full flex justify-center"),children:e.jsx(Ve,{className:E("origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",t),ref:a,...n})}));ze.displayName=Ve.displayName;const Jt=i.forwardRef(({className:t,...n},a)=>e.jsx(Ke,{ref:a,className:E("top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",t),...n,children:e.jsx("div",{className:"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md"})}));Jt.displayName=Ke.displayName;const an=()=>{var _;const{id:t}=ot(),n=it(),a=ct(),r=ee(),o=i.useRef(null),c=a.state,[s,m]=i.useState({startDate:c==null?void 0:c.startDate,endDate:c==null?void 0:c.endDate}),[l,g]=i.useState(1),[d,u]=i.useState(!1),{addToCart:p}=lt(),{data:f,isLoading:w}=Q({queryKey:["product",t],queryFn:()=>xt(t||""),meta:{onError:()=>n("/catalog")}}),{data:N,isLoading:C}=Q({queryKey:["bookings",t],queryFn:()=>gt(t||""),enabled:!!t}),{data:b}=Q({queryKey:["categories"],queryFn:vt}),D=M=>{m({startDate:M.startDate,endDate:M.endDate}),g(1)},h=()=>{o.current&&o.current.scrollIntoView({behavior:"smooth",block:"center"})},v=f?dt(f,N||[],s==null?void 0:s.startDate,s==null?void 0:s.endDate):0,x=f?ut(f,N||[],l,s==null?void 0:s.startDate,s==null?void 0:s.endDate):!1,y=s.startDate&&s.endDate&&!x,T=()=>{if(!f||!s.startDate||!s.endDate||y)return;u(!0),p(f,s.startDate,s.endDate,l)?setTimeout(()=>{u(!1),n("/checkout")},1e3):u(!1)};if(w)return e.jsx("div",{className:"container mx-auto px-4 py-12 flex justify-center items-center min-h-[60vh]",children:e.jsx("div",{className:"w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin"})});if(!f)return e.jsxs("div",{className:"container mx-auto px-4 py-12 text-center",children:[e.jsx("h2",{className:"heading-2 mb-4",children:"Товар не найден"}),e.jsx("p",{className:"mb-6",children:"Товар, который вы ищете, не существует или был удален."}),e.jsx(ce,{asChild:!0,children:e.jsx(ge,{to:"/catalog",children:"Вернуться в каталог"})})]});const S=((_=b==null?void 0:b.find(M=>M.category_id===f.category_id))==null?void 0:_.name)||"Без категории",j=()=>{if(C)return e.jsx("div",{className:"text-gray-400 font-medium",children:"Проверяем наличие..."});const M=s.startDate&&s.endDate,B=M?v:f.quantity;return B>0?e.jsxs("div",{className:"text-green-600 font-medium",children:[M?"Доступно":"В наличии",": ",B," шт.",M&&" на выбранные даты"]}):e.jsx("div",{className:"text-red-600 font-medium",children:M?"Забронировано на выбранные даты":"Нет в наличии"})};return e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(he,{className:"mb-8",children:e.jsxs(pe,{children:[e.jsx(F,{children:e.jsx(K,{asChild:!0,children:e.jsx(z,{to:"/",children:"Главная"})})}),e.jsx($,{}),e.jsx(F,{children:e.jsx(K,{asChild:!0,children:e.jsx(z,{to:"/catalog",children:"Каталог"})})}),e.jsx($,{}),e.jsx(F,{children:e.jsx(K,{asChild:!0,children:e.jsx(z,{to:"/catalog",state:{activeCategory:f.category_id.toString(),scrollTop:!0},children:S})})}),e.jsx($,{}),e.jsx(F,{children:e.jsx(Ne,{children:f.title})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(mt,{imageUrl:f.imageUrl,title:f.title}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:f.title}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-2xl font-bold",children:[f.price.toLocaleString()," ₽/сутки"]})}),j(),f.description&&e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:f.description})})]}),e.jsx(ve,{}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Заказать оборудование"}),e.jsx(ft,{onBookingChange:D,bookedPeriods:N||[],initialStartDate:s.startDate,initialEndDate:s.endDate,isCompact:r,onDateConfirmed:h}),s.startDate&&s.endDate&&v>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Количество:"}),e.jsx(bt,{quantity:l,onQuantityChange:g,maxQuantity:v,disabled:C||y})]}),s.startDate&&s.endDate&&e.jsx(Mt,{basePrice:f.price*l,startDate:s.startDate,endDate:s.endDate}),e.jsx(ce,{ref:o,size:"lg",className:`w-full ${y?"bg-[#ea384c] hover:bg-[#ea384c]/90":""}`,disabled:!f.available||!s.startDate||!s.endDate||d||y,onClick:T,children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"В процессе..."]}):y?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Количество недоступно"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),s.startDate&&s.endDate?`Добавить в корзину${l>1?` (${l} шт.)`:""}`:"Выберите даты"]})})]})]})]}),e.jsx("div",{className:"mt-16",children:e.jsxs(wt,{defaultValue:"details",children:[e.jsx(yt,{className:"mb-8 overflow-x-auto flex w-full justify-start pb-1",children:e.jsx(Ct,{value:"details",children:"Подробности"})}),e.jsx(Dt,{product:f,bookings:N||[],onBookingChange:D,bookingDates:s})]})})]})})};export{an as default};
